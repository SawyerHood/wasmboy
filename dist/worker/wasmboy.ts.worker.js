'use strict';(function(){function eb(a){return a.data?a.data:a}function ea(a,c){nb?self.postMessage(a,c):Bb.postMessage(a,c)}function fb(a,c){a||console.error("workerapi: No callback was provided to onMessage!");if(c)if(nb)c.onmessage=a;else c.on("message",a);else if(nb)self.onmessage=a;else Bb.on("message",a)}function M(a,c,b){c||(c=Math.random().toString(36).replace(/[^a-z]+/g,"").substr(2,10),ob++,c=`${c}-${ob}`,1E5<ob&&(ob=0));return{workerId:b,messageId:c,message:a}}function yc(a,c){c=eb(c);
switch(c.message.type){case y.GET_CONSTANTS:a.WASMBOY_CURRENT_FRAME_OUTPUT_LOCATION=a.wasmInstance.exports.FRAME_LOCATION.valueOf(),a.WASMBOY_CURRENT_FRAME_SIZE=a.wasmInstance.exports.FRAME_SIZE.valueOf(),a.graphicsWorkerPort.postMessage(M({type:y.GET_CONSTANTS_DONE,WASMBOY_CURRENT_FRAME_OUTPUT_LOCATION:a.wasmInstance.exports.FRAME_LOCATION.valueOf()},c.messageId))}}function zc(a,c){c=eb(c);switch(c.message.type){case y.GET_CONSTANTS:a.WASMBOY_SOUND_OUTPUT_LOCATION=a.wasmInstance.exports.AUDIO_BUFFER_LOCATION.valueOf();
a.WASMBOY_CHANNEL_1_OUTPUT_LOCATION=a.wasmInstance.exports.CHANNEL_1_BUFFER_LOCATION.valueOf();a.WASMBOY_CHANNEL_2_OUTPUT_LOCATION=a.wasmInstance.exports.CHANNEL_2_BUFFER_LOCATION.valueOf();a.WASMBOY_CHANNEL_3_OUTPUT_LOCATION=a.wasmInstance.exports.CHANNEL_3_BUFFER_LOCATION.valueOf();a.WASMBOY_CHANNEL_4_OUTPUT_LOCATION=a.wasmInstance.exports.CHANNEL_4_BUFFER_LOCATION.valueOf();a.audioWorkerPort.postMessage(M({type:y.GET_CONSTANTS_DONE,WASMBOY_SOUND_OUTPUT_LOCATION:a.wasmInstance.exports.AUDIO_BUFFER_LOCATION.valueOf()},
c.messageId));break;case y.AUDIO_LATENCY:a.currentAudioLatencyInSeconds=c.message.latency}}function Ac(a,c){c=eb(c);switch(c.message.type){case y.SET_JOYPAD_STATE:a.wasmInstance.exports.setJoypadState.apply(a,c.message.setJoypadStateParamsAsArray)}}function Yb(a){if(!a.wasmByteMemory)return new Uint8Array;let c=a.wasmByteMemory[a.WASMBOY_GAME_BYTES_LOCATION+327],b=void 0;if(0===c)return new Uint8Array;1<=c&&3>=c?b=32768:5<=c&&6>=c?b=2048:15<=c&&19>=c?b=32768:25<=c&&30>=c&&(b=131072);return b?a.wasmByteMemory.slice(a.WASMBOY_GAME_RAM_BANKS_LOCATION,
a.WASMBOY_GAME_RAM_BANKS_LOCATION+b):new Uint8Array}function Zb(a){a.wasmInstance.exports.saveState();return a.wasmByteMemory.slice(a.WASMBOY_INTERNAL_STATE_LOCATION,a.WASMBOY_INTERNAL_STATE_LOCATION+a.WASMBOY_INTERNAL_STATE_SIZE)}function Bc(a,c){c=eb(c);switch(c.message.type){case y.CLEAR_MEMORY:for(var b=0;b<=a.wasmByteMemory.length;b++)a.wasmByteMemory[b]=0;b=a.wasmByteMemory.slice(0);a.memoryWorkerPort.postMessage(M({type:y.CLEAR_MEMORY_DONE,wasmByteMemory:b.buffer},c.messageId),[b.buffer]);
break;case y.GET_CONSTANTS:a.WASMBOY_BOOT_ROM_LOCATION=a.wasmInstance.exports.BOOT_ROM_LOCATION.valueOf();a.WASMBOY_GAME_BYTES_LOCATION=a.wasmInstance.exports.CARTRIDGE_ROM_LOCATION.valueOf();a.WASMBOY_GAME_RAM_BANKS_LOCATION=a.wasmInstance.exports.CARTRIDGE_RAM_LOCATION.valueOf();a.WASMBOY_INTERNAL_STATE_SIZE=a.wasmInstance.exports.WASMBOY_STATE_SIZE.valueOf();a.WASMBOY_INTERNAL_STATE_LOCATION=a.wasmInstance.exports.WASMBOY_STATE_LOCATION.valueOf();a.WASMBOY_INTERNAL_MEMORY_SIZE=a.wasmInstance.exports.GAMEBOY_INTERNAL_MEMORY_SIZE.valueOf();
a.WASMBOY_INTERNAL_MEMORY_LOCATION=a.wasmInstance.exports.GAMEBOY_INTERNAL_MEMORY_LOCATION.valueOf();a.WASMBOY_PALETTE_MEMORY_SIZE=a.wasmInstance.exports.GBC_PALETTE_SIZE.valueOf();a.WASMBOY_PALETTE_MEMORY_LOCATION=a.wasmInstance.exports.GBC_PALETTE_LOCATION.valueOf();a.memoryWorkerPort.postMessage(M({type:y.GET_CONSTANTS_DONE,WASMBOY_BOOT_ROM_LOCATION:a.wasmInstance.exports.BOOT_ROM_LOCATION.valueOf(),WASMBOY_GAME_BYTES_LOCATION:a.wasmInstance.exports.CARTRIDGE_ROM_LOCATION.valueOf(),WASMBOY_GAME_RAM_BANKS_LOCATION:a.wasmInstance.exports.CARTRIDGE_RAM_LOCATION.valueOf(),
WASMBOY_INTERNAL_STATE_SIZE:a.wasmInstance.exports.WASMBOY_STATE_SIZE.valueOf(),WASMBOY_INTERNAL_STATE_LOCATION:a.wasmInstance.exports.WASMBOY_STATE_LOCATION.valueOf(),WASMBOY_INTERNAL_MEMORY_SIZE:a.wasmInstance.exports.GAMEBOY_INTERNAL_MEMORY_SIZE.valueOf(),WASMBOY_INTERNAL_MEMORY_LOCATION:a.wasmInstance.exports.GAMEBOY_INTERNAL_MEMORY_LOCATION.valueOf(),WASMBOY_PALETTE_MEMORY_SIZE:a.wasmInstance.exports.GBC_PALETTE_SIZE.valueOf(),WASMBOY_PALETTE_MEMORY_LOCATION:a.wasmInstance.exports.GBC_PALETTE_LOCATION.valueOf()},
c.messageId));break;case y.SET_MEMORY:b=Object.keys(c.message);b.includes(z.BOOT_ROM)&&a.wasmByteMemory.set(new Uint8Array(c.message[z.BOOT_ROM]),a.WASMBOY_BOOT_ROM_LOCATION);b.includes(z.CARTRIDGE_ROM)&&a.wasmByteMemory.set(new Uint8Array(c.message[z.CARTRIDGE_ROM]),a.WASMBOY_GAME_BYTES_LOCATION);b.includes(z.CARTRIDGE_RAM)&&a.wasmByteMemory.set(new Uint8Array(c.message[z.CARTRIDGE_RAM]),a.WASMBOY_GAME_RAM_BANKS_LOCATION);b.includes(z.GAMEBOY_MEMORY)&&a.wasmByteMemory.set(new Uint8Array(c.message[z.GAMEBOY_MEMORY]),
a.WASMBOY_INTERNAL_MEMORY_LOCATION);b.includes(z.PALETTE_MEMORY)&&a.wasmByteMemory.set(new Uint8Array(c.message[z.PALETTE_MEMORY]),a.WASMBOY_PALETTE_MEMORY_LOCATION);b.includes(z.INTERNAL_STATE)&&(a.wasmByteMemory.set(new Uint8Array(c.message[z.INTERNAL_STATE]),a.WASMBOY_INTERNAL_STATE_LOCATION),a.wasmInstance.exports.loadState());a.memoryWorkerPort.postMessage(M({type:y.SET_MEMORY_DONE},c.messageId));break;case y.GET_MEMORY:{b={type:y.GET_MEMORY};const N=[];var d=c.message.memoryTypes;if(d.includes(z.BOOT_ROM)){if(a.wasmByteMemory){var f=
a.wasmInstance.exports.BOOT_ROM_LOCATION.valueOf();f=a.wasmByteMemory.slice(f,f+a.wasmInstance.exports.BOOT_ROM_SIZE.valueOf())}else f=new Uint8Array;f=f.buffer;b[z.BOOT_ROM]=f;N.push(f)}if(d.includes(z.CARTRIDGE_ROM)){if(a.wasmByteMemory){f=a.wasmByteMemory[a.WASMBOY_GAME_BYTES_LOCATION+327];var e=void 0;0===f?e=32768:1<=f&&3>=f?e=2097152:5<=f&&6>=f?e=262144:15<=f&&19>=f?e=2097152:25<=f&&30>=f&&(e=8388608);f=e?a.wasmByteMemory.slice(a.WASMBOY_GAME_BYTES_LOCATION,a.WASMBOY_GAME_BYTES_LOCATION+e):
new Uint8Array}else f=new Uint8Array;f=f.buffer;b[z.CARTRIDGE_ROM]=f;N.push(f)}d.includes(z.CARTRIDGE_RAM)&&(f=Yb(a).buffer,b[z.CARTRIDGE_RAM]=f,N.push(f));d.includes(z.CARTRIDGE_HEADER)&&(a.wasmByteMemory?(f=a.WASMBOY_GAME_BYTES_LOCATION+308,f=a.wasmByteMemory.slice(f,f+27)):f=new Uint8Array,f=f.buffer,b[z.CARTRIDGE_HEADER]=f,N.push(f));d.includes(z.GAMEBOY_MEMORY)&&(f=a.wasmByteMemory.slice(a.WASMBOY_INTERNAL_MEMORY_LOCATION,a.WASMBOY_INTERNAL_MEMORY_LOCATION+a.WASMBOY_INTERNAL_MEMORY_SIZE).buffer,
b[z.GAMEBOY_MEMORY]=f,N.push(f));d.includes(z.PALETTE_MEMORY)&&(f=a.wasmByteMemory.slice(a.WASMBOY_PALETTE_MEMORY_LOCATION,a.WASMBOY_PALETTE_MEMORY_LOCATION+a.WASMBOY_PALETTE_MEMORY_SIZE).buffer,b[z.PALETTE_MEMORY]=f,N.push(f));d.includes(z.INTERNAL_STATE)&&(a.wasmInstance.exports.saveState(),d=Zb(a).buffer,b[z.INTERNAL_STATE]=d,N.push(d));a.memoryWorkerPort.postMessage(M(b,c.messageId),N)}}}function pb(a,c){a=1<<a&255;b.registerF=0<c?b.registerF|a:b.registerF&(255^a);return b.registerF}function t(a){pb(7,
a)}function u(a){pb(6,a)}function G(a){pb(5,a)}function K(a){pb(4,a)}function Sa(){return b.registerF>>7&1}function U(){return b.registerF>>4&1}function S(a,c){0<=c?G(0!==((a&15)+(c&15)&16)):G((Math.abs(c)&15)>(a&15))}function Db(a,c){0<=c?K(a>(a+c&255)):K(Math.abs(c)>a)}function Wa(a,c,b){b?(a=a^c^a+c,G(0!==(a&16)),K(0!==(a&256))):(b=a+c&65535,K(b<a),G(0!==((a^c^b)&4096)))}function $b(a){switch(a){case 0:d.bgWhite=L.bgWhite;d.bgLightGrey=L.bgLightGrey;d.bgDarkGrey=L.bgDarkGrey;d.bgBlack=L.bgBlack;
d.obj0White=L.obj0White;d.obj0LightGrey=L.obj0LightGrey;d.obj0DarkGrey=L.obj0DarkGrey;d.obj0Black=L.obj0Black;d.obj1White=L.obj1White;d.obj1LightGrey=L.obj1LightGrey;d.obj1DarkGrey=L.obj1DarkGrey;d.obj1Black=L.obj1Black;break;case 1:d.bgWhite=ia.bgWhite;d.bgLightGrey=ia.bgLightGrey;d.bgDarkGrey=ia.bgDarkGrey;d.bgBlack=ia.bgBlack;d.obj0White=ia.obj0White;d.obj0LightGrey=ia.obj0LightGrey;d.obj0DarkGrey=ia.obj0DarkGrey;d.obj0Black=ia.obj0Black;d.obj1White=ia.obj1White;d.obj1LightGrey=ia.obj1LightGrey;
d.obj1DarkGrey=ia.obj1DarkGrey;d.obj1Black=ia.obj1Black;break;case 2:d.bgWhite=ja.bgWhite;d.bgLightGrey=ja.bgLightGrey;d.bgDarkGrey=ja.bgDarkGrey;d.bgBlack=ja.bgBlack;d.obj0White=ja.obj0White;d.obj0LightGrey=ja.obj0LightGrey;d.obj0DarkGrey=ja.obj0DarkGrey;d.obj0Black=ja.obj0Black;d.obj1White=ja.obj1White;d.obj1LightGrey=ja.obj1LightGrey;d.obj1DarkGrey=ja.obj1DarkGrey;d.obj1Black=ja.obj1Black;break;case 3:d.bgWhite=ka.bgWhite;d.bgLightGrey=ka.bgLightGrey;d.bgDarkGrey=ka.bgDarkGrey;d.bgBlack=ka.bgBlack;
d.obj0White=ka.obj0White;d.obj0LightGrey=ka.obj0LightGrey;d.obj0DarkGrey=ka.obj0DarkGrey;d.obj0Black=ka.obj0Black;d.obj1White=ka.obj1White;d.obj1LightGrey=ka.obj1LightGrey;d.obj1DarkGrey=ka.obj1DarkGrey;d.obj1Black=ka.obj1Black;break;case 4:d.bgWhite=la.bgWhite;d.bgLightGrey=la.bgLightGrey;d.bgDarkGrey=la.bgDarkGrey;d.bgBlack=la.bgBlack;d.obj0White=la.obj0White;d.obj0LightGrey=la.obj0LightGrey;d.obj0DarkGrey=la.obj0DarkGrey;d.obj0Black=la.obj0Black;d.obj1White=la.obj1White;d.obj1LightGrey=la.obj1LightGrey;
d.obj1DarkGrey=la.obj1DarkGrey;d.obj1Black=la.obj1Black;break;case 5:d.bgWhite=ma.bgWhite;d.bgLightGrey=ma.bgLightGrey;d.bgDarkGrey=ma.bgDarkGrey;d.bgBlack=ma.bgBlack;d.obj0White=ma.obj0White;d.obj0LightGrey=ma.obj0LightGrey;d.obj0DarkGrey=ma.obj0DarkGrey;d.obj0Black=ma.obj0Black;d.obj1White=ma.obj1White;d.obj1LightGrey=ma.obj1LightGrey;d.obj1DarkGrey=ma.obj1DarkGrey;d.obj1Black=ma.obj1Black;break;case 6:d.bgWhite=na.bgWhite;d.bgLightGrey=na.bgLightGrey;d.bgDarkGrey=na.bgDarkGrey;d.bgBlack=na.bgBlack;
d.obj0White=na.obj0White;d.obj0LightGrey=na.obj0LightGrey;d.obj0DarkGrey=na.obj0DarkGrey;d.obj0Black=na.obj0Black;d.obj1White=na.obj1White;d.obj1LightGrey=na.obj1LightGrey;d.obj1DarkGrey=na.obj1DarkGrey;d.obj1Black=na.obj1Black;break;case 7:d.bgWhite=oa.bgWhite;d.bgLightGrey=oa.bgLightGrey;d.bgDarkGrey=oa.bgDarkGrey;d.bgBlack=oa.bgBlack;d.obj0White=oa.obj0White;d.obj0LightGrey=oa.obj0LightGrey;d.obj0DarkGrey=oa.obj0DarkGrey;d.obj0Black=oa.obj0Black;d.obj1White=oa.obj1White;d.obj1LightGrey=oa.obj1LightGrey;
d.obj1DarkGrey=oa.obj1DarkGrey;d.obj1Black=oa.obj1Black;break;case 8:d.bgWhite=pa.bgWhite;d.bgLightGrey=pa.bgLightGrey;d.bgDarkGrey=pa.bgDarkGrey;d.bgBlack=pa.bgBlack;d.obj0White=pa.obj0White;d.obj0LightGrey=pa.obj0LightGrey;d.obj0DarkGrey=pa.obj0DarkGrey;d.obj0Black=pa.obj0Black;d.obj1White=pa.obj1White;d.obj1LightGrey=pa.obj1LightGrey;d.obj1DarkGrey=pa.obj1DarkGrey;d.obj1Black=pa.obj1Black;break;case 9:d.bgWhite=qa.bgWhite;d.bgLightGrey=qa.bgLightGrey;d.bgDarkGrey=qa.bgDarkGrey;d.bgBlack=qa.bgBlack;
d.obj0White=qa.obj0White;d.obj0LightGrey=qa.obj0LightGrey;d.obj0DarkGrey=qa.obj0DarkGrey;d.obj0Black=qa.obj0Black;d.obj1White=qa.obj1White;d.obj1LightGrey=qa.obj1LightGrey;d.obj1DarkGrey=qa.obj1DarkGrey;d.obj1Black=qa.obj1Black;break;case 10:d.bgWhite=ra.bgWhite;d.bgLightGrey=ra.bgLightGrey;d.bgDarkGrey=ra.bgDarkGrey;d.bgBlack=ra.bgBlack;d.obj0White=ra.obj0White;d.obj0LightGrey=ra.obj0LightGrey;d.obj0DarkGrey=ra.obj0DarkGrey;d.obj0Black=ra.obj0Black;d.obj1White=ra.obj1White;d.obj1LightGrey=ra.obj1LightGrey;
d.obj1DarkGrey=ra.obj1DarkGrey;d.obj1Black=ra.obj1Black;break;case 11:d.bgWhite=sa.bgWhite;d.bgLightGrey=sa.bgLightGrey;d.bgDarkGrey=sa.bgDarkGrey;d.bgBlack=sa.bgBlack;d.obj0White=sa.obj0White;d.obj0LightGrey=sa.obj0LightGrey;d.obj0DarkGrey=sa.obj0DarkGrey;d.obj0Black=sa.obj0Black;d.obj1White=sa.obj1White;d.obj1LightGrey=sa.obj1LightGrey;d.obj1DarkGrey=sa.obj1DarkGrey;d.obj1Black=sa.obj1Black;break;case 12:d.bgWhite=ta.bgWhite,d.bgLightGrey=ta.bgLightGrey,d.bgDarkGrey=ta.bgDarkGrey,d.bgBlack=ta.bgBlack,
d.obj0White=ta.obj0White,d.obj0LightGrey=ta.obj0LightGrey,d.obj0DarkGrey=ta.obj0DarkGrey,d.obj0Black=ta.obj0Black,d.obj1White=ta.obj1White,d.obj1LightGrey=ta.obj1LightGrey,d.obj1DarkGrey=ta.obj1DarkGrey,d.obj1Black=ta.obj1Black}}function p(a,c){return(a&255)<<8|c&255}function E(a){return(a&65280)>>8}function H(a,c){return c&~(1<<a)}function n(a,c){return 0!=(c&1<<a)}function qb(a,c){a=x(c)>>2*a&3;if(c===Xa.memoryLocationSpritePaletteOne)switch(c=d.obj0White,a){case 1:c=d.obj0LightGrey;break;case 2:c=
d.obj0DarkGrey;break;case 3:c=d.obj0Black}else if(c===Xa.memoryLocationSpritePaletteTwo)switch(c=d.obj1White,a){case 1:c=d.obj1LightGrey;break;case 2:c=d.obj1DarkGrey;break;case 3:c=d.obj1Black}else switch(c=d.bgWhite,a){case 1:c=d.bgLightGrey;break;case 2:c=d.bgDarkGrey;break;case 3:c=d.bgBlack}return c}function rb(a,c,b){c=8*a+2*c;a=ac(c+1,b);b=ac(c,b);return p(a,b)}function ua(a,c){a*=5;return 8*((c&31<<a)>>a)}function ac(a,c){a&=63;c&&(a+=64);return e[Ya+a]}function sb(a,c,b,d){void 0===b&&(b=
0);void 0===d&&(d=!1);b&=3;d&&(b|=4);e[Za+(160*c+a)]=b}function Eb(a,c,d,D,f,g,h,m,k,l,p,q,u,w){var N=0;c=gb(c,a);a=X(c+2*g,d);d=X(c+2*g+1,d);for(g=D;g<=f;++g)if(c=h+(g-D),c<k){var A=g;if(0>u||!n(5,u))A=7-A;var Va=0;n(A,d)&&(Va+=1,Va<<=1);n(A,a)&&(Va+=1);if(b.GBCEnabled&&(0<=u||0<=w)){A=0<=w;var fa=u&7;A&&(fa=w&7);var ha=rb(fa,Va,A);A=ua(0,ha);fa=ua(1,ha);ha=ua(2,ha)}else if(0>=q&&(q=r.memoryLocationBackgroundPalette),p){fa=Va;ha=p;void 0===ha&&(ha=!1);A=fa;ha||(A=x(q)>>(fa<<1)&3);fa=242;switch(A){case 1:fa=
160;break;case 2:fa=88;break;case 3:fa=8}fa=A=ha=fa}else ha=qb(Va,q),A=(ha&16711680)>>16,fa=(ha&65280)>>8,ha&=255;var Cb=3*(m*k+c);e[l+Cb+0]=A;e[l+Cb+1]=fa;e[l+Cb+2]=ha;A=!1;0<=u&&(A=n(7,u));sb(c,m,Va,A);N++}return N}function gb(a,c){a===r.memoryLocationTileDataSelectZeroStart&&(c=n(7,c)?c-128:c+128);return a+16*c}function bc(a,c){switch(a){case 1:return n(c,129);case 2:return n(c,135);case 3:return n(c,126);default:return n(c,1)}}function cc(){var a=dc();2047>=a&&0<B.NRx0SweepShift&&(B.sweepShadowFrequency=
a,B.setFrequency(a),a=dc());2047<a&&(B.isEnabled=!1)}function dc(){var a=B.sweepShadowFrequency;var c=a>>B.NRx0SweepShift;return c=B.NRx0Negate?a-c:a+c}function tb(a){switch(a){case B.channelNumber:a=B.isDacEnabled;var c=w.channel1DacEnabled!==a;w.channel1DacEnabled=a;return c;case O.channelNumber:return a=O.isDacEnabled,c=w.channel2DacEnabled!==a,w.channel2DacEnabled=a,c;case J.channelNumber:return a=J.isDacEnabled,c=w.channel3DacEnabled!==a,w.channel3DacEnabled=a,c;case P.channelNumber:return a=
P.isDacEnabled,c=w.channel4DacEnabled!==a,w.channel4DacEnabled=a,c}return!1}function hb(){for(var a=m.batchProcessCycles(),c=m.currentCycles;c>=a;)ec(a),c-=a;m.currentCycles=c}function ec(a){var c=m.maxFrameSequenceCycles();var b=m.frameSequenceCycleCounter+a;if(b>=c){m.frameSequenceCycleCounter=b-c;c=m.frameSequencer;switch(c){case 0:B.updateLength();O.updateLength();J.updateLength();P.updateLength();break;case 2:B.updateLength();O.updateLength();J.updateLength();P.updateLength();B.updateSweep();
break;case 4:B.updateLength();O.updateLength();J.updateLength();P.updateLength();break;case 6:B.updateLength();O.updateLength();J.updateLength();P.updateLength();B.updateSweep();break;case 7:B.updateEnvelope(),O.updateEnvelope(),P.updateEnvelope()}m.frameSequencer=c+1&7;c=!0}else m.frameSequenceCycleCounter=b,c=!1;if(R.audioAccumulateSamples&&!c){c=B.willChannelUpdate(a)||tb(B.channelNumber);b=O.willChannelUpdate(a)||tb(O.channelNumber);var d=J.willChannelUpdate(a)||tb(J.channelNumber),f=P.willChannelUpdate(a)||
tb(P.channelNumber);c&&(w.channel1Sample=B.getSampleFromCycleCounter());b&&(w.channel2Sample=O.getSampleFromCycleCounter());d&&(w.channel3Sample=J.getSampleFromCycleCounter());f&&(w.channel4Sample=P.getSampleFromCycleCounter());if(c||b||d||f)w.needToRemixSamples=!0;c=m.downSampleCycleCounter;c+=a*m.downSampleCycleMultiplier;a=m.maxDownSampleCycles();c>=a&&(c-=a,w.needToRemixSamples||w.mixerVolumeChanged||w.mixerEnabledChanged?$a(w.channel1Sample,w.channel2Sample,w.channel3Sample,w.channel4Sample):
m.downSampleCycleCounter=c,ab(w.leftChannelSampleUnsignedByte+1,w.rightChannelSampleUnsignedByte+1,ub),a=m.audioQueueIndex+1,a>=(m.wasmBoyMemoryMaxBufferSize>>1|0)-1&&--a,m.audioQueueIndex=a);m.downSampleCycleCounter=c}else{c=B.getSample(a)|0;b=O.getSample(a)|0;d=J.getSample(a)|0;f=P.getSample(a)|0;w.channel1Sample=c;w.channel2Sample=b;w.channel3Sample=d;w.channel4Sample=f;a=m.downSampleCycleCounter+a*m.downSampleCycleMultiplier;if(a>=m.maxDownSampleCycles()){a-=m.maxDownSampleCycles();var e=$a(c,
b,d,f),g=E(e);ab(g+1,(e&255)+1,ub);R.enableAudioDebugging&&(e=$a(c,15,15,15),g=E(e),ab(g+1,(e&255)+1,Fb),e=$a(15,b,15,15),g=E(e),ab(g+1,(e&255)+1,Gb),e=$a(15,15,d,15),g=E(e),ab(g+1,(e&255)+1,Hb),e=$a(15,15,15,f),g=E(e),ab(g+1,(e&255)+1,Ib));c=m.audioQueueIndex+1;c>=(m.wasmBoyMemoryMaxBufferSize>>1|0)-1&&--c;m.audioQueueIndex=c}m.downSampleCycleCounter=a}}function fc(){return m.audioQueueIndex}function gc(){m.audioQueueIndex=0}function $a(a,c,b,d){void 0===a&&(a=15);void 0===c&&(c=15);void 0===b&&
(b=15);void 0===d&&(d=15);w.mixerVolumeChanged=!1;var N=0+(m.NR51IsChannel1EnabledOnLeftOutput?a:15);N+=m.NR51IsChannel2EnabledOnLeftOutput?c:15;N+=m.NR51IsChannel3EnabledOnLeftOutput?b:15;N+=m.NR51IsChannel4EnabledOnLeftOutput?d:15;a=0+(m.NR51IsChannel1EnabledOnRightOutput?a:15);a+=m.NR51IsChannel2EnabledOnRightOutput?c:15;a+=m.NR51IsChannel3EnabledOnRightOutput?b:15;a+=m.NR51IsChannel4EnabledOnRightOutput?d:15;w.mixerEnabledChanged=!1;w.needToRemixSamples=!1;c=hc(N,m.NR50LeftMixerVolume+1);b=hc(a,
m.NR50RightMixerVolume+1);w.leftChannelSampleUnsignedByte=c;w.rightChannelSampleUnsignedByte=b;return p(c,b)}function hc(a,c){if(60===a)return 127;a=1E5*(a-60)*c>>3;a=(a/1E5|0)+60;a=1E5*a/(12E6/254|0)|0;return a|=0}function ab(a,c,b){b+=m.audioQueueIndex<<1;e[b+0]=a+1;e[b+1]=c+1}function ib(a){vb(!1);var c=x(k.memoryLocationInterruptRequest);c=H(a,c);k.interruptsRequestedValue=c;g(k.memoryLocationInterruptRequest,c);b.stackPointer-=2;b.isHalted();c=b.stackPointer;var d=b.programCounter,D=E(d);g(c+
0,d&255);g(c+1,D);switch(a){case k.bitPositionVBlankInterrupt:k.isVBlankInterruptRequested=!1;b.programCounter=64;break;case k.bitPositionLcdInterrupt:k.isLcdInterruptRequested=!1;b.programCounter=72;break;case k.bitPositionTimerInterrupt:k.isTimerInterruptRequested=!1;b.programCounter=80;break;case k.bitPositionSerialInterrupt:k.isSerialInterruptRequested=!1;b.programCounter=88;break;case k.bitPositionJoypadInterrupt:k.isJoypadInterruptRequested=!1,b.programCounter=96}}function bb(a){var c=x(k.memoryLocationInterruptRequest);
c|=1<<a;k.interruptsRequestedValue=c;g(k.memoryLocationInterruptRequest,c)}function vb(a){a?k.masterInterruptSwitchDelay=!0:k.masterInterruptSwitch=!1}function Jb(a){for(var c=0;c<a;){var b=q.dividerRegister,d=b;c+=4;d+=4;d&=65535;q.dividerRegister=d;if(q.timerEnabled){var f=q.timerCounterWasReset;q.timerCounterOverflowDelay?(q.timerCounter=q.timerModulo,k.isTimerInterruptRequested=!0,bb(k.bitPositionTimerInterrupt),q.timerCounterOverflowDelay=!1,q.timerCounterWasReset=!0):f&&(q.timerCounterWasReset=
!1);ic(b,d)&&Kb()}}}function Kb(){var a=q.timerCounter;255<++a&&(q.timerCounterOverflowDelay=!0,a=0);q.timerCounter=a}function ic(a,c){var b=Lb(q.timerInputClock);return n(b,a)&&!n(b,c)}function Lb(a){switch(a){case 0:return 9;case 1:return 3;case 2:return 5;case 3:return 7}return 0}function Ta(a){var c=b.isStopped=!1;Cc(a)||(c=!0);Ia(a,!0);c&&(c=!1,3>=a&&(c=!0),a=!1,C.isDpadType&&c&&(a=!0),C.isButtonType&&!c&&(a=!0),a&&(k.isJoypadInterruptRequested=!0,bb(k.bitPositionJoypadInterrupt)))}function Cc(a){switch(a){case 0:return C.up;
case 1:return C.right;case 2:return C.down;case 3:return C.left;case 4:return C.a;case 5:return C.b;case 6:return C.select;case 7:return C.start;default:return!1}}function Ia(a,c){switch(a){case 0:C.up=c;break;case 1:C.right=c;break;case 2:C.down=c;break;case 3:C.left=c;break;case 4:C.a=c;break;case 5:C.b=c;break;case 6:C.select=c;break;case 7:C.start=c}}function jc(a,c,d){for(var N=0;N<d;++N){for(var f=Mb(a+N),e=c+N;40959<e;)e-=8192;kc(e,f)}h.DMACycles+=(32<<b.GBCDoubleSpeed)*(d>>4)}function Nb(a,
c){if(a===b.memoryLocationSpeedSwitch)return g(b.memoryLocationSpeedSwitch,c&1),!1;if(b.BootROMEnabled&&a===b.memoryLocationBootROMSwitch)return b.BootROMEnabled=!1,b.programCounter=255,!0;var d=h.videoRamLocation,D=h.spriteInformationTableLocation;if(a<d){if(!h.isRomOnly){d=h.isMBC1;var f=h.isMBC2;if(8191>=a){if(!f||n(4,c))c&=15,0===c?h.isRamBankingEnabled=!1:10===c&&(h.isRamBankingEnabled=!0)}else 16383>=a?(D=h.isMBC5,!D||12287>=a?(a=h.currentRomBank,f&&(a=c&15),d?(c&=31,a&=224):h.isMBC3?(c&=127,
a&=128):D&&(a&=0),h.currentRomBank=a|c):h.currentRomBank=p(0<c,h.currentRomBank&255)):!f&&24575>=a?d&&h.isMBC1RomModeEnabled?(a=h.currentRomBank&31,h.currentRomBank=a|c&224):(c=h.isMBC5?c&15:c&3,h.currentRamBank=c):!f&&32767>=a&&d&&(h.isMBC1RomModeEnabled=n(0,c))}return!1}if(a>=d&&a<h.cartridgeRamLocation)return!0;if(a>=h.echoRamLocation&&a<D)return g(a-8192,c),!0;if(a>=D&&a<=h.spriteInformationTableLocationEnd)return 2<=v.currentLcdMode;if(a>=h.unusableMemoryLocation&&a<=h.unusableMemoryEndLocation)return!1;
if(a===Z.memoryLocationSerialTransferControl)return Z.updateTransferControl(c);if(65296<=a&&65318>=a){hb();if(a===m.memoryLocationNR52||m.NR52IsSoundEnabled){switch(a){case B.memoryLocationNRx0:B.updateNRx0(c);break;case J.memoryLocationNRx0:J.updateNRx0(c);break;case B.memoryLocationNRx1:B.updateNRx1(c);break;case O.memoryLocationNRx1:O.updateNRx1(c);break;case J.memoryLocationNRx1:J.updateNRx1(c);break;case P.memoryLocationNRx1:P.updateNRx1(c);break;case B.memoryLocationNRx2:B.updateNRx2(c);break;
case O.memoryLocationNRx2:O.updateNRx2(c);break;case J.memoryLocationNRx2:J.volumeCodeChanged=!0;J.updateNRx2(c);break;case P.memoryLocationNRx2:P.updateNRx2(c);break;case B.memoryLocationNRx3:B.updateNRx3(c);break;case O.memoryLocationNRx3:O.updateNRx3(c);break;case J.memoryLocationNRx3:J.updateNRx3(c);break;case P.memoryLocationNRx3:P.updateNRx3(c);break;case B.memoryLocationNRx4:n(7,c)&&(B.updateNRx4(c),B.trigger());break;case O.memoryLocationNRx4:n(7,c)&&(O.updateNRx4(c),O.trigger());break;case J.memoryLocationNRx4:n(7,
c)&&(J.updateNRx4(c),J.trigger());break;case P.memoryLocationNRx4:n(7,c)&&(P.updateNRx4(c),P.trigger());break;case m.memoryLocationNR50:m.updateNR50(c);w.mixerVolumeChanged=!0;break;case m.memoryLocationNR51:m.updateNR51(c);w.mixerEnabledChanged=!0;break;case m.memoryLocationNR52:if(m.updateNR52(c),!n(7,c))for(c=65296;65318>c;++c)g(c,0)}c=!0}else c=!1;return c}65328<=a&&65343>=a&&hb();if(a>=v.memoryLocationLcdControl&&a<=r.memoryLocationWindowX){if(a===v.memoryLocationLcdControl)return v.updateLcdControl(c),
!0;if(a===v.memoryLocationLcdStatus)return v.updateLcdStatus(c),!1;if(a===r.memoryLocationScanlineRegister)return r.scanlineRegister=0,g(a,0),!1;if(a===v.memoryLocationCoincidenceCompare)return v.coincidenceCompare=c,!0;if(a===r.memoryLocationDmaTransfer){c<<=8;for(a=0;159>=a;++a)d=x(c+a),g(h.spriteInformationTableLocation+a,d);h.DMACycles=644;return!0}switch(a){case r.memoryLocationScrollX:r.scrollX=c;break;case r.memoryLocationScrollY:r.scrollY=c;break;case r.memoryLocationWindowX:r.windowX=c;break;
case r.memoryLocationWindowY:r.windowY=c}return!0}if(a===h.memoryLocationHdmaTrigger)return b.GBCEnabled&&(h.isHblankHdmaActive&&!n(7,c)?(h.isHblankHdmaActive=!1,c=x(h.memoryLocationHdmaTrigger),g(h.memoryLocationHdmaTrigger,c|128)):(a=x(h.memoryLocationHdmaSourceHigh),d=x(h.memoryLocationHdmaSourceLow),a=p(a,d)&65520,d=x(h.memoryLocationHdmaDestinationHigh),D=x(h.memoryLocationHdmaDestinationLow),d=p(d,D),d=(d&8176)+h.videoRamLocation,D=H(7,c),D=D+1<<4,n(7,c)?(h.isHblankHdmaActive=!0,h.hblankHdmaTransferLengthRemaining=
D,h.hblankHdmaSource=a,h.hblankHdmaDestination=d,g(h.memoryLocationHdmaTrigger,H(7,c))):(jc(a,d,D),g(h.memoryLocationHdmaTrigger,255)))),!1;if((a===h.memoryLocationGBCWRAMBank||a===h.memoryLocationGBCVRAMBank)&&h.isHblankHdmaActive&&(d=h.hblankHdmaSource,16384<=d&&32767>=d||53248<=d&&57343>=d))return!1;if(a>=Xa.memoryLocationBackgroundPaletteIndex&&a<=Xa.memoryLocationSpritePaletteData){d=Xa.memoryLocationSpritePaletteData;if(a===Xa.memoryLocationBackgroundPaletteData||a===d)D=x(a-1),D=H(6,D),f=D&
63,a===d&&(f+=64),e[Ya+f]=c,c=D,--a,n(7,c)&&g(a,c+1|128);return!0}if(a>=q.memoryLocationDividerRegister&&a<=q.memoryLocationTimerControl){Jb(q.currentCycles);q.currentCycles=0;switch(a){case q.memoryLocationDividerRegister:return q.updateDividerRegister(),!1;case q.memoryLocationTimerCounter:q.updateTimerCounter(c);break;case q.memoryLocationTimerModulo:q.updateTimerModulo(c);break;case q.memoryLocationTimerControl:q.updateTimerControl(c)}return!0}a===C.memoryLocationJoypadRegister&&C.updateJoypad(c);
if(a===k.memoryLocationInterruptRequest)return k.updateInterruptRequested(c),!0;a===k.memoryLocationInterruptEnabled&&k.updateInterruptEnabled(c);return!0}function Ob(a){switch(a>>12){case 0:if(b.BootROMEnabled)if(b.GBCEnabled){if(256>a||511<a&&2304>a)return a+wb}else if(!b.GBCEnabled&&256>a)return a+wb;case 1:case 2:case 3:return a+xb;case 4:case 5:case 6:case 7:var c=h.currentRomBank;h.isMBC5||0!==c||(c=1);return 16384*c+(a-h.switchableCartridgeRomLocation)+xb;case 8:case 9:return c=0,b.GBCEnabled&&
(c=x(h.memoryLocationGBCVRAMBank)&1),a-h.videoRamLocation+2048+8192*c;case 10:case 11:return 8192*h.currentRamBank+(a-h.cartridgeRamLocation)+Pb;case 12:return a-h.internalRamBankZeroLocation+18432;case 13:return c=0,b.GBCEnabled&&(c=x(h.memoryLocationGBCWRAMBank)&7),a-h.internalRamBankZeroLocation+18432+4096*((1>c?1:c)-1);default:return a-h.echoRamLocation+51200}}function g(a,c){a=Ob(a);e[a]=c}function kc(a,c){a===aa.writeGbMemory&&(aa.reachedBreakpoint=!0);Nb(a,c)&&g(a,c)}function lc(a){r.scanlineCycleCounter=
0;r.scanlineRegister=0;g(r.memoryLocationScanlineRegister,0);var c=x(v.memoryLocationLcdStatus);c=H(1,c);c=H(0,c);v.currentLcdMode=0;g(v.memoryLocationLcdStatus,c);if(a)for(a=0;93184>a;++a)e[cb+a]=255}function mc(a,c){0!==a&&1!==a||r.scanlineRegister!==v.coincidenceCompare?c=H(2,c):(c|=4,n(6,c)&&(k.isLcdInterruptRequested=!0,bb(k.bitPositionLcdInterrupt)));return c}function nc(a,c,d,D,f,g){for(var N=D>>3;160>f;++f){var h=f+g;256<=h&&(h-=256);var m=d+(N<<5)+(h>>3),k=X(m,0),l=!1;if(R.tileCaching){var A=
f;var p=a,q=h,u=m,w=k,t=0,v=db.nextXIndexToPerformCacheCheck;if(0<p&&8<A&&w===db.tileId&&A===v){w=n(5,x(u-1));u=n(5,x(u));for(var y=0;8>y;++y){w!==u&&(y=7-y);var z=A+y;if(160>=z){var B=A-(8-y),C=cb+3*(160*p+z);ca(z,p,0,e[C]);ca(z,p,1,e[C]);ca(z,p,2,e[C]);B=e[Za+(160*p+B)];sb(z,p,H(2,B),n(2,B));t++}}}else db.tileId=w;A>=v&&(v=A+8,p=q&7|0,A<p&&(v+=p));db.nextXIndexToPerformCacheCheck=v;A=t;0<A&&(f+=A-1,l=!0)}R.tileRendering&&!l?(l=f,A=a,p=h,h=c,t=D&7|0,v=0,0==l&&(v=p-(p>>3<<3)),p=7,160<l+8&&(p=160-
l),q=-1,w=0,b.GBCEnabled&&(q=X(m,1),w=n(3,q)|0,n(6,q)&&(t=7-t)),A=Eb(k,h,w,v,p,t,l,A,160,cb,!1,0,q,-1),0<A&&(f+=A-1)):l||(b.GBCEnabled?(l=f,A=a,v=D,t=gb(c,k),k=X(m,1),v=v&7|0,n(6,k)&&(v=7-v),p=n(3,k)|0,m=X(t+2*v,p),t=X(t+2*v+1,p),v=h&7|0,n(5,k)||(v=7-v),h=0,n(v,t)&&(h=h+1<<1),n(v,m)&&(h+=1),v=rb(k&7,h,!1),m=ua(0,v),t=ua(1,v),v=ua(2,v),ca(l,A,0,m),ca(l,A,1,t),ca(l,A,2,v),sb(l,A,h,n(7,k))):(m=f,l=a,t=D,A=gb(c,k),t=t&7|0,k=X(A+2*t,0),A=X(A+2*t+1,0),t=h&7|0,t=7-t,h=0,n(t,A)&&(h=h+1<<1),n(t,k)&&(h+=1),
k=qb(h,r.memoryLocationBackgroundPalette),ca(m,l,0,(k&16711680)>>16),ca(m,l,1,(k&65280)>>8),ca(m,l,2,k&255),sb(m,l,h)))}}function oc(a){if(v.enabled)for(r.scanlineCycleCounter+=a,a=R.graphicsDisableScanlineRendering;r.scanlineCycleCounter>=r.MAX_CYCLES_PER_SCANLINE();){r.scanlineCycleCounter-=r.MAX_CYCLES_PER_SCANLINE();var c=r.scanlineRegister;if(144===c){if(a)for(var b=0;144>=b;++b)Qb(b);else Qb(c);for(b=0;144>b;++b)for(var d=0;160>d;++d)e[Za+(160*b+d)]=0;db.tileId=-1;db.nextXIndexToPerformCacheCheck=
-1}else 144>c&&(a||Qb(c));c=153<c?0:c+1;r.scanlineRegister=c}if(v.enabled){c=r.scanlineRegister;b=v.currentLcdMode;a=0;if(144<=c)a=1;else{d=r.scanlineCycleCounter;var f=r.MIN_CYCLES_SPRITES_LCD_MODE();d>=f?a=2:d>=f&&(a=3)}if(b!==a){c=x(v.memoryLocationLcdStatus);v.currentLcdMode=a;b=!1;switch(a){case 0:c=H(0,c);c=H(1,c);b=n(3,c);break;case 1:c=H(1,c);c|=1;b=n(4,c);break;case 2:c=H(0,c);c|=2;b=n(5,c);break;case 3:c|=3}b&&(k.isLcdInterruptRequested=!0,bb(k.bitPositionLcdInterrupt));0===a&&h.isHblankHdmaActive&&
(d=16,b=h.hblankHdmaTransferLengthRemaining,b<d&&(d=b),jc(h.hblankHdmaSource,h.hblankHdmaDestination,d),h.hblankHdmaSource+=d,h.hblankHdmaDestination+=d,b-=d,h.hblankHdmaTransferLengthRemaining=b,d=h.memoryLocationHdmaTrigger,0>=b?(h.isHblankHdmaActive=!1,g(d,255)):g(d,H(7,(b>>4)-1)));1===a&&(k.isVBlankInterruptRequested=!0,bb(k.bitPositionVBlankInterrupt));c=mc(a,c);g(v.memoryLocationLcdStatus,c)}else 153===c&&(c=x(v.memoryLocationLcdStatus),c=mc(a,c),g(v.memoryLocationLcdStatus,c))}}function Qb(a){var c=
r.memoryLocationTileDataSelectZeroStart;v.bgWindowTileDataSelect&&(c=r.memoryLocationTileDataSelectOneStart);if(b.GBCEnabled||v.bgDisplayEnabled){var d=r.memoryLocationTileMapSelectZeroStart;v.bgTileMapDisplaySelect&&(d=r.memoryLocationTileMapSelectOneStart);nc(a,c,d,a+r.scrollY&255,0,r.scrollX)}if(v.windowDisplayEnabled){d=r.memoryLocationTileMapSelectZeroStart;v.windowTileMapDisplaySelect&&(d=r.memoryLocationTileMapSelectOneStart);var D=r.windowX,f=r.windowY;a<f||(D-=7,nc(a,c,d,a-f,D,-D|0))}if(v.spriteDisplayEnable)for(c=
v.tallSpriteSize,d=39;0<=d;--d){f=4*d;var g=r.memoryLocationSpriteAttributesTable+f,h=x(g+0);D=x(g+1);var m=x(g+2);h-=16;D-=8;var k=8;c&&(k=16,m-=m&1);if(a>=h&&a<h+k){f=x(r.memoryLocationSpriteAttributesTable+f+3);g=n(7,f);var l=n(6,f),p=n(5,f);h=a-h;l&&(h=k-h,--h);h<<=1;m=gb(r.memoryLocationTileDataSelectOneStart,m);m+=h;k=b.GBCEnabled&&n(3,f);h=X(m+0,k);m=X(m+1,k);for(k=7;0<=k;--k){l=k;p&&(l-=7,l=-l);var q=0;n(l,m)&&(q=q+1<<1);n(l,h)&&(q+=1);if(0!==q&&(l=D+(7-k),0<=l&&160>=l)){var t=b.GBCEnabled&&
!v.bgDisplayEnabled,u=!1,w=!1;if(!t){var y=e[Za+(160*a+l)],z=y&3;g&&0<z?u=!0:b.GBCEnabled&&n(2,y)&&0<z&&(w=!0)}if(t||!u&&!w)b.GBCEnabled?(u=rb(f&7,q,!0),q=ua(0,u),t=ua(1,u),u=ua(2,u),ca(l,a,0,q),ca(l,a,1,t),ca(l,a,2,u)):(t=r.memoryLocationSpritePaletteOne,n(4,f)&&(t=r.memoryLocationSpritePaletteTwo),q=qb(q,t),ca(l,a,0,(q&16711680)>>16),ca(l,a,1,(q&65280)>>8),ca(l,a,2,q&255))}}}}}function ca(a,c,b,d){e[cb+3*(160*c+a)+b]=d}function X(a,c){return e[a-h.videoRamLocation+2048+8192*(c&1)]}function Rb(a){var c=
h.videoRamLocation;return a<c||a>=c&&a<h.cartridgeRamLocation?-1:a>=h.echoRamLocation&&a<h.spriteInformationTableLocation?x(a-8192):a>=h.spriteInformationTableLocation&&a<=h.spriteInformationTableLocationEnd?2>v.currentLcdMode?255:-1:a===b.memoryLocationSpeedSwitch?(a=255,c=x(b.memoryLocationSpeedSwitch),n(0,c)||(a=H(0,a)),b.GBCDoubleSpeed||(a=H(7,a)),a):a===r.memoryLocationScanlineRegister?(g(a,r.scanlineRegister),r.scanlineRegister):65296<=a&&65318>=a?(hb(),a=a===m.memoryLocationNR52?x(m.memoryLocationNR52)&
128|112:-1,a):65328<=a&&65343>=a?(hb(),-1):a===q.memoryLocationDividerRegister?(c=E(q.dividerRegister),g(a,c),c):a===q.memoryLocationTimerCounter?(g(a,q.timerCounter),q.timerCounter):a===k.memoryLocationInterruptRequest?224|k.interruptsRequestedValue:a===C.memoryLocationJoypadRegister?(a=C.joypadRegisterFlipped,C.isDpadType?(a=C.up?H(2,a):a|4,a=C.right?H(0,a):a|1,a=C.down?H(3,a):a|8,a=C.left?H(1,a):a|2):C.isButtonType&&(a=C.a?H(0,a):a|1,a=C.b?H(1,a):a|2,a=C.select?H(2,a):a|4,a=C.start?H(3,a):a|8),
a|240):-1}function x(a){return e[Ob(a)]}function Mb(a){a===aa.readGbMemory&&(aa.reachedBreakpoint=!0);var c=Rb(a);return-1===c?x(a):c}function Q(a){return 0<e[a]}function Ja(a){var c=b.registerA;S(c,a);Db(c,a);c=c+a&255;b.registerA=c;t(0===c);u(0)}function Ka(a){var c=b.registerA,d=c+a+U()&255;G(0!=((c^a^d)&16));a=c+a+U()&65535;K(0<(a&256));b.registerA=d;t(0===d);u(0)}function La(a){var c=-1*a;var d=b.registerA;S(d,c);Db(d,c);d=d-a&255;b.registerA=d;t(0===d);u(1)}function Ma(a){var c=b.registerA,
d=c-a-U()&255;G(0!=((c^a^d)&16));a=c-a-U()&65535;K(0<(a&256));b.registerA=d;t(0===d);u(1)}function Na(a){a&=b.registerA;b.registerA=a;t(0===a);u(0);G(1);K(0)}function Oa(a){a=(b.registerA^a)&255;b.registerA=a;t(0===a);u(0);G(0);K(0)}function Pa(a){a|=b.registerA;b.registerA=a;t(0===a);u(0);G(0);K(0)}function Qa(a){var c=b.registerA;a*=-1;S(c,a);Db(c,a);t(0===c+a);u(1)}function Ua(a,c){t(0===(c&1<<a));u(0);G(1);return c}function ba(a,c,b){return 0<c?b|1<<a:b&~(1<<a)}function jb(a){var c=b.programCounter;
c=(c+(a<<24>>24)&65535)+1&65535;b.programCounter=c}function pc(a){var c=b.programCounter;c=c+1&65535;b.isHaltBug&&(c=c-1&65535);b.programCounter=c;switch((a&240)>>4){case 0:return Dc(a);case 1:return Ec(a);case 2:return Fc(a);case 3:return Gc(a);case 4:return Hc(a);case 5:return Ic(a);case 6:return Jc(a);case 7:return Kc(a);case 8:return Lc(a);case 9:return Mc(a);case 10:return Nc(a);case 11:return Oc(a);case 12:return Pc(a);case 13:return Qc(a);case 14:return Rc(a);default:return Sc(a)}}function I(a){Ra(4);
return Mb(a)}function T(a,c){Ra(4);kc(a,c)}function Ha(a){Ra(8);var c=Rb(a);c=-1===c?x(a):c;a+=1;var b=Rb(a);a=-1===b?x(a):b;return p(a,c)}function V(a,c){Ra(8);var b=E(c);c&=255;Nb(a,c)&&g(a,c);a+=1;Nb(a,b)&&g(a,b)}function F(){Ra(4);return x(b.programCounter)}function Y(){Ra(4);var a=x(b.programCounter+1&65535);return p(a,F())}function Dc(a){switch(a){case 0:return 4;case 1:return a=Y(),b.registerB=E(a),b.registerC=a&255,b.programCounter=b.programCounter+2&65535,4;case 2:return T(p(b.registerB,
b.registerC),b.registerA),4;case 3:return a=p(b.registerB,b.registerC),a++,b.registerB=E(a),b.registerC=a&255,8;case 4:return a=b.registerB,S(a,1),a=a+1&255,b.registerB=a,t(0===a),u(0),4;case 5:return a=b.registerB,S(a,-1),a=a-1&255,b.registerB=a,t(0===a),u(1),4;case 6:return b.registerB=F(),b.programCounter=b.programCounter+1&65535,4;case 7:return a=b.registerA,K(128===(a&128)),b.registerA=(a<<1|a>>7)&255,t(0),u(0),G(0),4;case 8:return V(Y(),b.stackPointer),b.programCounter=b.programCounter+2&65535,
4;case 9:a=p(b.registerH,b.registerL);var c=p(b.registerB,b.registerC);Wa(a,c,!1);a=a+c&65535;b.registerH=E(a);b.registerL=a&255;u(0);return 8;case 10:return b.registerA=I(p(b.registerB,b.registerC)),4;case 11:return a=p(b.registerB,b.registerC),a=a-1&65535,b.registerB=E(a),b.registerC=a&255,8;case 12:return a=b.registerC,S(a,1),a=a+1&255,b.registerC=a,t(0===a),u(0),4;case 13:return a=b.registerC,S(a,-1),a=a-1&255,b.registerC=a,t(0===a),u(1),4;case 14:return b.registerC=F(),b.programCounter=b.programCounter+
1&65535,4;case 15:return a=b.registerA,K(0<(a&1)),b.registerA=(a>>1|a<<7)&255,t(0),u(0),G(0),4}return-1}function Ec(a){switch(a){case 16:if(b.GBCEnabled&&(a=I(b.memoryLocationSpeedSwitch),n(0,a)))return a=H(0,a),n(7,a)?(b.GBCDoubleSpeed=!1,a=H(7,a)):(b.GBCDoubleSpeed=!0,a|=128),T(b.memoryLocationSpeedSwitch,a),68;b.isStopped=!0;b.programCounter=b.programCounter+1&65535;return 4;case 17:return a=Y(),b.registerD=E(a),b.registerE=a&255,b.programCounter=b.programCounter+2&65535,4;case 18:return T(p(b.registerD,
b.registerE),b.registerA),4;case 19:return a=p(b.registerD,b.registerE),a=a+1&65535,b.registerD=E(a),b.registerE=a&255,8;case 20:return a=b.registerD,S(a,1),b.registerD=a+1&255,t(0===b.registerD),u(0),4;case 21:return a=b.registerD,S(a,-1),b.registerD=a-1&255,t(0===b.registerD),u(1),4;case 22:return b.registerD=F(),b.programCounter=b.programCounter+1&65535,4;case 23:return a=128===(b.registerA&128),b.registerA=(b.registerA<<1|U())&255,K(a),t(0),u(0),G(0),4;case 24:return jb(F()),8;case 25:a=p(b.registerH,
b.registerL);var c=p(b.registerD,b.registerE);Wa(a,c,!1);a=a+c&65535;b.registerH=E(a);b.registerL=a&255;u(0);return 8;case 26:return a=p(b.registerD,b.registerE),b.registerA=I(a),4;case 27:return a=p(b.registerD,b.registerE),a=a-1&65535,b.registerD=E(a),b.registerE=a&255,8;case 28:return a=b.registerE,S(a,1),a=a+1&255,b.registerE=a,t(0===a),u(0),4;case 29:return a=b.registerE,S(a,-1),a=a-1&255,b.registerE=a,t(0===a),u(1),4;case 30:return b.registerE=F(),b.programCounter=b.programCounter+1&65535,4;
case 31:return a=1===(b.registerA&1),b.registerA=(b.registerA>>1|U()<<7)&255,K(a),t(0),u(0),G(0),4}return-1}function Fc(a){switch(a){case 32:return 0===Sa()?jb(F()):b.programCounter=b.programCounter+1&65535,8;case 33:return a=Y(),b.registerH=E(a),b.registerL=a&255,b.programCounter=b.programCounter+2&65535,4;case 34:return a=p(b.registerH,b.registerL),T(a,b.registerA),a=a+1&65535,b.registerH=E(a),b.registerL=a&255,4;case 35:return a=p(b.registerH,b.registerL),a=a+1&65535,b.registerH=E(a),b.registerL=
a&255,8;case 36:return a=b.registerH,S(a,1),a=a+1&255,b.registerH=a,t(0===a),u(0),4;case 37:return a=b.registerH,S(a,-1),a=a-1&255,b.registerH=a,t(0===a),u(1),4;case 38:return b.registerH=F(),b.programCounter=b.programCounter+1&65535,4;case 39:a=0;0<(b.registerF>>5&1)&&(a|=6);0<U()&&(a|=96);var c=b.registerA;0<(b.registerF>>6&1)?c=c-a&255:(9<(c&15)&&(a|=6),153<c&&(a|=96),c=c+a&255);t(0===c);K(0!==(a&96));G(0);b.registerA=c;return 4;case 40:return 0<Sa()?jb(F()):b.programCounter=b.programCounter+1&
65535,8;case 41:return a=p(b.registerH,b.registerL),Wa(a,a,!1),a=2*a&65535,b.registerH=E(a),b.registerL=a&255,u(0),8;case 42:return a=p(b.registerH,b.registerL),b.registerA=I(a),a=a+1&65535,b.registerH=E(a),b.registerL=a&255,4;case 43:return a=p(b.registerH,b.registerL),a=a-1&65535,b.registerH=E(a),b.registerL=a&255,8;case 44:return a=b.registerL,S(a,1),a=a+1&255,b.registerL=a,t(0===a),u(0),4;case 45:return a=b.registerL,S(a,-1),a=a-1&255,b.registerL=a,t(0===a),u(1),4;case 46:return b.registerL=F(),
b.programCounter=b.programCounter+1&65535,4;case 47:return b.registerA=~b.registerA,u(1),G(1),4}return-1}function Gc(a){switch(a){case 48:return 0===U()?jb(F()):b.programCounter=b.programCounter+1&65535,8;case 49:return b.stackPointer=Y(),b.programCounter=b.programCounter+2&65535,4;case 50:return a=p(b.registerH,b.registerL),T(a,b.registerA),a=a-1&65535,b.registerH=E(a),b.registerL=a&255,4;case 51:return b.stackPointer=b.stackPointer+1&65535,8;case 52:a=p(b.registerH,b.registerL);var c=I(a);S(c,1);
c=c+1&255;t(0===c);u(0);T(a,c);return 4;case 53:return a=p(b.registerH,b.registerL),c=I(a),S(c,-1),c=c-1&255,t(0===c),u(1),T(a,c),4;case 54:return T(p(b.registerH,b.registerL),F()),b.programCounter=b.programCounter+1&65535,4;case 55:return u(0),G(0),K(1),4;case 56:return 1===U()?jb(F()):b.programCounter=b.programCounter+1&65535,8;case 57:return a=p(b.registerH,b.registerL),Wa(a,b.stackPointer,!1),a=a+b.stackPointer&65535,b.registerH=E(a),b.registerL=a&255,u(0),8;case 58:return a=p(b.registerH,b.registerL),
b.registerA=I(a),a=a-1&65535,b.registerH=E(a),b.registerL=a&255,4;case 59:return b.stackPointer=b.stackPointer-1&65535,8;case 60:return a=b.registerA,S(a,1),a=a+1&255,b.registerA=a,t(0===a),u(0),4;case 61:return a=b.registerA,S(a,-1),a=a-1&255,b.registerA=a,t(0===a),u(1),4;case 62:return b.registerA=F(),b.programCounter=b.programCounter+1&65535,4;case 63:return u(0),G(0),K(0>=U()),4}return-1}function Hc(a){switch(a){case 64:return 4;case 65:return b.registerB=b.registerC,4;case 66:return b.registerB=
b.registerD,4;case 67:return b.registerB=b.registerE,4;case 68:return b.registerB=b.registerH,4;case 69:return b.registerB=b.registerL,4;case 70:return b.registerB=I(p(b.registerH,b.registerL)),4;case 71:return b.registerB=b.registerA,4;case 72:return b.registerC=b.registerB,4;case 73:return 4;case 74:return b.registerC=b.registerD,4;case 75:return b.registerC=b.registerE,4;case 76:return b.registerC=b.registerH,4;case 77:return b.registerC=b.registerL,4;case 78:return b.registerC=I(p(b.registerH,
b.registerL)),4;case 79:return b.registerC=b.registerA,4}return-1}function Ic(a){switch(a){case 80:return b.registerD=b.registerB,4;case 81:return b.registerD=b.registerC,4;case 82:return 4;case 83:return b.registerD=b.registerE,4;case 84:return b.registerD=b.registerH,4;case 85:return b.registerD=b.registerL,4;case 86:return b.registerD=I(p(b.registerH,b.registerL)),4;case 87:return b.registerD=b.registerA,4;case 88:return b.registerE=b.registerB,4;case 89:return b.registerE=b.registerC,4;case 90:return b.registerE=
b.registerD,4;case 91:return 4;case 92:return b.registerE=b.registerH,4;case 93:return b.registerE=b.registerL,4;case 94:return b.registerE=I(p(b.registerH,b.registerL)),4;case 95:return b.registerE=b.registerA,4}return-1}function Jc(a){switch(a){case 96:return b.registerH=b.registerB,4;case 97:return b.registerH=b.registerC,4;case 98:return b.registerH=b.registerD,4;case 99:return b.registerH=b.registerE,4;case 100:return b.registerH=b.registerH,4;case 101:return b.registerH=b.registerL,4;case 102:return b.registerH=
I(p(b.registerH,b.registerL)),4;case 103:return b.registerH=b.registerA,4;case 104:return b.registerL=b.registerB,4;case 105:return b.registerL=b.registerC,4;case 106:return b.registerL=b.registerD,4;case 107:return b.registerL=b.registerE,4;case 108:return b.registerL=b.registerH,4;case 109:return b.registerL=b.registerL,4;case 110:return b.registerL=I(p(b.registerH,b.registerL)),4;case 111:return b.registerL=b.registerA,4}return-1}function Kc(a){switch(a){case 112:return T(p(b.registerH,b.registerL),
b.registerB),4;case 113:return T(p(b.registerH,b.registerL),b.registerC),4;case 114:return T(p(b.registerH,b.registerL),b.registerD),4;case 115:return T(p(b.registerH,b.registerL),b.registerE),4;case 116:return T(p(b.registerH,b.registerL),b.registerH),4;case 117:return T(p(b.registerH,b.registerL),b.registerL),4;case 118:return h.isHblankHdmaActive||b.enableHalt(),4;case 119:return T(p(b.registerH,b.registerL),b.registerA),4;case 120:return b.registerA=b.registerB,4;case 121:return b.registerA=b.registerC,
4;case 122:return b.registerA=b.registerD,4;case 123:return b.registerA=b.registerE,4;case 124:return b.registerA=b.registerH,4;case 125:return b.registerA=b.registerL,4;case 126:return b.registerA=I(p(b.registerH,b.registerL)),4;case 127:return 4}return-1}function Lc(a){switch(a){case 128:return Ja(b.registerB),4;case 129:return Ja(b.registerC),4;case 130:return Ja(b.registerD),4;case 131:return Ja(b.registerE),4;case 132:return Ja(b.registerH),4;case 133:return Ja(b.registerL),4;case 134:return a=
I(p(b.registerH,b.registerL)),Ja(a),4;case 135:return Ja(b.registerA),4;case 136:return Ka(b.registerB),4;case 137:return Ka(b.registerC),4;case 138:return Ka(b.registerD),4;case 139:return Ka(b.registerE),4;case 140:return Ka(b.registerH),4;case 141:return Ka(b.registerL),4;case 142:return a=I(p(b.registerH,b.registerL)),Ka(a),4;case 143:return Ka(b.registerA),4}return-1}function Mc(a){switch(a){case 144:return La(b.registerB),4;case 145:return La(b.registerC),4;case 146:return La(b.registerD),4;
case 147:return La(b.registerE),4;case 148:return La(b.registerH),4;case 149:return La(b.registerL),4;case 150:return a=I(p(b.registerH,b.registerL)),La(a),4;case 151:return La(b.registerA),4;case 152:return Ma(b.registerB),4;case 153:return Ma(b.registerC),4;case 154:return Ma(b.registerD),4;case 155:return Ma(b.registerE),4;case 156:return Ma(b.registerH),4;case 157:return Ma(b.registerL),4;case 158:return a=I(p(b.registerH,b.registerL)),Ma(a),4;case 159:return Ma(b.registerA),4}return-1}function Nc(a){switch(a){case 160:return Na(b.registerB),
4;case 161:return Na(b.registerC),4;case 162:return Na(b.registerD),4;case 163:return Na(b.registerE),4;case 164:return Na(b.registerH),4;case 165:return Na(b.registerL),4;case 166:return a=I(p(b.registerH,b.registerL)),Na(a),4;case 167:return Na(b.registerA),4;case 168:return Oa(b.registerB),4;case 169:return Oa(b.registerC),4;case 170:return Oa(b.registerD),4;case 171:return Oa(b.registerE),4;case 172:return Oa(b.registerH),4;case 173:return Oa(b.registerL),4;case 174:return a=I(p(b.registerH,b.registerL)),
Oa(a),4;case 175:return Oa(b.registerA),4}return-1}function Oc(a){switch(a){case 176:return Pa(b.registerB),4;case 177:return Pa(b.registerC),4;case 178:return Pa(b.registerD),4;case 179:return Pa(b.registerE),4;case 180:return Pa(b.registerH),4;case 181:return Pa(b.registerL),4;case 182:return a=I(p(b.registerH,b.registerL)),Pa(a),4;case 183:return Pa(b.registerA),4;case 184:return Qa(b.registerB),4;case 185:return Qa(b.registerC),4;case 186:return Qa(b.registerD),4;case 187:return Qa(b.registerE),
4;case 188:return Qa(b.registerH),4;case 189:return Qa(b.registerL),4;case 190:return a=I(p(b.registerH,b.registerL)),Qa(a),4;case 191:return Qa(b.registerA),4}return-1}function Pc(a){switch(a){case 192:return 0===Sa()?(a=b.stackPointer,b.programCounter=Ha(a),b.stackPointer=a+2&65535,12):8;case 193:return a=Ha(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,b.registerB=E(a),b.registerC=a&255,4;case 194:if(0===Sa())return b.programCounter=Y(),8;b.programCounter=b.programCounter+2&65535;return 12;
case 195:return b.programCounter=Y(),8;case 196:if(0===Sa())return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,b.programCounter+2&65535),b.programCounter=Y(),8;b.programCounter=b.programCounter+2&65535;return 12;case 197:return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,p(b.registerB,b.registerC)),8;case 198:return Ja(F()),b.programCounter=b.programCounter+1&65535,4;case 199:return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,b.programCounter),b.programCounter=0,8;case 200:return 1===Sa()?(a=
b.stackPointer,b.programCounter=Ha(a),b.stackPointer=a+2&65535,12):8;case 201:return a=b.stackPointer,b.programCounter=Ha(a),b.stackPointer=a+2&65535,8;case 202:if(1===Sa())return b.programCounter=Y(),8;b.programCounter=b.programCounter+2&65535;return 12;case 203:var c=F();a=-1;var d=!1,e=0,f=0,g=c&7;switch(g){case 0:e=b.registerB;break;case 1:e=b.registerC;break;case 2:e=b.registerD;break;case 3:e=b.registerE;break;case 4:e=b.registerH;break;case 5:e=b.registerL;break;case 6:e=I(p(b.registerH,b.registerL));
break;case 7:e=b.registerA}var h=(c&240)>>4;switch(h){case 0:7>=c?(c=e,K(128===(c&128)),c=(c<<1|c>>7)&255,t(0===c),u(0),G(0),f=c,d=!0):15>=c&&(c=e,K(0<(c&1)),c=(c>>1|c<<7)&255,t(0===c),u(0),G(0),f=c,d=!0);break;case 1:23>=c?(c=e,d=128===(c&128),c=(c<<1|U())&255,K(d),t(0===c),u(0),G(0),f=c,d=!0):31>=c&&(c=e,d=1===(c&1),c=(c>>1|U()<<7)&255,K(d),t(0===c),u(0),G(0),f=c,d=!0);break;case 2:39>=c?(c=e,d=128===(c&128),c=c<<1&255,K(d),t(0===c),u(0),G(0),f=c,d=!0):47>=c&&(c=e,d=128===(c&128),e=1===(c&1),c=
c>>1&255,d&&(c|=128),t(0===c),u(0),G(0),K(e),f=c,d=!0);break;case 3:55>=c?(c=e,c=((c&15)<<4|(c&240)>>4)&255,t(0===c),u(0),G(0),K(0),f=c,d=!0):63>=c&&(c=e,d=1===(c&1),c=c>>1&255,t(0===c),u(0),G(0),K(d),f=c,d=!0);break;case 4:71>=c?(f=Ua(0,e),d=!0):79>=c&&(f=Ua(1,e),d=!0);break;case 5:87>=c?(f=Ua(2,e),d=!0):95>=c&&(f=Ua(3,e),d=!0);break;case 6:103>=c?(f=Ua(4,e),d=!0):111>=c&&(f=Ua(5,e),d=!0);break;case 7:119>=c?(f=Ua(6,e),d=!0):127>=c&&(f=Ua(7,e),d=!0);break;case 8:135>=c?(f=ba(0,0,e),d=!0):143>=c&&
(f=ba(1,0,e),d=!0);break;case 9:151>=c?(f=ba(2,0,e),d=!0):159>=c&&(f=ba(3,0,e),d=!0);break;case 10:167>=c?(f=ba(4,0,e),d=!0):175>=c&&(f=ba(5,0,e),d=!0);break;case 11:183>=c?(f=ba(6,0,e),d=!0):191>=c&&(f=ba(7,0,e),d=!0);break;case 12:199>=c?(f=ba(0,1,e),d=!0):207>=c&&(f=ba(1,1,e),d=!0);break;case 13:215>=c?(f=ba(2,1,e),d=!0):223>=c&&(f=ba(3,1,e),d=!0);break;case 14:231>=c?(f=ba(4,1,e),d=!0):239>=c&&(f=ba(5,1,e),d=!0);break;case 15:247>=c?(f=ba(6,1,e),d=!0):255>=c&&(f=ba(7,1,e),d=!0)}switch(g){case 0:b.registerB=
f;break;case 1:b.registerC=f;break;case 2:b.registerD=f;break;case 3:b.registerE=f;break;case 4:b.registerH=f;break;case 5:b.registerL=f;break;case 6:(4>h||7<h)&&T(p(b.registerH,b.registerL),f);break;case 7:b.registerA=f}d&&(a=4);b.programCounter=b.programCounter+1&65535;return a;case 204:if(1===Sa())return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,b.programCounter+2),b.programCounter=Y(),8;b.programCounter=b.programCounter+2&65535;return 12;case 205:return a=b.stackPointer-2&65535,b.stackPointer=
a,V(a,b.programCounter+2&65535),b.programCounter=Y(),8;case 206:return Ka(F()),b.programCounter=b.programCounter+1&65535,4;case 207:return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,b.programCounter),b.programCounter=8}return-1}function Qc(a){switch(a){case 208:return 0===U()?(a=b.stackPointer,b.programCounter=Ha(a),b.stackPointer=a+2&65535,12):8;case 209:a=b.stackPointer;var c=Ha(a);b.stackPointer=a+2&65535;b.registerD=E(c);b.registerE=c&255;return 4;case 210:if(0===U())return b.programCounter=
Y(),8;b.programCounter=b.programCounter+2&65535;return 12;case 212:if(0===U())return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,b.programCounter+2),b.programCounter=Y(),8;b.programCounter=b.programCounter+2&65535;return 12;case 213:return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,p(b.registerD,b.registerE)),8;case 214:return La(F()),b.programCounter=b.programCounter+1&65535,4;case 215:return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,b.programCounter),b.programCounter=16,8;case 216:return 1===
U()?(a=b.stackPointer,b.programCounter=Ha(a),b.stackPointer=a+2&65535,12):8;case 217:return a=b.stackPointer,b.programCounter=Ha(a),vb(!0),b.stackPointer=a+2&65535,8;case 218:if(1===U())return b.programCounter=Y(),8;b.programCounter=b.programCounter+2&65535;return 12;case 220:if(1===U())return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,b.programCounter+2&65535),b.programCounter=Y(),8;b.programCounter=b.programCounter+2&65535;return 12;case 222:return Ma(F()),b.programCounter=b.programCounter+1&
65535,4;case 223:return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,b.programCounter),b.programCounter=24,8}return-1}function Rc(a){switch(a){case 224:return a=F(),T(65280+a,b.registerA),b.programCounter=b.programCounter+1&65535,4;case 225:a=b.stackPointer;var c=Ha(a);b.stackPointer=a+2&65535;b.registerH=E(c);b.registerL=c&255;return 4;case 226:return T(65280+b.registerC,b.registerA),4;case 229:return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,p(b.registerH,b.registerL)),8;case 230:return Na(F()),
b.programCounter=b.programCounter+1&65535,4;case 231:return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,b.programCounter),b.programCounter=32,8;case 232:return a=F()<<24>>24,Wa(b.stackPointer,a,!0),b.stackPointer=b.stackPointer+a&65535,t(0),u(0),b.programCounter=b.programCounter+1&65535,12;case 233:return b.programCounter=p(b.registerH,b.registerL),4;case 234:return T(Y(),b.registerA),b.programCounter=b.programCounter+2&65535,4;case 238:return Oa(F()),b.programCounter=b.programCounter+1&65535,4;
case 239:return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,b.programCounter),b.programCounter=40,8}return-1}function Sc(a){switch(a){case 240:return a=F(),b.registerA=I(65280+a)&255,b.programCounter=b.programCounter+1&65535,4;case 241:a=b.stackPointer;var c=Ha(a);b.stackPointer=a+2&65535;b.registerA=E(c);b.registerF=c&255;return 4;case 242:return b.registerA=I(65280+b.registerC)&255,4;case 243:return vb(!1),4;case 245:return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,p(b.registerA,b.registerF)),
8;case 246:return Pa(F()),b.programCounter=b.programCounter+1&65535,4;case 247:return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,b.programCounter),b.programCounter=48,8;case 248:return c=F()<<24>>24,a=b.stackPointer,t(0),u(0),Wa(a,c,!0),a=a+c&65535,b.registerH=E(a),b.registerL=a&255,b.programCounter=b.programCounter+1&65535,8;case 249:return b.stackPointer=p(b.registerH,b.registerL),8;case 250:return b.registerA=I(Y()),b.programCounter=b.programCounter+2&65535,4;case 251:return vb(!0),4;case 254:return Qa(F()),
b.programCounter=b.programCounter+1&65535,4;case 255:return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,b.programCounter),b.programCounter=56,8}return-1}function Ra(a){0<h.DMACycles&&(a+=h.DMACycles,h.DMACycles=0);b.currentCycles+=a;if(!b.isStopped){if(R.graphicsBatchProcessing){r.currentCycles+=a;for(var c=r.batchProcessCycles();r.currentCycles>=c;)oc(c),r.currentCycles-=c}else oc(a);R.audioBatchProcessing?(m.currentCycles+=a,hb()):ec(a);c=a;if(Z.transferStartFlag)for(var d=0;d<c;){var e=Z.currentCycles,
f=e;d+=4;f+=4;65535<f&&(f-=65536);Z.currentCycles=f;var l=Z.isClockSpeedFast?2:7;n(l,e)&&!n(l,f)&&(e=Z.memoryLocationSerialTransferData,f=x(e),f=(f<<1)+1,f&=255,g(e,f),e=Z.numberOfBitsTransferred,8===++e?(Z.numberOfBitsTransferred=0,k.isSerialInterruptRequested=!0,bb(k.bitPositionSerialInterrupt),e=Z.memoryLocationSerialTransferControl,f=x(e),g(e,H(7,f)),Z.transferStartFlag=!1):Z.numberOfBitsTransferred=e)}}R.timersBatchProcessing?(q.currentCycles+=a,Jb(q.currentCycles),q.currentCycles=0):Jb(a);c=
da.cycles;c+=a;c>=da.cyclesPerCycleSet&&(da.cycleSets+=1,c-=da.cyclesPerCycleSet);da.cycles=c}function qc(){return Sb(!0,-1)}function Sb(a,c){void 0===c&&(c=-1);a=1024;0<c?a=c:0>c&&(a=-1);for(var d=!1,e=!1,f=!1;!(d||e||f||aa.reachedBreakpoint);)c=rc(),0>c?d=!0:b.currentCycles>=b.MAX_CYCLES_PER_FRAME()?e=!0:-1<a&&fc()>=a&&(f=!0);if(e)return b.currentCycles-=b.MAX_CYCLES_PER_FRAME(),W.RESPONSE_CONDITION_FRAME;if(f)return W.RESPONSE_CONDITION_AUDIO;if(aa.reachedBreakpoint)return aa.reachedBreakpoint=
!1,W.RESPONSE_CONDITION_BREAKPOINT;b.programCounter=b.programCounter-1&65535;return-1}function rc(){kb=!0;if(b.isHaltBug){var a=x(b.programCounter);a=pc(a);Ra(a);b.exitHaltAndStop()}k.masterInterruptSwitchDelay&&(k.masterInterruptSwitch=!0,k.masterInterruptSwitchDelay=!1);if(0<(k.interruptsEnabledValue&k.interruptsRequestedValue&31)){a=!1;k.masterInterruptSwitch&&!b.isHaltNoJump&&(k.isVBlankInterruptEnabled&&k.isVBlankInterruptRequested?(ib(k.bitPositionVBlankInterrupt),a=!0):k.isLcdInterruptEnabled&&
k.isLcdInterruptRequested?(ib(k.bitPositionLcdInterrupt),a=!0):k.isTimerInterruptEnabled&&k.isTimerInterruptRequested?(ib(k.bitPositionTimerInterrupt),a=!0):k.isSerialInterruptEnabled&&k.isSerialInterruptRequested?(ib(k.bitPositionSerialInterrupt),a=!0):k.isJoypadInterruptEnabled&&k.isJoypadInterruptRequested&&(ib(k.bitPositionJoypadInterrupt),a=!0));var c=0;a&&(c=20,b.isHalted()&&(b.exitHaltAndStop(),c+=4));b.isHalted()&&b.exitHaltAndStop();a=c}else a=0;0<a&&Ra(a);a=4;b.isHalted()||b.isStopped||
(a=x(b.programCounter),a=pc(a));b.registerF&=240;if(0>=a)return a;Ra(a);c=W.steps;c+=1;c>=W.stepsPerStepSet&&(W.stepSets+=1,c-=W.stepsPerStepSet);W.steps=c;b.programCounter===aa.programCounter&&(aa.reachedBreakpoint=!0);return a}function Tc(a){const c="undefined"!==typeof window?performance.now():Date.now();for(;a.fpsTimeStamps[0]<c-1E3;)a.fpsTimeStamps.shift();a.fpsTimeStamps.push(c);a.timeStampsUntilReady--;0>a.timeStampsUntilReady&&(a.timeStampsUntilReady=0);return c}function Tb(a){a.timeStampsUntilReady=
90>=a.options.gameboyFrameRate?1.25*Math.floor(a.options.gameboyFrameRate):120}function sc(a){const c=a.wasmByteMemory.slice(a.WASMBOY_CURRENT_FRAME_OUTPUT_LOCATION,a.WASMBOY_CURRENT_FRAME_OUTPUT_LOCATION+a.WASMBOY_CURRENT_FRAME_SIZE).buffer;a.graphicsWorkerPort.postMessage(M({type:y.UPDATED,graphicsFrameBuffer:c}),[c])}function tc(a){var c=("undefined"!==typeof window?performance.now():Date.now())-a.fpsTimeStamps[a.fpsTimeStamps.length-1];c=uc-c;0>c&&(c=0);a.speed&&0<a.speed&&(c/=a.speed);a.updateId=
setTimeout(()=>{vc(a)},Math.floor(c))}function vc(a,c){if(a.paused)return!0;void 0!==c&&(uc=c);lb=a.getFPS();yb=a.options.gameboyFrameRate+1;a.speed&&0<a.speed&&(yb*=a.speed);if(lb>yb)return a.fpsTimeStamps.shift(),tc(a),!0;Tc(a);const b=!a.options.headless&&!a.pauseFpsThrottle&&a.options.isAudioEnabled;(new Promise((c)=>{let d;b?Ub(a,c):(d=a.wasmInstance.exports.executeFrame(),c(d))})).then((c)=>{if(0<=c){ea(M({type:y.UPDATED,fps:lb}));let b=!1;a.options.frameSkip&&0<a.options.frameSkip&&(a.frameSkipCounter++,
a.frameSkipCounter<=a.options.frameSkip?b=!0:a.frameSkipCounter=0);b||sc(a);const d={type:y.UPDATED};d[z.CARTRIDGE_RAM]=Yb(a).buffer;d[z.GAMEBOY_MEMORY]=a.wasmByteMemory.slice(a.WASMBOY_INTERNAL_MEMORY_LOCATION,a.WASMBOY_INTERNAL_MEMORY_LOCATION+a.WASMBOY_INTERNAL_MEMORY_SIZE).buffer;d[z.PALETTE_MEMORY]=a.wasmByteMemory.slice(a.WASMBOY_PALETTE_MEMORY_LOCATION,a.WASMBOY_PALETTE_MEMORY_LOCATION+a.WASMBOY_PALETTE_MEMORY_SIZE).buffer;d[z.INTERNAL_STATE]=Zb(a).buffer;Object.keys(d).forEach((a)=>{void 0===
d[a]&&(d[a]=(new Uint8Array).buffer)});a.memoryWorkerPort.postMessage(M(d),[d[z.CARTRIDGE_RAM],d[z.GAMEBOY_MEMORY],d[z.PALETTE_MEMORY],d[z.INTERNAL_STATE]]);2===c?ea(M({type:y.BREAKPOINT})):tc(a)}else ea(M({type:y.CRASHED})),a.paused=!0})}function Ub(a,c){var b=-1;b=a.wasmInstance.exports.executeFrameAndCheckAudio(1024);1!==b&&c(b);if(1===b){b=a.wasmInstance.exports.getNumberOfSamplesInAudioBuffer();const d=lb>=yb;.25<a.currentAudioLatencyInSeconds&&d?(wc(a,b),setTimeout(()=>{Tb(a);Ub(a,c)},Math.floor(Math.floor(1E3*
(a.currentAudioLatencyInSeconds-.25))/10))):(wc(a,b),Ub(a,c))}}function wc(a,c){var b=a.wasmByteMemory.slice(a.WASMBOY_SOUND_OUTPUT_LOCATION,a.WASMBOY_SOUND_OUTPUT_LOCATION+2*c).buffer;const d={type:y.UPDATED,audioBuffer:b,numberOfSamples:c,fps:lb,allowFastSpeedStretching:60<a.options.gameboyFrameRate};b=[b];if(a.options&&a.options.enableAudioDebugging){var e=a.wasmByteMemory.slice(a.WASMBOY_CHANNEL_1_OUTPUT_LOCATION,a.WASMBOY_CHANNEL_1_OUTPUT_LOCATION+2*c).buffer;d.channel1Buffer=e;b.push(e);e=a.wasmByteMemory.slice(a.WASMBOY_CHANNEL_2_OUTPUT_LOCATION,
a.WASMBOY_CHANNEL_2_OUTPUT_LOCATION+2*c).buffer;d.channel2Buffer=e;b.push(e);e=a.wasmByteMemory.slice(a.WASMBOY_CHANNEL_3_OUTPUT_LOCATION,a.WASMBOY_CHANNEL_3_OUTPUT_LOCATION+2*c).buffer;d.channel3Buffer=e;b.push(e);c=a.wasmByteMemory.slice(a.WASMBOY_CHANNEL_4_OUTPUT_LOCATION,a.WASMBOY_CHANNEL_4_OUTPUT_LOCATION+2*c).buffer;d.channel4Buffer=c;b.push(c)}a.audioWorkerPort.postMessage(M(d),b);a.wasmInstance.exports.clearAudioBuffer()}const nb="undefined"!==typeof self;let Bb;nb||(Bb=require("worker_threads").parentPort);
const y={CONNECT:"CONNECT",INSTANTIATE_WASM:"INSTANTIATE_WASM",CLEAR_MEMORY:"CLEAR_MEMORY",CLEAR_MEMORY_DONE:"CLEAR_MEMORY_DONE",GET_MEMORY:"GET_MEMORY",SET_MEMORY:"SET_MEMORY",SET_MEMORY_DONE:"SET_MEMORY_DONE",GET_CONSTANTS:"GET_CONSTANTS",GET_CONSTANTS_DONE:"GET_CONSTANTS_DONE",CONFIG:"CONFIG",RESET_AUDIO_QUEUE:"RESET_AUDIO_QUEUE",PLAY:"PLAY",BREAKPOINT:"BREAKPOINT",PAUSE:"PAUSE",UPDATED:"UPDATED",CRASHED:"CRASHED",SET_JOYPAD_STATE:"SET_JOYPAD_STATE",AUDIO_LATENCY:"AUDIO_LATENCY",RUN_WASM_EXPORT:"RUN_WASM_EXPORT",
GET_WASM_MEMORY_SECTION:"GET_WASM_MEMORY_SECTION",GET_WASM_CONSTANT:"GET_WASM_CONSTANT",FORCE_OUTPUT_FRAME:"FORCE_OUTPUT_FRAME",SET_SPEED:"SET_SPEED",IS_GBC:"IS_GBC"},z={BOOT_ROM:"BOOT_ROM",CARTRIDGE_RAM:"CARTRIDGE_RAM",CARTRIDGE_ROM:"CARTRIDGE_ROM",CARTRIDGE_HEADER:"CARTRIDGE_HEADER",GAMEBOY_MEMORY:"GAMEBOY_MEMORY",PALETTE_MEMORY:"PALETTE_MEMORY",INTERNAL_STATE:"INTERNAL_STATE"};let ob=0;const e=new Uint8ClampedArray(9109504),mb={size:()=>9109504,grow:()=>{},wasmByteMemory:e};var Uc=65536,Ya=67584,
Za=Ya+128,cb=Za+23552,zb=cb+93184,Vb=zb+196608,Ab=Vb+147456,Vc=Ya,Wc=Ab-Ya+15360,Fb=Ab+15360,Gb=Fb+131072,Hb=Gb+131072,Ib=Hb+131072,ub=Ib+131072,Pb=ub+131072,wb=Pb+131072,xb=wb+2560,Wb=xb+8258560,xc=Wb+65535+1,Xb=Math.ceil(xc/1024/64)+1,R=function(){function a(){}a.enableBootRom=!1;a.useGbcWhenAvailable=!0;a.audioBatchProcessing=!1;a.graphicsBatchProcessing=!1;a.timersBatchProcessing=!1;a.graphicsDisableScanlineRendering=!1;a.audioAccumulateSamples=!1;a.tileRendering=!1;a.tileCaching=!1;a.enableAudioDebugging=
!1;return a}(),L=function(){function a(){}a.bgWhite=15921906;a.bgLightGrey=10526880;a.bgDarkGrey=5789784;a.bgBlack=526344;a.obj0White=15921906;a.obj0LightGrey=10526880;a.obj0DarkGrey=5789784;a.obj0Black=526344;a.obj1White=15921906;a.obj1LightGrey=10526880;a.obj1DarkGrey=5789784;a.obj1Black=526344;return a}(),la=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=5439232;a.bgDarkGrey=16728576;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=5439232;a.obj0DarkGrey=16728576;a.obj0Black=0;a.obj1White=
16777215;a.obj1LightGrey=5439232;a.obj1DarkGrey=16728576;a.obj1Black=0;return a}(),pa=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=16776960;a.bgDarkGrey=16711680;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=16776960;a.obj0DarkGrey=16711680;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=16776960;a.obj1DarkGrey=16711680;a.obj1Black=0;return a}(),ia=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=16756067;a.bgDarkGrey=8663296;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=
16756067;a.obj0DarkGrey=8663296;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=16756067;a.obj1DarkGrey=8663296;a.obj1Black=0;return a}(),na=function(){function a(){}a.bgWhite=0;a.bgLightGrey=33924;a.bgDarkGrey=16768512;a.bgBlack=16777215;a.obj0White=0;a.obj0LightGrey=33924;a.obj0DarkGrey=16768512;a.obj0Black=16777215;a.obj1White=0;a.obj1LightGrey=33924;a.obj1DarkGrey=16768512;a.obj1Black=16777215;return a}(),ta=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=10855845;a.bgDarkGrey=5395026;
a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=10855845;a.obj0DarkGrey=5395026;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=10855845;a.obj1DarkGrey=5395026;a.obj1Black=0;return a}(),oa=function(){function a(){}a.bgWhite=16777125;a.bgLightGrey=16749716;a.bgDarkGrey=9737471;a.bgBlack=0;a.obj0White=16777125;a.obj0LightGrey=16749716;a.obj0DarkGrey=9737471;a.obj0Black=0;a.obj1White=16777125;a.obj1LightGrey=16749716;a.obj1DarkGrey=9737471;a.obj1Black=0;return a}(),ka=function(){function a(){}a.bgWhite=
16770757;a.bgLightGrey=13540484;a.bgDarkGrey=8678185;a.bgBlack=5910792;a.obj0White=16777215;a.obj0LightGrey=16756067;a.obj0DarkGrey=8663296;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=16756067;a.obj1DarkGrey=8663296;a.obj1Black=0;return a}(),ma=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=8126257;a.bgDarkGrey=25541;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=16745604;a.obj0DarkGrey=9714234;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=16745604;a.obj1DarkGrey=9714234;
a.obj1Black=0;return a}(),sa=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=9211102;a.bgDarkGrey=5395084;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=16745604;a.obj0DarkGrey=9714234;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=16756067;a.obj1DarkGrey=8663296;a.obj1Black=0;return a}(),ja=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=16745604;a.bgDarkGrey=9714234;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=8126257;a.obj0DarkGrey=33792;a.obj0Black=0;a.obj1White=
16777215;a.obj1LightGrey=6530559;a.obj1DarkGrey=255;a.obj1Black=0;return a}(),ra=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=6530559;a.bgDarkGrey=255;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=16745604;a.obj0DarkGrey=9714234;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=8126257;a.obj1DarkGrey=33792;a.obj1Black=0;return a}(),qa=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=16776960;a.bgDarkGrey=8079872;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=6530559;a.obj0DarkGrey=
255;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=8126257;a.obj1DarkGrey=33792;a.obj1Black=0;return a}(),va=function(){function a(){}a.bgWhite=10853631;a.bgLightGrey=16776960;a.bgDarkGrey=25344;a.bgBlack=0;a.obj0White=10853631;a.obj0LightGrey=16776960;a.obj0DarkGrey=25344;a.obj0Black=0;a.obj1White=10853631;a.obj1LightGrey=16776960;a.obj1DarkGrey=25344;a.obj1Black=0;return a}(),wa=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=6530559;a.bgDarkGrey=255;a.bgBlack=0;a.obj0White=16777215;
a.obj0LightGrey=16745604;a.obj0DarkGrey=9714234;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=6530559;a.obj1DarkGrey=255;a.obj1Black=0;return a}(),xa=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=16745604;a.bgDarkGrey=9714234;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=8126257;a.obj0DarkGrey=33792;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=16745604;a.obj1DarkGrey=9714234;a.obj1Black=0;return a}(),ya=function(){function a(){}a.bgWhite=11908607;a.bgLightGrey=16777108;a.bgDarkGrey=
11360834;a.bgBlack=0;a.obj0White=0;a.obj0LightGrey=16777215;a.obj0DarkGrey=16745604;a.obj0Black=9714234;a.obj1White=0;a.obj1LightGrey=16777215;a.obj1DarkGrey=16745604;a.obj1Black=9714234;return a}(),za=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=11382148;a.bgDarkGrey=4354939;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=16741120;a.obj0DarkGrey=9716224;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=5946879;a.obj1DarkGrey=16711680;a.obj1Black=255;return a}(),Aa=function(){function a(){}
a.bgWhite=16777116;a.bgLightGrey=9745919;a.bgDarkGrey=6526067;a.bgBlack=14906;a.obj0White=16762178;a.obj0LightGrey=16766464;a.obj0DarkGrey=9714176;a.obj0Black=4849664;a.obj1White=16777215;a.obj1LightGrey=16745604;a.obj1DarkGrey=9714234;a.obj1Black=0;return a}(),Ba=function(){function a(){}a.bgWhite=7077632;a.bgLightGrey=16777215;a.bgDarkGrey=16732746;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=16777215;a.obj0DarkGrey=6530559;a.obj0Black=255;a.obj1White=16777215;a.obj1LightGrey=16756067;a.obj1DarkGrey=
8663296;a.obj1Black=0;return a}(),Ca=function(){function a(){}a.bgWhite=10853631;a.bgLightGrey=16776960;a.bgDarkGrey=25344;a.bgBlack=0;a.obj0White=16737106;a.obj0LightGrey=14024704;a.obj0DarkGrey=6488064;a.obj0Black=0;a.obj1White=255;a.obj1LightGrey=16777215;a.obj1DarkGrey=16777083;a.obj1Black=34047;return a}(),Da=function(){function a(){}a.bgWhite=16777166;a.bgLightGrey=6549487;a.bgDarkGrey=10257457;a.bgBlack=5921370;a.obj0White=16777215;a.obj0LightGrey=16741120;a.obj0DarkGrey=9716224;a.obj0Black=
0;a.obj1White=16777215;a.obj1LightGrey=6530559;a.obj1DarkGrey=255;a.obj1Black=0;return a}(),Ea=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=16745604;a.bgDarkGrey=9714234;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=65280;a.obj0DarkGrey=3245056;a.obj0Black=18944;a.obj1White=16777215;a.obj1LightGrey=6530559;a.obj1DarkGrey=255;a.obj1Black=0;return a}(),Fa=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=6530559;a.bgDarkGrey=255;a.bgBlack=0;a.obj0White=16776960;a.obj0LightGrey=
16711680;a.obj0DarkGrey=6488064;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=8126257;a.obj1DarkGrey=33792;a.obj1Black=0;return a}(),Ga=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=11382148;a.bgDarkGrey=4354939;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=16756067;a.obj0DarkGrey=16756067;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=6530559;a.obj1DarkGrey=255;a.obj1Black=0;return a}(),d=function(){function a(){}a.bgWhite=L.bgWhite;a.bgLightGrey=L.bgLightGrey;a.bgDarkGrey=
L.bgDarkGrey;a.bgBlack=L.bgBlack;a.obj0White=L.obj0White;a.obj0LightGrey=L.obj0LightGrey;a.obj0DarkGrey=L.obj0DarkGrey;a.obj0Black=L.obj0Black;a.obj1White=L.obj1White;a.obj1LightGrey=L.obj1LightGrey;a.obj1DarkGrey=L.obj1DarkGrey;a.obj1Black=L.obj1Black;return a}(),Xa=function(){function a(){}a.memoryLocationBackgroundPaletteIndex=65384;a.memoryLocationBackgroundPaletteData=65385;a.memoryLocationSpritePaletteIndex=65386;a.memoryLocationSpritePaletteData=65387;a.memoryLocationBackgroundPalette=65351;
a.memoryLocationSpritePaletteOne=65352;a.memoryLocationSpritePaletteTwo=65353;return a}(),db=function(){function a(){}a.tileId=-1;a.horizontalFlip=!1;a.nextXIndexToPerformCacheCheck=-1;return a}(),B=function(){function a(){}a.updateNRx0=function(c){a.NRx0SweepPeriod=(c&112)>>4;a.NRx0Negate=n(3,c);a.NRx0SweepShift=c&7};a.updateNRx1=function(c){a.NRx1Duty=c>>6&3;a.NRx1LengthLoad=c&63;a.lengthCounter=64-a.NRx1LengthLoad};a.updateNRx2=function(c){a.NRx2StartingVolume=c>>4&15;a.NRx2EnvelopeAddMode=n(3,
c);a.NRx2EnvelopePeriod=c&7;a.isDacEnabled=0<(c&248)};a.updateNRx3=function(c){a.NRx3FrequencyLSB=c;a.frequency=a.NRx4FrequencyMSB<<8|c};a.updateNRx4=function(c){a.NRx4LengthEnabled=n(6,c);c&=7;a.NRx4FrequencyMSB=c;a.frequency=c<<8|a.NRx3FrequencyLSB};a.saveState=function(){e[1024+50*a.saveStateSlot]=a.isEnabled;e[1025+50*a.saveStateSlot]=a.frequencyTimer;e[1029+50*a.saveStateSlot]=a.envelopeCounter;e[1033+50*a.saveStateSlot]=a.lengthCounter;e[1038+50*a.saveStateSlot]=a.volume;e[1043+50*a.saveStateSlot]=
a.dutyCycle;e[1044+50*a.saveStateSlot]=a.waveFormPositionOnDuty;e[1049+50*a.saveStateSlot]=a.isSweepEnabled;e[1050+50*a.saveStateSlot]=a.sweepCounter;e[1055+50*a.saveStateSlot]=a.sweepShadowFrequency};a.loadState=function(){a.isEnabled=Q(1024+50*a.saveStateSlot);a.frequencyTimer=e[1025+50*a.saveStateSlot];a.envelopeCounter=e[1029+50*a.saveStateSlot];a.lengthCounter=e[1033+50*a.saveStateSlot];a.volume=e[1038+50*a.saveStateSlot];a.dutyCycle=e[1043+50*a.saveStateSlot];a.waveFormPositionOnDuty=e[1044+
50*a.saveStateSlot];a.isSweepEnabled=Q(1049+50*a.saveStateSlot);a.sweepCounter=e[1050+50*a.saveStateSlot];a.sweepShadowFrequency=e[1055+50*a.saveStateSlot]};a.initialize=function(){g(a.memoryLocationNRx0,128);g(a.memoryLocationNRx1,191);g(a.memoryLocationNRx2,243);g(a.memoryLocationNRx3,193);g(a.memoryLocationNRx4,191);b.BootROMEnabled&&(g(a.memoryLocationNRx1,63),g(a.memoryLocationNRx2,0),g(a.memoryLocationNRx3,0),g(a.memoryLocationNRx4,184))};a.getSampleFromCycleCounter=function(){var c=a.cycleCounter;
a.cycleCounter=0;return a.getSample(c)};a.resetTimer=function(){var c=2048-a.frequency<<2;b.GBCDoubleSpeed&&(c<<=2);a.frequencyTimer=c};a.getSample=function(c){c=a.frequencyTimer-c;if(0>=c){var b=Math.abs(c);a.frequencyTimer=c;a.resetTimer();a.frequencyTimer-=b;a.waveFormPositionOnDuty=a.waveFormPositionOnDuty+1&7}else a.frequencyTimer=c;if(a.isEnabled&&a.isDacEnabled)c=a.volume;else return 15;b=1;bc(a.NRx1Duty,a.waveFormPositionOnDuty)||(b=-b);return b*c+15};a.trigger=function(){a.isEnabled=!0;0===
a.lengthCounter&&(a.lengthCounter=64);a.resetTimer();a.envelopeCounter=a.NRx2EnvelopePeriod;a.volume=a.NRx2StartingVolume;a.sweepShadowFrequency=a.frequency;a.sweepCounter=a.NRx0SweepPeriod;a.isSweepEnabled=0<a.NRx0SweepPeriod&&0<a.NRx0SweepShift;0<a.NRx0SweepShift&&cc();a.isDacEnabled||(a.isEnabled=!1)};a.willChannelUpdate=function(c){c=a.cycleCounter+c;a.cycleCounter=c;return!(0<a.frequencyTimer-c)};a.updateSweep=function(){var c=a.sweepCounter-1;0>=c?(a.sweepCounter=a.NRx0SweepPeriod,a.isSweepEnabled&&
0<a.NRx0SweepPeriod&&cc()):a.sweepCounter=c};a.updateLength=function(){var c=a.lengthCounter;0<c&&a.NRx4LengthEnabled&&--c;0===c&&(a.isEnabled=!1);a.lengthCounter=c};a.updateEnvelope=function(){var c=a.envelopeCounter-1;if(0>=c&&(c=a.NRx2EnvelopePeriod,0!==c)){var b=a.volume;a.NRx2EnvelopeAddMode&&15>b?b+=1:!a.NRx2EnvelopeAddMode&&0<b&&--b;a.volume=b}a.envelopeCounter=c};a.setFrequency=function(c){var b=c>>8;c&=255;var d=x(a.memoryLocationNRx4)&248|b;g(a.memoryLocationNRx3,c);g(a.memoryLocationNRx4,
d);a.NRx3FrequencyLSB=c;a.NRx4FrequencyMSB=b;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.cycleCounter=0;a.memoryLocationNRx0=65296;a.NRx0SweepPeriod=0;a.NRx0Negate=!1;a.NRx0SweepShift=0;a.memoryLocationNRx1=65297;a.NRx1Duty=0;a.NRx1LengthLoad=0;a.memoryLocationNRx2=65298;a.NRx2StartingVolume=0;a.NRx2EnvelopeAddMode=!1;a.NRx2EnvelopePeriod=0;a.memoryLocationNRx3=65299;a.NRx3FrequencyLSB=0;a.memoryLocationNRx4=65300;a.NRx4LengthEnabled=!1;a.NRx4FrequencyMSB=0;a.channelNumber=1;a.isEnabled=
!1;a.isDacEnabled=!1;a.frequency=0;a.frequencyTimer=0;a.envelopeCounter=0;a.lengthCounter=0;a.volume=0;a.dutyCycle=0;a.waveFormPositionOnDuty=0;a.isSweepEnabled=!1;a.sweepCounter=0;a.sweepShadowFrequency=0;a.saveStateSlot=7;return a}(),O=function(){function a(){}a.updateNRx1=function(c){a.NRx1Duty=c>>6&3;a.NRx1LengthLoad=c&63;a.lengthCounter=64-a.NRx1LengthLoad};a.updateNRx2=function(c){a.NRx2StartingVolume=c>>4&15;a.NRx2EnvelopeAddMode=n(3,c);a.NRx2EnvelopePeriod=c&7;a.isDacEnabled=0<(c&248)};a.updateNRx3=
function(c){a.NRx3FrequencyLSB=c;a.frequency=a.NRx4FrequencyMSB<<8|c};a.updateNRx4=function(c){a.NRx4LengthEnabled=n(6,c);c&=7;a.NRx4FrequencyMSB=c;a.frequency=c<<8|a.NRx3FrequencyLSB};a.saveState=function(){e[1024+50*a.saveStateSlot]=a.isEnabled;e[1025+50*a.saveStateSlot]=a.frequencyTimer;e[1029+50*a.saveStateSlot]=a.envelopeCounter;e[1033+50*a.saveStateSlot]=a.lengthCounter;e[1038+50*a.saveStateSlot]=a.volume;e[1043+50*a.saveStateSlot]=a.dutyCycle;e[1044+50*a.saveStateSlot]=a.waveFormPositionOnDuty};
a.loadState=function(){a.isEnabled=Q(1024+50*a.saveStateSlot);a.frequencyTimer=e[1025+50*a.saveStateSlot];a.envelopeCounter=e[1029+50*a.saveStateSlot];a.lengthCounter=e[1033+50*a.saveStateSlot];a.volume=e[1038+50*a.saveStateSlot];a.dutyCycle=e[1043+50*a.saveStateSlot];a.waveFormPositionOnDuty=e[1044+50*a.saveStateSlot]};a.initialize=function(){g(a.memoryLocationNRx1-1,255);g(a.memoryLocationNRx1,63);g(a.memoryLocationNRx2,0);g(a.memoryLocationNRx3,0);g(a.memoryLocationNRx4,184)};a.getSampleFromCycleCounter=
function(){var c=a.cycleCounter;a.cycleCounter=0;return a.getSample(c)};a.resetTimer=function(){a.frequencyTimer=2048-a.frequency<<2<<b.GBCDoubleSpeed};a.getSample=function(c){c=a.frequencyTimer-c;a.frequencyTimer=c;0>=c&&(c=Math.abs(c),a.resetTimer(),a.frequencyTimer-=c,a.waveFormPositionOnDuty=a.waveFormPositionOnDuty+1&7);if(a.isEnabled&&a.isDacEnabled)c=a.volume;else return 15;var b=1;bc(a.NRx1Duty,a.waveFormPositionOnDuty)||(b=-b);return b*c+15};a.trigger=function(){a.isEnabled=!0;0===a.lengthCounter&&
(a.lengthCounter=64);a.resetTimer();a.envelopeCounter=a.NRx2EnvelopePeriod;a.volume=a.NRx2StartingVolume;a.isDacEnabled||(a.isEnabled=!1)};a.willChannelUpdate=function(c){c=a.cycleCounter+c;a.cycleCounter=c;return!(0<a.frequencyTimer-c)};a.updateLength=function(){var c=a.lengthCounter;0<c&&a.NRx4LengthEnabled&&--c;0===c&&(a.isEnabled=!1);a.lengthCounter=c};a.updateEnvelope=function(){var c=a.envelopeCounter-1;if(0>=c&&(c=a.NRx2EnvelopePeriod,0!==c)){var b=a.volume;a.NRx2EnvelopeAddMode&&15>b?b+=1:
!a.NRx2EnvelopeAddMode&&0<b&&--b;a.volume=b}a.envelopeCounter=c};a.setFrequency=function(c){var b=c>>8;c&=255;var d=x(a.memoryLocationNRx4)&248|b;g(a.memoryLocationNRx3,c);g(a.memoryLocationNRx4,d);a.NRx3FrequencyLSB=c;a.NRx4FrequencyMSB=b;a.frequency=b<<8|c};a.cycleCounter=0;a.memoryLocationNRx1=65302;a.NRx1Duty=0;a.NRx1LengthLoad=0;a.memoryLocationNRx2=65303;a.NRx2StartingVolume=0;a.NRx2EnvelopeAddMode=!1;a.NRx2EnvelopePeriod=0;a.memoryLocationNRx3=65304;a.NRx3FrequencyLSB=0;a.memoryLocationNRx4=
65305;a.NRx4LengthEnabled=!1;a.NRx4FrequencyMSB=0;a.channelNumber=2;a.isEnabled=!1;a.isDacEnabled=!1;a.frequency=0;a.frequencyTimer=0;a.envelopeCounter=0;a.lengthCounter=0;a.volume=0;a.dutyCycle=0;a.waveFormPositionOnDuty=0;a.saveStateSlot=8;return a}(),J=function(){function a(){}a.updateNRx0=function(c){a.isDacEnabled=n(7,c)};a.updateNRx1=function(c){a.NRx1LengthLoad=c;a.lengthCounter=256-a.NRx1LengthLoad};a.updateNRx2=function(c){a.NRx2VolumeCode=c>>5&15};a.updateNRx3=function(c){a.NRx3FrequencyLSB=
c;a.frequency=a.NRx4FrequencyMSB<<8|c};a.updateNRx4=function(c){a.NRx4LengthEnabled=n(6,c);c&=7;a.NRx4FrequencyMSB=c;a.frequency=c<<8|a.NRx3FrequencyLSB};a.saveState=function(){e[1024+50*a.saveStateSlot]=a.isEnabled;e[1025+50*a.saveStateSlot]=a.frequencyTimer;e[1029+50*a.saveStateSlot]=a.lengthCounter;e[1033+50*a.saveStateSlot]=a.waveTablePosition};a.loadState=function(){a.isEnabled=Q(1024+50*a.saveStateSlot);a.frequencyTimer=e[1025+50*a.saveStateSlot];a.lengthCounter=e[1029+50*a.saveStateSlot];a.waveTablePosition=
e[1033+50*a.saveStateSlot]};a.initialize=function(){g(a.memoryLocationNRx0,127);g(a.memoryLocationNRx1,255);g(a.memoryLocationNRx2,159);g(a.memoryLocationNRx3,0);g(a.memoryLocationNRx4,184);a.volumeCodeChanged=!0};a.getSampleFromCycleCounter=function(){var c=a.cycleCounter;a.cycleCounter=0;return a.getSample(c)};a.resetTimer=function(){a.frequencyTimer=2048-a.frequency<<1<<b.GBCDoubleSpeed};a.getSample=function(c){var b=a.frequencyTimer;b-=c;0>=b?(c=Math.abs(b),a.frequencyTimer=b,a.resetTimer(),a.frequencyTimer-=
c,a.waveTablePosition=a.waveTablePosition+1&31):a.frequencyTimer=b;b=a.volumeCode;if(a.isEnabled&&a.isDacEnabled)a.volumeCodeChanged&&(b=x(a.memoryLocationNRx2),b=b>>5&15,a.volumeCode=b,a.volumeCodeChanged=!1);else return 15;var d=a.waveTablePosition;c=x(a.memoryLocationWaveTable+(d>>1|0));c=c>>((0===(d&1))<<2)&15;d=0;switch(b){case 0:c>>=4;break;case 1:d=1;break;case 2:c>>=1;d=2;break;default:c>>=2,d=4}return c=(0<d?c/d:0)+15};a.trigger=function(){a.isEnabled=!0;0===a.lengthCounter&&(a.lengthCounter=
256);a.resetTimer();a.waveTablePosition=0;a.isDacEnabled||(a.isEnabled=!1)};a.willChannelUpdate=function(b){a.cycleCounter+=b;return!(!a.volumeCodeChanged&&0<a.frequencyTimer-a.cycleCounter)};a.updateLength=function(){var b=a.lengthCounter;0<b&&a.NRx4LengthEnabled&&--b;0===b&&(a.isEnabled=!1);a.lengthCounter=b};a.cycleCounter=0;a.memoryLocationNRx0=65306;a.memoryLocationNRx1=65307;a.NRx1LengthLoad=0;a.memoryLocationNRx2=65308;a.NRx2VolumeCode=0;a.memoryLocationNRx3=65309;a.NRx3FrequencyLSB=0;a.memoryLocationNRx4=
65310;a.NRx4LengthEnabled=!1;a.NRx4FrequencyMSB=0;a.memoryLocationWaveTable=65328;a.channelNumber=3;a.isEnabled=!1;a.isDacEnabled=!1;a.frequency=0;a.frequencyTimer=0;a.lengthCounter=0;a.waveTablePosition=0;a.volumeCode=0;a.volumeCodeChanged=!1;a.saveStateSlot=9;return a}(),P=function(){function a(){}a.updateNRx1=function(b){a.NRx1LengthLoad=b&63;a.lengthCounter=64-a.NRx1LengthLoad};a.updateNRx2=function(b){a.NRx2StartingVolume=b>>4&15;a.NRx2EnvelopeAddMode=n(3,b);a.NRx2EnvelopePeriod=b&7;a.isDacEnabled=
0<(b&248)};a.updateNRx3=function(b){var c=b&7;a.NRx3ClockShift=b>>4;a.NRx3WidthMode=n(3,b);a.NRx3DivisorCode=c;c<<=1;1>c&&(c=1);a.divisor=c<<3};a.updateNRx4=function(b){a.NRx4LengthEnabled=n(6,b)};a.saveState=function(){e[1024+50*a.saveStateSlot]=a.isEnabled;e[1025+50*a.saveStateSlot]=a.frequencyTimer;e[1029+50*a.saveStateSlot]=a.envelopeCounter;e[1033+50*a.saveStateSlot]=a.lengthCounter;e[1038+50*a.saveStateSlot]=a.volume;e[1043+50*a.saveStateSlot]=a.linearFeedbackShiftRegister};a.loadState=function(){a.isEnabled=
Q(1024+50*a.saveStateSlot);a.frequencyTimer=e[1025+50*a.saveStateSlot];a.envelopeCounter=e[1029+50*a.saveStateSlot];a.lengthCounter=e[1033+50*a.saveStateSlot];a.volume=e[1038+50*a.saveStateSlot];a.linearFeedbackShiftRegister=e[1043+50*a.saveStateSlot]};a.initialize=function(){g(a.memoryLocationNRx1-1,255);g(a.memoryLocationNRx1,255);g(a.memoryLocationNRx2,0);g(a.memoryLocationNRx3,0);g(a.memoryLocationNRx4,191)};a.getSampleFromCycleCounter=function(){var b=a.cycleCounter;a.cycleCounter=0;return a.getSample(b)};
a.getSample=function(b){var c=a.frequencyTimer;c-=b;if(0>=c){b=Math.abs(c);c=a.getNoiseChannelFrequencyPeriod();c-=b;b=a.linearFeedbackShiftRegister;var d=b&1^b>>1&1;b=b>>1|d<<14;a.NRx3WidthMode&&(b=b&-65|d<<6);a.linearFeedbackShiftRegister=b}a.frequencyTimer=c;if(a.isEnabled&&a.isDacEnabled)c=a.volume;else return 15;b=n(0,a.linearFeedbackShiftRegister)?-1:1;return b*c+15};a.trigger=function(){a.isEnabled=!0;0===a.lengthCounter&&(a.lengthCounter=64);a.frequencyTimer=a.getNoiseChannelFrequencyPeriod();
a.envelopeCounter=a.NRx2EnvelopePeriod;a.volume=a.NRx2StartingVolume;a.linearFeedbackShiftRegister=32767;a.isDacEnabled||(a.isEnabled=!1)};a.willChannelUpdate=function(b){a.cycleCounter+=b;return!(0<a.frequencyTimer-a.cycleCounter)};a.getNoiseChannelFrequencyPeriod=function(){return a.divisor<<a.NRx3ClockShift<<b.GBCDoubleSpeed};a.updateLength=function(){var b=a.lengthCounter;0<b&&a.NRx4LengthEnabled&&--b;0===b&&(a.isEnabled=!1);a.lengthCounter=b};a.updateEnvelope=function(){var b=a.envelopeCounter-
1;if(0>=b&&(b=a.NRx2EnvelopePeriod,0!==b)){var d=a.volume;a.NRx2EnvelopeAddMode&&15>d?d+=1:!a.NRx2EnvelopeAddMode&&0<d&&--d;a.volume=d}a.envelopeCounter=b};a.cycleCounter=0;a.memoryLocationNRx1=65312;a.NRx1LengthLoad=0;a.memoryLocationNRx2=65313;a.NRx2StartingVolume=0;a.NRx2EnvelopeAddMode=!1;a.NRx2EnvelopePeriod=0;a.memoryLocationNRx3=65314;a.NRx3ClockShift=0;a.NRx3WidthMode=!1;a.NRx3DivisorCode=0;a.memoryLocationNRx4=65315;a.NRx4LengthEnabled=!1;a.channelNumber=4;a.isEnabled=!1;a.isDacEnabled=!1;
a.frequencyTimer=0;a.envelopeCounter=0;a.lengthCounter=0;a.volume=0;a.divisor=0;a.linearFeedbackShiftRegister=0;a.saveStateSlot=10;return a}(),w=function(){function a(){}a.channel1Sample=15;a.channel2Sample=15;a.channel3Sample=15;a.channel4Sample=15;a.channel1DacEnabled=!1;a.channel2DacEnabled=!1;a.channel3DacEnabled=!1;a.channel4DacEnabled=!1;a.leftChannelSampleUnsignedByte=127;a.rightChannelSampleUnsignedByte=127;a.mixerVolumeChanged=!1;a.mixerEnabledChanged=!1;a.needToRemixSamples=!1;return a}(),
m=function(){function a(){}a.batchProcessCycles=function(){return 87<<b.GBCDoubleSpeed};a.updateNR50=function(b){a.NR50LeftMixerVolume=b>>4&7;a.NR50RightMixerVolume=b&7};a.updateNR51=function(b){a.NR51IsChannel4EnabledOnLeftOutput=n(7,b);a.NR51IsChannel3EnabledOnLeftOutput=n(6,b);a.NR51IsChannel2EnabledOnLeftOutput=n(5,b);a.NR51IsChannel1EnabledOnLeftOutput=n(4,b);a.NR51IsChannel4EnabledOnRightOutput=n(3,b);a.NR51IsChannel3EnabledOnRightOutput=n(2,b);a.NR51IsChannel2EnabledOnRightOutput=n(1,b);a.NR51IsChannel1EnabledOnRightOutput=
n(0,b)};a.updateNR52=function(b){a.NR52IsSoundEnabled=n(7,b)};a.maxFrameSequenceCycles=function(){return 8192<<b.GBCDoubleSpeed};a.maxDownSampleCycles=function(){return b.CLOCK_SPEED()};a.saveState=function(){e[1024+50*a.saveStateSlot]=a.frameSequenceCycleCounter;e[1028+50*a.saveStateSlot]=a.downSampleCycleCounter;e[1029+50*a.saveStateSlot]=a.frameSequencer};a.loadState=function(){a.frameSequenceCycleCounter=e[1024+50*a.saveStateSlot];a.downSampleCycleCounter=e[1028+50*a.saveStateSlot];a.frameSequencer=
e[1029+50*a.saveStateSlot];gc()};a.currentCycles=0;a.memoryLocationNR50=65316;a.NR50LeftMixerVolume=0;a.NR50RightMixerVolume=0;a.memoryLocationNR51=65317;a.NR51IsChannel1EnabledOnLeftOutput=!0;a.NR51IsChannel2EnabledOnLeftOutput=!0;a.NR51IsChannel3EnabledOnLeftOutput=!0;a.NR51IsChannel4EnabledOnLeftOutput=!0;a.NR51IsChannel1EnabledOnRightOutput=!0;a.NR51IsChannel2EnabledOnRightOutput=!0;a.NR51IsChannel3EnabledOnRightOutput=!0;a.NR51IsChannel4EnabledOnRightOutput=!0;a.memoryLocationNR52=65318;a.NR52IsSoundEnabled=
!0;a.memoryLocationChannel3LoadRegisterStart=65328;a.frameSequenceCycleCounter=0;a.downSampleCycleCounter=0;a.downSampleCycleMultiplier=48E3;a.frameSequencer=0;a.audioQueueIndex=0;a.wasmBoyMemoryMaxBufferSize=131072;a.saveStateSlot=6;return a}(),k=function(){function a(){}a.updateInterruptEnabled=function(b){a.isVBlankInterruptEnabled=n(a.bitPositionVBlankInterrupt,b);a.isLcdInterruptEnabled=n(a.bitPositionLcdInterrupt,b);a.isTimerInterruptEnabled=n(a.bitPositionTimerInterrupt,b);a.isSerialInterruptEnabled=
n(a.bitPositionSerialInterrupt,b);a.isJoypadInterruptEnabled=n(a.bitPositionJoypadInterrupt,b);a.interruptsEnabledValue=b};a.updateInterruptRequested=function(b){a.isVBlankInterruptRequested=n(a.bitPositionVBlankInterrupt,b);a.isLcdInterruptRequested=n(a.bitPositionLcdInterrupt,b);a.isTimerInterruptRequested=n(a.bitPositionTimerInterrupt,b);a.isSerialInterruptRequested=n(a.bitPositionSerialInterrupt,b);a.isJoypadInterruptRequested=n(a.bitPositionJoypadInterrupt,b);a.interruptsRequestedValue=b};a.areInterruptsPending=
function(){return 0<(a.interruptsRequestedValue&a.interruptsEnabledValue&31)};a.saveState=function(){e[1024+50*a.saveStateSlot]=a.masterInterruptSwitch;e[1025+50*a.saveStateSlot]=a.masterInterruptSwitchDelay};a.loadState=function(){a.masterInterruptSwitch=Q(1024+50*a.saveStateSlot);a.masterInterruptSwitchDelay=Q(1025+50*a.saveStateSlot);a.updateInterruptEnabled(x(a.memoryLocationInterruptEnabled));a.updateInterruptRequested(x(a.memoryLocationInterruptRequest))};a.masterInterruptSwitch=!1;a.masterInterruptSwitchDelay=
!1;a.bitPositionVBlankInterrupt=0;a.bitPositionLcdInterrupt=1;a.bitPositionTimerInterrupt=2;a.bitPositionSerialInterrupt=3;a.bitPositionJoypadInterrupt=4;a.memoryLocationInterruptEnabled=65535;a.interruptsEnabledValue=0;a.isVBlankInterruptEnabled=!1;a.isLcdInterruptEnabled=!1;a.isTimerInterruptEnabled=!1;a.isSerialInterruptEnabled=!1;a.isJoypadInterruptEnabled=!1;a.memoryLocationInterruptRequest=65295;a.interruptsRequestedValue=0;a.isVBlankInterruptRequested=!1;a.isLcdInterruptRequested=!1;a.isTimerInterruptRequested=
!1;a.isSerialInterruptRequested=!1;a.isJoypadInterruptRequested=!1;a.saveStateSlot=2;return a}(),q=function(){function a(){}a.batchProcessCycles=function(){return 256};a.updateDividerRegister=function(){var b=a.dividerRegister;a.dividerRegister=0;g(a.memoryLocationDividerRegister,0);a.timerEnabled&&ic(b,0)&&Kb()};a.updateTimerCounter=function(b){if(a.timerEnabled){if(a.timerCounterWasReset)return;a.timerCounterOverflowDelay&&(a.timerCounterOverflowDelay=!1)}a.timerCounter=b};a.updateTimerModulo=function(b){a.timerModulo=
b;a.timerEnabled&&a.timerCounterWasReset&&(a.timerCounter=b,a.timerCounterWasReset=!1)};a.updateTimerControl=function(b){var c=a.timerEnabled;a.timerEnabled=n(2,b);b&=3;if(!c){c=Lb(a.timerInputClock);var d=Lb(b),e=a.dividerRegister;(a.timerEnabled?n(c,e):n(c,e)&&n(d,e))&&Kb()}a.timerInputClock=b};a.saveState=function(){e[1024+50*a.saveStateSlot]=a.currentCycles;e[1028+50*a.saveStateSlot]=a.dividerRegister;e[1032+50*a.saveStateSlot]=a.timerCounterOverflowDelay;e[1035+50*a.saveStateSlot]=a.timerCounterWasReset;
g(a.memoryLocationTimerCounter,a.timerCounter)};a.loadState=function(){a.currentCycles=e[1024+50*a.saveStateSlot];a.dividerRegister=e[1028+50*a.saveStateSlot];a.timerCounterOverflowDelay=Q(1032+50*a.saveStateSlot);a.timerCounterWasReset=Q(1035+50*a.saveStateSlot);a.timerCounter=x(a.memoryLocationTimerCounter);a.timerModulo=x(a.memoryLocationTimerModulo);a.timerInputClock=x(a.memoryLocationTimerControl)};a.currentCycles=0;a.memoryLocationDividerRegister=65284;a.dividerRegister=0;a.memoryLocationTimerCounter=
65285;a.timerCounter=0;a.timerCounterOverflowDelay=!1;a.timerCounterWasReset=!1;a.timerCounterMask=0;a.memoryLocationTimerModulo=65286;a.timerModulo=0;a.memoryLocationTimerControl=65287;a.timerEnabled=!1;a.timerInputClock=0;a.saveStateSlot=5;return a}(),Z=function(){function a(){}a.updateTransferControl=function(b){a.isShiftClockInternal=n(0,b);a.isClockSpeedFast=n(1,b);a.transferStartFlag=n(7,b);return!0};a.currentCycles=0;a.memoryLocationSerialTransferData=65281;a.memoryLocationSerialTransferControl=
65282;a.numberOfBitsTransferred=0;a.isShiftClockInternal=!1;a.isClockSpeedFast=!1;a.transferStartFlag=!1;return a}(),C=function(){function a(){}a.updateJoypad=function(b){a.joypadRegisterFlipped=b^255;a.isDpadType=n(4,a.joypadRegisterFlipped);a.isButtonType=n(5,a.joypadRegisterFlipped)};a.saveState=function(){};a.loadState=function(){a.updateJoypad(x(a.memoryLocationJoypadRegister))};a.up=!1;a.down=!1;a.left=!1;a.right=!1;a.a=!1;a.b=!1;a.select=!1;a.start=!1;a.memoryLocationJoypadRegister=65280;a.joypadRegisterFlipped=
0;a.isDpadType=!1;a.isButtonType=!1;a.saveStateSlot=3;return a}(),aa=function(){function a(){}a.programCounter=-1;a.readGbMemory=-1;a.writeGbMemory=-1;a.reachedBreakpoint=!1;return a}(),v=function(){function a(){}a.updateLcdStatus=function(b){var c=x(a.memoryLocationLcdStatus);b=b&248|c&7|128;g(a.memoryLocationLcdStatus,b)};a.updateLcdControl=function(b){var c=a.enabled;a.enabled=n(7,b);a.windowTileMapDisplaySelect=n(6,b);a.windowDisplayEnabled=n(5,b);a.bgWindowTileDataSelect=n(4,b);a.bgTileMapDisplaySelect=
n(3,b);a.tallSpriteSize=n(2,b);a.spriteDisplayEnable=n(1,b);a.bgDisplayEnabled=n(0,b);c&&!a.enabled&&lc(!0);!c&&a.enabled&&lc(!1)};a.memoryLocationLcdStatus=65345;a.currentLcdMode=0;a.memoryLocationCoincidenceCompare=65349;a.coincidenceCompare=0;a.memoryLocationLcdControl=65344;a.enabled=!0;a.windowTileMapDisplaySelect=!1;a.windowDisplayEnabled=!1;a.bgWindowTileDataSelect=!1;a.bgTileMapDisplaySelect=!1;a.tallSpriteSize=!1;a.spriteDisplayEnable=!1;a.bgDisplayEnabled=!1;return a}(),r=function(){function a(){}
a.batchProcessCycles=function(){return a.MAX_CYCLES_PER_SCANLINE()};a.MAX_CYCLES_PER_SCANLINE=function(){return 153===a.scanlineRegister?4<<b.GBCDoubleSpeed:456<<b.GBCDoubleSpeed};a.MIN_CYCLES_SPRITES_LCD_MODE=function(){return 376<<b.GBCDoubleSpeed};a.MIN_CYCLES_TRANSFER_DATA_LCD_MODE=function(){return 249<<b.GBCDoubleSpeed};a.saveState=function(){e[1024+50*a.saveStateSlot]=a.scanlineCycleCounter;e[1028+50*a.saveStateSlot]=v.currentLcdMode;g(a.memoryLocationScanlineRegister,a.scanlineRegister)};
a.loadState=function(){a.scanlineCycleCounter=e[1024+50*a.saveStateSlot];v.currentLcdMode=e[1028+50*a.saveStateSlot];a.scanlineRegister=x(a.memoryLocationScanlineRegister);v.updateLcdControl(x(v.memoryLocationLcdControl))};a.currentCycles=0;a.scanlineCycleCounter=0;a.memoryLocationScanlineRegister=65348;a.scanlineRegister=0;a.memoryLocationDmaTransfer=65350;a.memoryLocationScrollX=65347;a.scrollX=0;a.memoryLocationScrollY=65346;a.scrollY=0;a.memoryLocationWindowX=65355;a.windowX=0;a.memoryLocationWindowY=
65354;a.windowY=0;a.memoryLocationTileMapSelectZeroStart=38912;a.memoryLocationTileMapSelectOneStart=39936;a.memoryLocationTileDataSelectZeroStart=34816;a.memoryLocationTileDataSelectOneStart=32768;a.memoryLocationSpriteAttributesTable=65024;a.memoryLocationBackgroundPalette=65351;a.memoryLocationSpritePaletteOne=65352;a.memoryLocationSpritePaletteTwo=65353;a.saveStateSlot=1;return a}(),h=function(){function a(){}a.saveState=function(){e[1024+50*a.saveStateSlot]=a.currentRomBank;e[1026+50*a.saveStateSlot]=
a.currentRamBank;e[1028+50*a.saveStateSlot]=a.isRamBankingEnabled;e[1029+50*a.saveStateSlot]=a.isMBC1RomModeEnabled;e[1030+50*a.saveStateSlot]=a.isRomOnly;e[1031+50*a.saveStateSlot]=a.isMBC1;e[1032+50*a.saveStateSlot]=a.isMBC2;e[1033+50*a.saveStateSlot]=a.isMBC3;e[1034+50*a.saveStateSlot]=a.isMBC5};a.loadState=function(){a.currentRomBank=e[1024+50*a.saveStateSlot];a.currentRamBank=e[1026+50*a.saveStateSlot];a.isRamBankingEnabled=Q(1028+50*a.saveStateSlot);a.isMBC1RomModeEnabled=Q(1029+50*a.saveStateSlot);
a.isRomOnly=Q(1030+50*a.saveStateSlot);a.isMBC1=Q(1031+50*a.saveStateSlot);a.isMBC2=Q(1032+50*a.saveStateSlot);a.isMBC3=Q(1033+50*a.saveStateSlot);a.isMBC5=Q(1034+50*a.saveStateSlot)};a.cartridgeRomLocation=0;a.switchableCartridgeRomLocation=16384;a.videoRamLocation=32768;a.cartridgeRamLocation=40960;a.internalRamBankZeroLocation=49152;a.internalRamBankOneLocation=53248;a.echoRamLocation=57344;a.spriteInformationTableLocation=65024;a.spriteInformationTableLocationEnd=65183;a.unusableMemoryLocation=
65184;a.unusableMemoryEndLocation=65279;a.currentRomBank=0;a.currentRamBank=0;a.isRamBankingEnabled=!1;a.isMBC1RomModeEnabled=!0;a.isRomOnly=!0;a.isMBC1=!1;a.isMBC2=!1;a.isMBC3=!1;a.isMBC5=!1;a.memoryLocationHdmaSourceHigh=65361;a.memoryLocationHdmaSourceLow=65362;a.memoryLocationHdmaDestinationHigh=65363;a.memoryLocationHdmaDestinationLow=65364;a.memoryLocationHdmaTrigger=65365;a.DMACycles=0;a.isHblankHdmaActive=!1;a.hblankHdmaTransferLengthRemaining=0;a.hblankHdmaSource=0;a.hblankHdmaDestination=
0;a.memoryLocationGBCVRAMBank=65359;a.memoryLocationGBCWRAMBank=65392;a.saveStateSlot=4;return a}(),b=function(){function a(){}a.CLOCK_SPEED=function(){return 4194304<<a.GBCDoubleSpeed};a.MAX_CYCLES_PER_FRAME=function(){return 70224<<a.GBCDoubleSpeed};a.enableHalt=function(){k.masterInterruptSwitch?a.isHaltNormal=!0:0===(k.interruptsEnabledValue&k.interruptsRequestedValue&31)?a.isHaltNoJump=!0:a.isHaltBug=!0};a.exitHaltAndStop=function(){a.isHaltNoJump=!1;a.isHaltNormal=!1;a.isHaltBug=!1;a.isStopped=
!1};a.isHalted=function(){return a.isHaltNormal||a.isHaltNoJump};a.saveState=function(){e[1024+50*a.saveStateSlot]=a.registerA;e[1025+50*a.saveStateSlot]=a.registerB;e[1026+50*a.saveStateSlot]=a.registerC;e[1027+50*a.saveStateSlot]=a.registerD;e[1028+50*a.saveStateSlot]=a.registerE;e[1029+50*a.saveStateSlot]=a.registerH;e[1030+50*a.saveStateSlot]=a.registerL;e[1031+50*a.saveStateSlot]=a.registerF;e[1032+50*a.saveStateSlot]=a.stackPointer;e[1034+50*a.saveStateSlot]=a.programCounter;e[1036+50*a.saveStateSlot]=
a.currentCycles;e[1041+50*a.saveStateSlot]=a.isHaltNormal;e[1042+50*a.saveStateSlot]=a.isHaltNoJump;e[1043+50*a.saveStateSlot]=a.isHaltBug;e[1044+50*a.saveStateSlot]=a.isStopped;e[1045+50*a.saveStateSlot]=a.BootROMEnabled;e[1046+50*a.saveStateSlot]=a.GBCEnabled;e[1047+50*a.saveStateSlot]=a.GBCDoubleSpeed};a.loadState=function(){a.registerA=e[1024+50*a.saveStateSlot];a.registerB=e[1025+50*a.saveStateSlot];a.registerC=e[1026+50*a.saveStateSlot];a.registerD=e[1027+50*a.saveStateSlot];a.registerE=e[1028+
50*a.saveStateSlot];a.registerH=e[1029+50*a.saveStateSlot];a.registerL=e[1030+50*a.saveStateSlot];a.registerF=e[1031+50*a.saveStateSlot];a.stackPointer=e[1032+50*a.saveStateSlot];a.programCounter=e[1034+50*a.saveStateSlot];a.currentCycles=e[1036+50*a.saveStateSlot];a.isHaltNormal=Q(1041+50*a.saveStateSlot);a.isHaltNoJump=Q(1042+50*a.saveStateSlot);a.isHaltBug=Q(1043+50*a.saveStateSlot);a.isStopped=Q(1044+50*a.saveStateSlot);a.BootROMEnabled=Q(1045+50*a.saveStateSlot);a.GBCEnabled=Q(1046+50*a.saveStateSlot);
a.GBCDoubleSpeed=Q(1047+50*a.saveStateSlot)};a.memoryLocationBootROMSwitch=65360;a.BootROMEnabled=!1;a.GBCEnabled=!1;a.memoryLocationSpeedSwitch=65357;a.GBCDoubleSpeed=!1;a.registerA=0;a.registerB=0;a.registerC=0;a.registerD=0;a.registerE=0;a.registerH=0;a.registerL=0;a.registerF=0;a.stackPointer=0;a.programCounter=0;a.currentCycles=0;a.isHaltNormal=!1;a.isHaltNoJump=!1;a.isHaltBug=!1;a.isStopped=!1;a.saveStateSlot=0;return a}(),da=function(){function a(){}a.cyclesPerCycleSet=2E9;a.cycleSets=0;a.cycles=
0;return a}(),W=function(){function a(){}a.stepsPerStepSet=2E9;a.stepSets=0;a.steps=0;a.RESPONSE_CONDITION_ERROR=-1;a.RESPONSE_CONDITION_FRAME=0;a.RESPONSE_CONDITION_AUDIO=1;a.RESPONSE_CONDITION_BREAKPOINT=2;return a}();mb.size()<Xb&&mb.grow(Xb-mb.size());var kb=!1,Xc=Object.freeze({memory:mb,config:function(a,c,e,n,f,l,p,t,u,v){R.enableBootRom=0<a;R.useGbcWhenAvailable=0<c;R.audioBatchProcessing=0<e;R.graphicsBatchProcessing=0<n;R.timersBatchProcessing=0<f;R.graphicsDisableScanlineRendering=0<l;
R.audioAccumulateSamples=0<p;R.tileRendering=0<t;R.tileCaching=0<u;R.enableAudioDebugging=0<v;a=x(323);b.GBCEnabled=192===a||R.useGbcWhenAvailable&&128===a?!0:!1;kb=!1;da.cyclesPerCycleSet=2E9;da.cycleSets=0;da.cycles=0;W.stepsPerStepSet=2E9;W.stepSets=0;W.steps=0;b.BootROMEnabled=R.enableBootRom?!0:!1;b.GBCDoubleSpeed=!1;b.registerA=0;b.registerB=0;b.registerC=0;b.registerD=0;b.registerE=0;b.registerH=0;b.registerL=0;b.registerF=0;b.stackPointer=0;b.programCounter=0;b.currentCycles=0;b.isHaltNormal=
!1;b.isHaltNoJump=!1;b.isHaltBug=!1;b.isStopped=!1;b.BootROMEnabled||(b.GBCEnabled?(b.registerA=17,b.registerF=128,b.registerB=0,b.registerC=0,b.registerD=255,b.registerE=86,b.registerH=0,b.registerL=13):(b.registerA=1,b.registerF=176,b.registerB=0,b.registerC=19,b.registerD=0,b.registerE=216,b.registerH=1,b.registerL=77),b.programCounter=256,b.stackPointer=65534);h.isRamBankingEnabled=!1;h.isMBC1RomModeEnabled=!0;a=x(327);h.isRomOnly=0===a;h.isMBC1=1<=a&&3>=a;h.isMBC2=5<=a&&6>=a;h.isMBC3=15<=a&&
19>=a;h.isMBC5=25<=a&&30>=a;h.currentRomBank=1;h.currentRamBank=0;g(h.memoryLocationGBCVRAMBank,0);g(h.memoryLocationGBCWRAMBank,1);g(65361,255);g(65362,255);g(65363,255);g(65364,255);g(65365,255);r.currentCycles=0;r.scanlineCycleCounter=0;r.scanlineRegister=0;r.scrollX=0;r.scrollY=0;r.windowX=0;r.windowY=0;r.scanlineRegister=144;b.GBCEnabled?(g(65345,129),g(65348,144),g(65351,252)):(g(65345,133),g(65350,255),g(65351,252),g(65352,255),g(65353,255));r.scanlineRegister=144;g(65344,144);g(65359,0);g(65392,
1);b.BootROMEnabled&&(b.GBCEnabled?(r.scanlineRegister=0,g(65344,0),g(65345,128),g(65348,0)):(r.scanlineRegister=0,g(65344,0),g(65345,132)));$b(0);if(!b.GBCEnabled&&(!b.BootROMEnabled||b.GBCEnabled)){a=0;for(c=308;323>=c;c++)a+=x(c);switch(a&255){case 136:d.bgWhite=va.bgWhite;d.bgLightGrey=va.bgLightGrey;d.bgDarkGrey=va.bgDarkGrey;d.bgBlack=va.bgBlack;d.obj0White=va.obj0White;d.obj0LightGrey=va.obj0LightGrey;d.obj0DarkGrey=va.obj0DarkGrey;d.obj0Black=va.obj0Black;d.obj1White=va.obj1White;d.obj1LightGrey=
va.obj1LightGrey;d.obj1DarkGrey=va.obj1DarkGrey;d.obj1Black=va.obj1Black;break;case 97:d.bgWhite=wa.bgWhite;d.bgLightGrey=wa.bgLightGrey;d.bgDarkGrey=wa.bgDarkGrey;d.bgBlack=wa.bgBlack;d.obj0White=wa.obj0White;d.obj0LightGrey=wa.obj0LightGrey;d.obj0DarkGrey=wa.obj0DarkGrey;d.obj0Black=wa.obj0Black;d.obj1White=wa.obj1White;d.obj1LightGrey=wa.obj1LightGrey;d.obj1DarkGrey=wa.obj1DarkGrey;d.obj1Black=wa.obj1Black;break;case 20:d.bgWhite=xa.bgWhite;d.bgLightGrey=xa.bgLightGrey;d.bgDarkGrey=xa.bgDarkGrey;
d.bgBlack=xa.bgBlack;d.obj0White=xa.obj0White;d.obj0LightGrey=xa.obj0LightGrey;d.obj0DarkGrey=xa.obj0DarkGrey;d.obj0Black=xa.obj0Black;d.obj1White=xa.obj1White;d.obj1LightGrey=xa.obj1LightGrey;d.obj1DarkGrey=xa.obj1DarkGrey;d.obj1Black=xa.obj1Black;break;case 70:d.bgWhite=ya.bgWhite;d.bgLightGrey=ya.bgLightGrey;d.bgDarkGrey=ya.bgDarkGrey;d.bgBlack=ya.bgBlack;d.obj0White=ya.obj0White;d.obj0LightGrey=ya.obj0LightGrey;d.obj0DarkGrey=ya.obj0DarkGrey;d.obj0Black=ya.obj0Black;d.obj1White=ya.obj1White;d.obj1LightGrey=
ya.obj1LightGrey;d.obj1DarkGrey=ya.obj1DarkGrey;d.obj1Black=ya.obj1Black;break;case 89:case 198:d.bgWhite=za.bgWhite;d.bgLightGrey=za.bgLightGrey;d.bgDarkGrey=za.bgDarkGrey;d.bgBlack=za.bgBlack;d.obj0White=za.obj0White;d.obj0LightGrey=za.obj0LightGrey;d.obj0DarkGrey=za.obj0DarkGrey;d.obj0Black=za.obj0Black;d.obj1White=za.obj1White;d.obj1LightGrey=za.obj1LightGrey;d.obj1DarkGrey=za.obj1DarkGrey;d.obj1Black=za.obj1Black;break;case 134:case 168:d.bgWhite=Aa.bgWhite;d.bgLightGrey=Aa.bgLightGrey;d.bgDarkGrey=
Aa.bgDarkGrey;d.bgBlack=Aa.bgBlack;d.obj0White=Aa.obj0White;d.obj0LightGrey=Aa.obj0LightGrey;d.obj0DarkGrey=Aa.obj0DarkGrey;d.obj0Black=Aa.obj0Black;d.obj1White=Aa.obj1White;d.obj1LightGrey=Aa.obj1LightGrey;d.obj1DarkGrey=Aa.obj1DarkGrey;d.obj1Black=Aa.obj1Black;break;case 191:case 206:case 209:case 240:d.bgWhite=Ba.bgWhite;d.bgLightGrey=Ba.bgLightGrey;d.bgDarkGrey=Ba.bgDarkGrey;d.bgBlack=Ba.bgBlack;d.obj0White=Ba.obj0White;d.obj0LightGrey=Ba.obj0LightGrey;d.obj0DarkGrey=Ba.obj0DarkGrey;d.obj0Black=
Ba.obj0Black;d.obj1White=Ba.obj1White;d.obj1LightGrey=Ba.obj1LightGrey;d.obj1DarkGrey=Ba.obj1DarkGrey;d.obj1Black=Ba.obj1Black;break;case 39:case 73:case 92:case 179:d.bgWhite=Ca.bgWhite;d.bgLightGrey=Ca.bgLightGrey;d.bgDarkGrey=Ca.bgDarkGrey;d.bgBlack=Ca.bgBlack;d.obj0White=Ca.obj0White;d.obj0LightGrey=Ca.obj0LightGrey;d.obj0DarkGrey=Ca.obj0DarkGrey;d.obj0Black=Ca.obj0Black;d.obj1White=Ca.obj1White;d.obj1LightGrey=Ca.obj1LightGrey;d.obj1DarkGrey=Ca.obj1DarkGrey;d.obj1Black=Ca.obj1Black;break;case 201:d.bgWhite=
Da.bgWhite;d.bgLightGrey=Da.bgLightGrey;d.bgDarkGrey=Da.bgDarkGrey;d.bgBlack=Da.bgBlack;d.obj0White=Da.obj0White;d.obj0LightGrey=Da.obj0LightGrey;d.obj0DarkGrey=Da.obj0DarkGrey;d.obj0Black=Da.obj0Black;d.obj1White=Da.obj1White;d.obj1LightGrey=Da.obj1LightGrey;d.obj1DarkGrey=Da.obj1DarkGrey;d.obj1Black=Da.obj1Black;break;case 112:d.bgWhite=Ea.bgWhite;d.bgLightGrey=Ea.bgLightGrey;d.bgDarkGrey=Ea.bgDarkGrey;d.bgBlack=Ea.bgBlack;d.obj0White=Ea.obj0White;d.obj0LightGrey=Ea.obj0LightGrey;d.obj0DarkGrey=
Ea.obj0DarkGrey;d.obj0Black=Ea.obj0Black;d.obj1White=Ea.obj1White;d.obj1LightGrey=Ea.obj1LightGrey;d.obj1DarkGrey=Ea.obj1DarkGrey;d.obj1Black=Ea.obj1Black;break;case 70:d.bgWhite=Fa.bgWhite;d.bgLightGrey=Fa.bgLightGrey;d.bgDarkGrey=Fa.bgDarkGrey;d.bgBlack=Fa.bgBlack;d.obj0White=Fa.obj0White;d.obj0LightGrey=Fa.obj0LightGrey;d.obj0DarkGrey=Fa.obj0DarkGrey;d.obj0Black=Fa.obj0Black;d.obj1White=Fa.obj1White;d.obj1LightGrey=Fa.obj1LightGrey;d.obj1DarkGrey=Fa.obj1DarkGrey;d.obj1Black=Fa.obj1Black;break;
case 211:d.bgWhite=Ga.bgWhite,d.bgLightGrey=Ga.bgLightGrey,d.bgDarkGrey=Ga.bgDarkGrey,d.bgBlack=Ga.bgBlack,d.obj0White=Ga.obj0White,d.obj0LightGrey=Ga.obj0LightGrey,d.obj0DarkGrey=Ga.obj0DarkGrey,d.obj0Black=Ga.obj0Black,d.obj1White=Ga.obj1White,d.obj1LightGrey=Ga.obj1LightGrey,d.obj1DarkGrey=Ga.obj1DarkGrey,d.obj1Black=Ga.obj1Black}}b.GBCEnabled?(g(65384,192),g(65385,255),g(65386,193),g(65387,13)):(g(65384,255),g(65385,255),g(65386,255),g(65387,255));b.BootROMEnabled&&b.GBCEnabled&&(g(65385,32),
g(65387,138));m.currentCycles=0;m.NR50LeftMixerVolume=0;m.NR50RightMixerVolume=0;m.NR51IsChannel1EnabledOnLeftOutput=!0;m.NR51IsChannel2EnabledOnLeftOutput=!0;m.NR51IsChannel3EnabledOnLeftOutput=!0;m.NR51IsChannel4EnabledOnLeftOutput=!0;m.NR51IsChannel1EnabledOnRightOutput=!0;m.NR51IsChannel2EnabledOnRightOutput=!0;m.NR51IsChannel3EnabledOnRightOutput=!0;m.NR51IsChannel4EnabledOnRightOutput=!0;m.NR52IsSoundEnabled=!0;m.frameSequenceCycleCounter=0;m.downSampleCycleCounter=0;m.frameSequencer=0;m.audioQueueIndex=
0;B.initialize();O.initialize();J.initialize();P.initialize();g(m.memoryLocationNR50,119);m.updateNR50(119);g(m.memoryLocationNR51,243);m.updateNR51(243);g(m.memoryLocationNR52,241);m.updateNR52(241);b.BootROMEnabled&&(g(m.memoryLocationNR50,0),m.updateNR50(0),g(m.memoryLocationNR51,0),m.updateNR51(0),g(m.memoryLocationNR52,112),m.updateNR52(112));w.channel1Sample=15;w.channel2Sample=15;w.channel3Sample=15;w.channel4Sample=15;w.channel1DacEnabled=!1;w.channel2DacEnabled=!1;w.channel3DacEnabled=!1;
w.channel4DacEnabled=!1;w.leftChannelSampleUnsignedByte=127;w.rightChannelSampleUnsignedByte=127;w.mixerVolumeChanged=!0;w.mixerEnabledChanged=!0;w.needToRemixSamples=!1;k.updateInterruptEnabled(0);g(k.memoryLocationInterruptEnabled,k.interruptsEnabledValue);k.updateInterruptRequested(225);g(k.memoryLocationInterruptRequest,k.interruptsRequestedValue);q.currentCycles=0;q.dividerRegister=0;q.timerCounter=0;q.timerModulo=0;q.timerEnabled=!1;q.timerInputClock=0;q.timerCounterOverflowDelay=!1;q.timerCounterWasReset=
!1;b.GBCEnabled?(g(65284,30),q.dividerRegister=7840):(g(65284,171),q.dividerRegister=43980);g(65287,248);q.timerInputClock=248;b.BootROMEnabled&&!b.GBCEnabled&&(g(65284,0),q.dividerRegister=4);Z.currentCycles=0;Z.numberOfBitsTransferred=0;b.GBCEnabled?(g(65282,124),Z.updateTransferControl(124)):(g(65282,126),Z.updateTransferControl(126));b.GBCEnabled?(g(65392,248),g(65359,254),g(65357,126),g(65280,207),g(65295,225),g(65388,254),g(65397,143)):(g(65392,255),g(65359,255),g(65357,255),g(65280,207),g(65295,
225))},hasCoreStarted:function(){return kb},saveState:function(){b.saveState();r.saveState();k.saveState();C.saveState();h.saveState();q.saveState();m.saveState();B.saveState();O.saveState();J.saveState();P.saveState();kb=!1},loadState:function(){b.loadState();r.loadState();k.loadState();C.loadState();h.loadState();q.loadState();m.loadState();B.loadState();O.loadState();J.loadState();P.loadState();kb=!1;da.cyclesPerCycleSet=2E9;da.cycleSets=0;da.cycles=0;W.stepsPerStepSet=2E9;W.stepSets=0;W.steps=
0},isGBC:function(){return b.GBCEnabled},getStepsPerStepSet:function(){return W.stepsPerStepSet},getStepSets:function(){return W.stepSets},getSteps:function(){return W.steps},executeMultipleFrames:function(a){for(var b=0,d=0;d<a&&0<=b;)b=qc(),d+=1;return 0>b?b:0},executeFrame:qc,executeFrameAndCheckAudio:function(a){void 0===a&&(a=0);return Sb(!0,a)},executeUntilCondition:Sb,executeStep:rc,getCyclesPerCycleSet:function(){return da.cyclesPerCycleSet},getCycleSets:function(){return da.cycleSets},getCycles:function(){return da.cycles},
setJoypadState:function(a,b,d,e,f,g,h,n){0<a?Ta(0):Ia(0,!1);0<b?Ta(1):Ia(1,!1);0<d?Ta(2):Ia(2,!1);0<e?Ta(3):Ia(3,!1);0<f?Ta(4):Ia(4,!1);0<g?Ta(5):Ia(5,!1);0<h?Ta(6):Ia(6,!1);0<n?Ta(7):Ia(7,!1)},getNumberOfSamplesInAudioBuffer:fc,clearAudioBuffer:gc,setManualColorizationPalette:$b,WASMBOY_MEMORY_LOCATION:0,WASMBOY_MEMORY_SIZE:xc,WASMBOY_WASM_PAGES:Xb,ASSEMBLYSCRIPT_MEMORY_LOCATION:0,ASSEMBLYSCRIPT_MEMORY_SIZE:1024,WASMBOY_STATE_LOCATION:1024,WASMBOY_STATE_SIZE:1024,GAMEBOY_INTERNAL_MEMORY_LOCATION:2048,
GAMEBOY_INTERNAL_MEMORY_SIZE:Uc,VIDEO_RAM_LOCATION:2048,VIDEO_RAM_SIZE:16384,WORK_RAM_LOCATION:18432,WORK_RAM_SIZE:32768,OTHER_GAMEBOY_INTERNAL_MEMORY_LOCATION:51200,OTHER_GAMEBOY_INTERNAL_MEMORY_SIZE:16384,GRAPHICS_OUTPUT_LOCATION:Vc,GRAPHICS_OUTPUT_SIZE:Wc,GBC_PALETTE_LOCATION:Ya,GBC_PALETTE_SIZE:128,BG_PRIORITY_MAP_LOCATION:Za,BG_PRIORITY_MAP_SIZE:23552,FRAME_LOCATION:cb,FRAME_SIZE:93184,BACKGROUND_MAP_LOCATION:zb,BACKGROUND_MAP_SIZE:196608,TILE_DATA_LOCATION:Vb,TILE_DATA_SIZE:147456,OAM_TILES_LOCATION:Ab,
OAM_TILES_SIZE:15360,AUDIO_BUFFER_LOCATION:ub,AUDIO_BUFFER_SIZE:131072,CHANNEL_1_BUFFER_LOCATION:Fb,CHANNEL_1_BUFFER_SIZE:131072,CHANNEL_2_BUFFER_LOCATION:Gb,CHANNEL_2_BUFFER_SIZE:131072,CHANNEL_3_BUFFER_LOCATION:Hb,CHANNEL_3_BUFFER_SIZE:131072,CHANNEL_4_BUFFER_LOCATION:Ib,CHANNEL_4_BUFFER_SIZE:131072,CARTRIDGE_RAM_LOCATION:Pb,CARTRIDGE_RAM_SIZE:131072,BOOT_ROM_LOCATION:wb,BOOT_ROM_SIZE:2560,CARTRIDGE_ROM_LOCATION:xb,CARTRIDGE_ROM_SIZE:8258560,DEBUG_GAMEBOY_MEMORY_LOCATION:Wb,DEBUG_GAMEBOY_MEMORY_SIZE:65535,
getWasmBoyOffsetFromGameBoyOffset:Ob,setProgramCounterBreakpoint:function(a){aa.programCounter=a},resetProgramCounterBreakpoint:function(){aa.programCounter=-1},setReadGbMemoryBreakpoint:function(a){aa.readGbMemory=a},resetReadGbMemoryBreakpoint:function(){aa.readGbMemory=-1},setWriteGbMemoryBreakpoint:function(a){aa.writeGbMemory=a},resetWriteGbMemoryBreakpoint:function(){aa.writeGbMemory=-1},getRegisterA:function(){return b.registerA},getRegisterB:function(){return b.registerB},getRegisterC:function(){return b.registerC},
getRegisterD:function(){return b.registerD},getRegisterE:function(){return b.registerE},getRegisterH:function(){return b.registerH},getRegisterL:function(){return b.registerL},getRegisterF:function(){return b.registerF},getProgramCounter:function(){return b.programCounter},getStackPointer:function(){return b.stackPointer},getOpcodeAtProgramCounter:function(){return x(b.programCounter)},getLY:function(){return r.scanlineRegister},drawBackgroundMapToWasmMemory:function(a){var c=r.memoryLocationTileDataSelectZeroStart;
v.bgWindowTileDataSelect&&(c=r.memoryLocationTileDataSelectOneStart);var d=r.memoryLocationTileMapSelectZeroStart;v.bgTileMapDisplaySelect&&(d=r.memoryLocationTileMapSelectOneStart);for(var g=0;256>g;g++)for(var f=0;256>f;f++){var h=g,m=f,l=d+32*(h>>3)+(m>>3),k=X(l,0);k=gb(c,k);var p=h%8;h=m%8;h=7-h;m=0;b.GBCEnabled&&0<a&&(m=X(l,1));n(6,m)&&(p=7-p);var q=0;n(3,m)&&(q=1);l=X(k+2*p,q);k=X(k+2*p+1,q);p=0;n(h,k)&&(p+=1,p<<=1);n(h,l)&&(p+=1);k=3*(256*g+f);b.GBCEnabled&&0<a?(l=rb(m&7,p,!1),m=ua(0,l),h=
ua(1,l),l=ua(2,l),k=zb+k,e[k]=m,e[k+1]=h,e[k+2]=l):(m=qb(p,r.memoryLocationBackgroundPalette),k=zb+k,e[k+0]=(m&16711680)>>16,e[k+1]=(m&65280)>>8,e[k+2]=m&255)}},drawTileDataToWasmMemory:function(){for(var a=0;23>a;a++)for(var c=0;31>c;c++){var d=0;15<c&&(d=1);var e=a;15<a&&(e-=15);e<<=4;e=15<c?e+(c-15):e+c;var f=r.memoryLocationTileDataSelectOneStart;15<a&&(f=r.memoryLocationTileDataSelectZeroStart);for(var g=r.memoryLocationBackgroundPalette,h=-1,m=-1,k=0;8>k;k++)for(var l=0;5>l;l++){var p=4*(8*
l+k),q=x(r.memoryLocationSpriteAttributesTable+p+2);e===q&&(p=x(r.memoryLocationSpriteAttributesTable+p+3),q=0,b.GBCEnabled&&n(3,p)&&(q=1),q===d&&(m=p,k=8,l=5,g=r.memoryLocationSpritePaletteOne,n(4,m)&&(g=r.memoryLocationSpritePaletteTwo)))}if(b.GBCEnabled&&0>m){k=r.memoryLocationTileMapSelectZeroStart;v.bgTileMapDisplaySelect&&(k=r.memoryLocationTileMapSelectOneStart);l=-1;for(p=0;32>p;p++)for(q=0;32>q;q++){var t=k+32*q+p,u=X(t,0);e===u&&(l=t,q=p=32)}0<=l&&(h=X(l,1))}for(k=0;8>k;k++)Eb(e,f,d,0,7,
k,8*c,8*a+k,248,Vb,!1,g,h,m)}},drawOamToWasmMemory:function(){for(var a=0;8>a;a++)for(var c=0;5>c;c++){var d=4*(8*c+a);x(r.memoryLocationSpriteAttributesTable+d);x(r.memoryLocationSpriteAttributesTable+d+1);var e=x(r.memoryLocationSpriteAttributesTable+d+2),f=1;v.tallSpriteSize&&(1===e%2&&--e,f+=1);d=x(r.memoryLocationSpriteAttributesTable+d+3);var g=0;b.GBCEnabled&&n(3,d)&&(g=1);var h=r.memoryLocationSpritePaletteOne;n(4,d)&&(h=r.memoryLocationSpritePaletteTwo);for(var k=0;k<f;k++)for(var l=0;8>
l;l++)Eb(e+k,r.memoryLocationTileDataSelectOneStart,g,0,7,l,8*a,16*c+l+8*k,64,Ab,!1,h,-1,d)}},getDIV:function(){return q.dividerRegister},getTIMA:function(){return q.timerCounter},getTMA:function(){return q.timerModulo},getTAC:function(){var a=q.timerInputClock;q.timerEnabled&&(a|=4);return a},updateDebugGBMemory:function(){for(var a=0;65535>a;a++){var b=Mb(a);e[Wb+a]=b}aa.reachedBreakpoint=!1}});const Yc=async()=>({instance:{exports:Xc},byteMemory:mb.wasmByteMemory,type:"TypeScript"});let lb,yb,
uc,l;l={graphicsWorkerPort:void 0,memoryWorkerPort:void 0,controllerWorkerPort:void 0,audioWorkerPort:void 0,wasmInstance:void 0,wasmByteMemory:void 0,options:void 0,WASMBOY_BOOT_ROM_LOCATION:0,WASMBOY_GAME_BYTES_LOCATION:0,WASMBOY_GAME_RAM_BANKS_LOCATION:0,WASMBOY_INTERNAL_STATE_SIZE:0,WASMBOY_INTERNAL_STATE_LOCATION:0,WASMBOY_INTERNAL_MEMORY_SIZE:0,WASMBOY_INTERNAL_MEMORY_LOCATION:0,WASMBOY_PALETTE_MEMORY_SIZE:0,WASMBOY_PALETTE_MEMORY_LOCATION:0,WASMBOY_CURRENT_FRAME_OUTPUT_LOCATION:0,WASMBOY_CURRENT_FRAME_SIZE:0,
WASMBOY_SOUND_OUTPUT_LOCATION:0,WASMBOY_CHANNEL_1_OUTPUT_LOCATION:0,WASMBOY_CHANNEL_2_OUTPUT_LOCATION:0,WASMBOY_CHANNEL_3_OUTPUT_LOCATION:0,WASMBOY_CHANNEL_4_OUTPUT_LOCATION:0,paused:!0,updateId:void 0,timeStampsUntilReady:0,fpsTimeStamps:[],speed:0,frameSkipCounter:0,currentAudioLatencyInSeconds:0,messageHandler:(a)=>{const b=eb(a);switch(b.message.type){case y.CONNECT:"GRAPHICS"===b.message.workerId?(l.graphicsWorkerPort=b.message.ports[0],fb(yc.bind(void 0,l),l.graphicsWorkerPort)):"MEMORY"===
b.message.workerId?(l.memoryWorkerPort=b.message.ports[0],fb(Bc.bind(void 0,l),l.memoryWorkerPort)):"CONTROLLER"===b.message.workerId?(l.controllerWorkerPort=b.message.ports[0],fb(Ac.bind(void 0,l),l.controllerWorkerPort)):"AUDIO"===b.message.workerId&&(l.audioWorkerPort=b.message.ports[0],fb(zc.bind(void 0,l),l.audioWorkerPort));ea(M(void 0,b.messageId));break;case y.INSTANTIATE_WASM:(async()=>{let a;a=await Yc();l.wasmInstance=a.instance;l.wasmByteMemory=a.byteMemory;ea(M({type:a.type},b.messageId))})();
break;case y.CONFIG:l.wasmInstance.exports.config.apply(l,b.message.config);l.options=b.message.options;ea(M(void 0,b.messageId));break;case y.RESET_AUDIO_QUEUE:l.wasmInstance.exports.clearAudioBuffer();ea(M(void 0,b.messageId));break;case y.PLAY:if(!l.paused||!l.wasmInstance||!l.wasmByteMemory){ea(M({error:!0},b.messageId));break}l.paused=!1;l.fpsTimeStamps=[];Tb(l);l.frameSkipCounter=0;l.currentAudioLatencyInSeconds=0;l.options.isGbcColorizationEnabled?l.options.gbcColorizationPalette&&l.wasmInstance.exports.setManualColorizationPalette("wasmboygb brown red darkbrown green darkgreen inverted pastelmix orange yellow blue darkblue grayscale".split(" ").indexOf(l.options.gbcColorizationPalette.toLowerCase())):
l.wasmInstance.exports.setManualColorizationPalette(0);vc(l,1E3/l.options.gameboyFrameRate);ea(M(void 0,b.messageId));break;case y.PAUSE:l.paused=!0;l.updateId&&(clearTimeout(l.updateId),l.updateId=void 0);ea(M(void 0,b.messageId));break;case y.RUN_WASM_EXPORT:a=b.message.parameters?l.wasmInstance.exports[b.message.export].apply(void 0,b.message.parameters):l.wasmInstance.exports[b.message.export]();ea(M({type:y.RUN_WASM_EXPORT,response:a},b.messageId));break;case y.GET_WASM_MEMORY_SECTION:{a=0;let c=
l.wasmByteMemory.length;b.message.start&&(a=b.message.start);b.message.end&&(c=b.message.end);a=l.wasmByteMemory.slice(a,c).buffer;ea(M({type:y.RUN_WASM_EXPORT,response:a},b.messageId),[a]);break}case y.GET_WASM_CONSTANT:ea(M({type:y.GET_WASM_CONSTANT,response:l.wasmInstance.exports[b.message.constant].valueOf()},b.messageId));break;case y.FORCE_OUTPUT_FRAME:sc(l);break;case y.SET_SPEED:l.speed=b.message.speed;l.fpsTimeStamps=[];l.timeStampsUntilReady=60;Tb(l);l.frameSkipCounter=0;l.currentAudioLatencyInSeconds=
0;l.wasmInstance.exports.clearAudioBuffer();break;case y.IS_GBC:a=0<l.wasmInstance.exports.isGBC();ea(M({type:y.IS_GBC,response:a},b.messageId));break;default:console.log("Unknown WasmBoy Worker message:",b)}},getFPS:()=>0<l.timeStampsUntilReady?l.speed&&0<l.speed?l.options.gameboyFrameRate*l.speed:l.options.gameboyFrameRate:l.fpsTimeStamps?l.fpsTimeStamps.length:0};fb(l.messageHandler)})();

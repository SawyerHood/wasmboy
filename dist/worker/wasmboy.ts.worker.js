'use strict';(function(){function eb(a){return a.data?a.data:a}function ea(a,c){mb?self.postMessage(a,c):Ab.postMessage(a,c)}function fb(a,c){a||console.error("workerapi: No callback was provided to onMessage!");if(c)if(mb)c.onmessage=a;else c.on("message",a);else if(mb)self.onmessage=a;else Ab.on("message",a)}function M(a,c,b){c||(c=Math.random().toString(36).replace(/[^a-z]+/g,"").substr(2,10),nb++,c=`${c}-${nb}`,1E5<nb&&(nb=0));return{workerId:b,messageId:c,message:a}}function wc(a,c){c=eb(c);
switch(c.message.type){case x.GET_CONSTANTS:a.WASMBOY_CURRENT_FRAME_OUTPUT_LOCATION=a.wasmInstance.exports.FRAME_LOCATION.valueOf(),a.WASMBOY_CURRENT_FRAME_SIZE=a.wasmInstance.exports.FRAME_SIZE.valueOf(),a.graphicsWorkerPort.postMessage(M({type:x.GET_CONSTANTS_DONE,WASMBOY_CURRENT_FRAME_OUTPUT_LOCATION:a.wasmInstance.exports.FRAME_LOCATION.valueOf()},c.messageId))}}function xc(a,c){c=eb(c);switch(c.message.type){case x.GET_CONSTANTS:a.WASMBOY_SOUND_OUTPUT_LOCATION=a.wasmInstance.exports.AUDIO_BUFFER_LOCATION.valueOf();
a.WASMBOY_CHANNEL_1_OUTPUT_LOCATION=a.wasmInstance.exports.CHANNEL_1_BUFFER_LOCATION.valueOf();a.WASMBOY_CHANNEL_2_OUTPUT_LOCATION=a.wasmInstance.exports.CHANNEL_2_BUFFER_LOCATION.valueOf();a.WASMBOY_CHANNEL_3_OUTPUT_LOCATION=a.wasmInstance.exports.CHANNEL_3_BUFFER_LOCATION.valueOf();a.WASMBOY_CHANNEL_4_OUTPUT_LOCATION=a.wasmInstance.exports.CHANNEL_4_BUFFER_LOCATION.valueOf();a.audioWorkerPort.postMessage(M({type:x.GET_CONSTANTS_DONE,WASMBOY_SOUND_OUTPUT_LOCATION:a.wasmInstance.exports.AUDIO_BUFFER_LOCATION.valueOf()},
c.messageId));break;case x.AUDIO_LATENCY:a.currentAudioLatencyInSeconds=c.message.latency}}function yc(a,c){c=eb(c);switch(c.message.type){case x.SET_JOYPAD_STATE:a.wasmInstance.exports.setJoypadState.apply(a,c.message.setJoypadStateParamsAsArray)}}function Wb(a){if(!a.wasmByteMemory)return new Uint8Array;let c=a.wasmByteMemory[a.WASMBOY_GAME_BYTES_LOCATION+327],b=void 0;if(0===c)return new Uint8Array;1<=c&&3>=c?b=32768:5<=c&&6>=c?b=2048:15<=c&&19>=c?b=32768:25<=c&&30>=c&&(b=131072);return b?a.wasmByteMemory.slice(a.WASMBOY_GAME_RAM_BANKS_LOCATION,
a.WASMBOY_GAME_RAM_BANKS_LOCATION+b):new Uint8Array}function Xb(a){a.wasmInstance.exports.saveState();return a.wasmByteMemory.slice(a.WASMBOY_INTERNAL_STATE_LOCATION,a.WASMBOY_INTERNAL_STATE_LOCATION+a.WASMBOY_INTERNAL_STATE_SIZE)}function zc(a,c){c=eb(c);switch(c.message.type){case x.CLEAR_MEMORY:for(var b=0;b<=a.wasmByteMemory.length;b++)a.wasmByteMemory[b]=0;b=a.wasmByteMemory.slice(0);a.memoryWorkerPort.postMessage(M({type:x.CLEAR_MEMORY_DONE,wasmByteMemory:b.buffer},c.messageId),[b.buffer]);
break;case x.GET_CONSTANTS:a.WASMBOY_GAME_BYTES_LOCATION=a.wasmInstance.exports.CARTRIDGE_ROM_LOCATION.valueOf();a.WASMBOY_GAME_RAM_BANKS_LOCATION=a.wasmInstance.exports.CARTRIDGE_RAM_LOCATION.valueOf();a.WASMBOY_INTERNAL_STATE_SIZE=a.wasmInstance.exports.WASMBOY_STATE_SIZE.valueOf();a.WASMBOY_INTERNAL_STATE_LOCATION=a.wasmInstance.exports.WASMBOY_STATE_LOCATION.valueOf();a.WASMBOY_INTERNAL_MEMORY_SIZE=a.wasmInstance.exports.GAMEBOY_INTERNAL_MEMORY_SIZE.valueOf();a.WASMBOY_INTERNAL_MEMORY_LOCATION=
a.wasmInstance.exports.GAMEBOY_INTERNAL_MEMORY_LOCATION.valueOf();a.WASMBOY_PALETTE_MEMORY_SIZE=a.wasmInstance.exports.GBC_PALETTE_SIZE.valueOf();a.WASMBOY_PALETTE_MEMORY_LOCATION=a.wasmInstance.exports.GBC_PALETTE_LOCATION.valueOf();a.memoryWorkerPort.postMessage(M({type:x.GET_CONSTANTS_DONE,WASMBOY_GAME_BYTES_LOCATION:a.wasmInstance.exports.CARTRIDGE_ROM_LOCATION.valueOf(),WASMBOY_GAME_RAM_BANKS_LOCATION:a.wasmInstance.exports.CARTRIDGE_RAM_LOCATION.valueOf(),WASMBOY_INTERNAL_STATE_SIZE:a.wasmInstance.exports.WASMBOY_STATE_SIZE.valueOf(),
WASMBOY_INTERNAL_STATE_LOCATION:a.wasmInstance.exports.WASMBOY_STATE_LOCATION.valueOf(),WASMBOY_INTERNAL_MEMORY_SIZE:a.wasmInstance.exports.GAMEBOY_INTERNAL_MEMORY_SIZE.valueOf(),WASMBOY_INTERNAL_MEMORY_LOCATION:a.wasmInstance.exports.GAMEBOY_INTERNAL_MEMORY_LOCATION.valueOf(),WASMBOY_PALETTE_MEMORY_SIZE:a.wasmInstance.exports.GBC_PALETTE_SIZE.valueOf(),WASMBOY_PALETTE_MEMORY_LOCATION:a.wasmInstance.exports.GBC_PALETTE_LOCATION.valueOf()},c.messageId));break;case x.SET_MEMORY:b=Object.keys(c.message);
b.includes(D.CARTRIDGE_ROM)&&a.wasmByteMemory.set(new Uint8Array(c.message[D.CARTRIDGE_ROM]),a.WASMBOY_GAME_BYTES_LOCATION);b.includes(D.CARTRIDGE_RAM)&&a.wasmByteMemory.set(new Uint8Array(c.message[D.CARTRIDGE_RAM]),a.WASMBOY_GAME_RAM_BANKS_LOCATION);b.includes(D.GAMEBOY_MEMORY)&&a.wasmByteMemory.set(new Uint8Array(c.message[D.GAMEBOY_MEMORY]),a.WASMBOY_INTERNAL_MEMORY_LOCATION);b.includes(D.PALETTE_MEMORY)&&a.wasmByteMemory.set(new Uint8Array(c.message[D.PALETTE_MEMORY]),a.WASMBOY_PALETTE_MEMORY_LOCATION);
b.includes(D.INTERNAL_STATE)&&(a.wasmByteMemory.set(new Uint8Array(c.message[D.INTERNAL_STATE]),a.WASMBOY_INTERNAL_STATE_LOCATION),a.wasmInstance.exports.loadState());a.memoryWorkerPort.postMessage(M({type:x.SET_MEMORY_DONE},c.messageId));break;case x.GET_MEMORY:{b={type:x.GET_MEMORY};const P=[];var d=c.message.memoryTypes;if(d.includes(D.CARTRIDGE_ROM)){if(a.wasmByteMemory){var f=a.wasmByteMemory[a.WASMBOY_GAME_BYTES_LOCATION+327];var e=void 0;0===f?e=32768:1<=f&&3>=f?e=2097152:5<=f&&6>=f?e=262144:
15<=f&&19>=f?e=2097152:25<=f&&30>=f&&(e=8388608);f=e?a.wasmByteMemory.slice(a.WASMBOY_GAME_BYTES_LOCATION,a.WASMBOY_GAME_BYTES_LOCATION+e):new Uint8Array}else f=new Uint8Array;f=f.buffer;b[D.CARTRIDGE_ROM]=f;P.push(f)}d.includes(D.CARTRIDGE_RAM)&&(f=Wb(a).buffer,b[D.CARTRIDGE_RAM]=f,P.push(f));d.includes(D.CARTRIDGE_HEADER)&&(a.wasmByteMemory?(f=a.WASMBOY_GAME_BYTES_LOCATION+308,f=a.wasmByteMemory.slice(f,f+27)):f=new Uint8Array,f=f.buffer,b[D.CARTRIDGE_HEADER]=f,P.push(f));d.includes(D.GAMEBOY_MEMORY)&&
(f=a.wasmByteMemory.slice(a.WASMBOY_INTERNAL_MEMORY_LOCATION,a.WASMBOY_INTERNAL_MEMORY_LOCATION+a.WASMBOY_INTERNAL_MEMORY_SIZE).buffer,b[D.GAMEBOY_MEMORY]=f,P.push(f));d.includes(D.PALETTE_MEMORY)&&(f=a.wasmByteMemory.slice(a.WASMBOY_PALETTE_MEMORY_LOCATION,a.WASMBOY_PALETTE_MEMORY_LOCATION+a.WASMBOY_PALETTE_MEMORY_SIZE).buffer,b[D.PALETTE_MEMORY]=f,P.push(f));d.includes(D.INTERNAL_STATE)&&(a.wasmInstance.exports.saveState(),d=Xb(a).buffer,b[D.INTERNAL_STATE]=d,P.push(d));a.memoryWorkerPort.postMessage(M(b,
c.messageId),P)}}}function ob(a,c){a=1<<a&255;b.registerF=0<c?b.registerF|a:b.registerF&(255^a);return b.registerF}function t(a){ob(7,a)}function v(a){ob(6,a)}function G(a){ob(5,a)}function K(a){ob(4,a)}function Ta(){return b.registerF>>7&1}function U(){return b.registerF>>4&1}function R(a,c){0<=c?G(0!==((a&15)+(c&15)&16)):G((Math.abs(c)&15)>(a&15))}function Bb(a,c){0<=c?K(a>(a+c&255)):K(Math.abs(c)>a)}function Wa(a,c,b){b?(a=a^c^a+c,G(0!==(a&16)),K(0!==(a&256))):(b=a+c&65535,K(b<a),G(0!==((a^c^b)&
4096)))}function Yb(a){switch(a){case 0:d.bgWhite=L.bgWhite;d.bgLightGrey=L.bgLightGrey;d.bgDarkGrey=L.bgDarkGrey;d.bgBlack=L.bgBlack;d.obj0White=L.obj0White;d.obj0LightGrey=L.obj0LightGrey;d.obj0DarkGrey=L.obj0DarkGrey;d.obj0Black=L.obj0Black;d.obj1White=L.obj1White;d.obj1LightGrey=L.obj1LightGrey;d.obj1DarkGrey=L.obj1DarkGrey;d.obj1Black=L.obj1Black;break;case 1:d.bgWhite=ja.bgWhite;d.bgLightGrey=ja.bgLightGrey;d.bgDarkGrey=ja.bgDarkGrey;d.bgBlack=ja.bgBlack;d.obj0White=ja.obj0White;d.obj0LightGrey=
ja.obj0LightGrey;d.obj0DarkGrey=ja.obj0DarkGrey;d.obj0Black=ja.obj0Black;d.obj1White=ja.obj1White;d.obj1LightGrey=ja.obj1LightGrey;d.obj1DarkGrey=ja.obj1DarkGrey;d.obj1Black=ja.obj1Black;break;case 2:d.bgWhite=ka.bgWhite;d.bgLightGrey=ka.bgLightGrey;d.bgDarkGrey=ka.bgDarkGrey;d.bgBlack=ka.bgBlack;d.obj0White=ka.obj0White;d.obj0LightGrey=ka.obj0LightGrey;d.obj0DarkGrey=ka.obj0DarkGrey;d.obj0Black=ka.obj0Black;d.obj1White=ka.obj1White;d.obj1LightGrey=ka.obj1LightGrey;d.obj1DarkGrey=ka.obj1DarkGrey;
d.obj1Black=ka.obj1Black;break;case 3:d.bgWhite=la.bgWhite;d.bgLightGrey=la.bgLightGrey;d.bgDarkGrey=la.bgDarkGrey;d.bgBlack=la.bgBlack;d.obj0White=la.obj0White;d.obj0LightGrey=la.obj0LightGrey;d.obj0DarkGrey=la.obj0DarkGrey;d.obj0Black=la.obj0Black;d.obj1White=la.obj1White;d.obj1LightGrey=la.obj1LightGrey;d.obj1DarkGrey=la.obj1DarkGrey;d.obj1Black=la.obj1Black;break;case 4:d.bgWhite=ma.bgWhite;d.bgLightGrey=ma.bgLightGrey;d.bgDarkGrey=ma.bgDarkGrey;d.bgBlack=ma.bgBlack;d.obj0White=ma.obj0White;d.obj0LightGrey=
ma.obj0LightGrey;d.obj0DarkGrey=ma.obj0DarkGrey;d.obj0Black=ma.obj0Black;d.obj1White=ma.obj1White;d.obj1LightGrey=ma.obj1LightGrey;d.obj1DarkGrey=ma.obj1DarkGrey;d.obj1Black=ma.obj1Black;break;case 5:d.bgWhite=na.bgWhite;d.bgLightGrey=na.bgLightGrey;d.bgDarkGrey=na.bgDarkGrey;d.bgBlack=na.bgBlack;d.obj0White=na.obj0White;d.obj0LightGrey=na.obj0LightGrey;d.obj0DarkGrey=na.obj0DarkGrey;d.obj0Black=na.obj0Black;d.obj1White=na.obj1White;d.obj1LightGrey=na.obj1LightGrey;d.obj1DarkGrey=na.obj1DarkGrey;
d.obj1Black=na.obj1Black;break;case 6:d.bgWhite=oa.bgWhite;d.bgLightGrey=oa.bgLightGrey;d.bgDarkGrey=oa.bgDarkGrey;d.bgBlack=oa.bgBlack;d.obj0White=oa.obj0White;d.obj0LightGrey=oa.obj0LightGrey;d.obj0DarkGrey=oa.obj0DarkGrey;d.obj0Black=oa.obj0Black;d.obj1White=oa.obj1White;d.obj1LightGrey=oa.obj1LightGrey;d.obj1DarkGrey=oa.obj1DarkGrey;d.obj1Black=oa.obj1Black;break;case 7:d.bgWhite=pa.bgWhite;d.bgLightGrey=pa.bgLightGrey;d.bgDarkGrey=pa.bgDarkGrey;d.bgBlack=pa.bgBlack;d.obj0White=pa.obj0White;d.obj0LightGrey=
pa.obj0LightGrey;d.obj0DarkGrey=pa.obj0DarkGrey;d.obj0Black=pa.obj0Black;d.obj1White=pa.obj1White;d.obj1LightGrey=pa.obj1LightGrey;d.obj1DarkGrey=pa.obj1DarkGrey;d.obj1Black=pa.obj1Black;break;case 8:d.bgWhite=qa.bgWhite;d.bgLightGrey=qa.bgLightGrey;d.bgDarkGrey=qa.bgDarkGrey;d.bgBlack=qa.bgBlack;d.obj0White=qa.obj0White;d.obj0LightGrey=qa.obj0LightGrey;d.obj0DarkGrey=qa.obj0DarkGrey;d.obj0Black=qa.obj0Black;d.obj1White=qa.obj1White;d.obj1LightGrey=qa.obj1LightGrey;d.obj1DarkGrey=qa.obj1DarkGrey;
d.obj1Black=qa.obj1Black;break;case 9:d.bgWhite=ra.bgWhite;d.bgLightGrey=ra.bgLightGrey;d.bgDarkGrey=ra.bgDarkGrey;d.bgBlack=ra.bgBlack;d.obj0White=ra.obj0White;d.obj0LightGrey=ra.obj0LightGrey;d.obj0DarkGrey=ra.obj0DarkGrey;d.obj0Black=ra.obj0Black;d.obj1White=ra.obj1White;d.obj1LightGrey=ra.obj1LightGrey;d.obj1DarkGrey=ra.obj1DarkGrey;d.obj1Black=ra.obj1Black;break;case 10:d.bgWhite=sa.bgWhite;d.bgLightGrey=sa.bgLightGrey;d.bgDarkGrey=sa.bgDarkGrey;d.bgBlack=sa.bgBlack;d.obj0White=sa.obj0White;
d.obj0LightGrey=sa.obj0LightGrey;d.obj0DarkGrey=sa.obj0DarkGrey;d.obj0Black=sa.obj0Black;d.obj1White=sa.obj1White;d.obj1LightGrey=sa.obj1LightGrey;d.obj1DarkGrey=sa.obj1DarkGrey;d.obj1Black=sa.obj1Black;break;case 11:d.bgWhite=ta.bgWhite;d.bgLightGrey=ta.bgLightGrey;d.bgDarkGrey=ta.bgDarkGrey;d.bgBlack=ta.bgBlack;d.obj0White=ta.obj0White;d.obj0LightGrey=ta.obj0LightGrey;d.obj0DarkGrey=ta.obj0DarkGrey;d.obj0Black=ta.obj0Black;d.obj1White=ta.obj1White;d.obj1LightGrey=ta.obj1LightGrey;d.obj1DarkGrey=
ta.obj1DarkGrey;d.obj1Black=ta.obj1Black;break;case 12:d.bgWhite=ua.bgWhite,d.bgLightGrey=ua.bgLightGrey,d.bgDarkGrey=ua.bgDarkGrey,d.bgBlack=ua.bgBlack,d.obj0White=ua.obj0White,d.obj0LightGrey=ua.obj0LightGrey,d.obj0DarkGrey=ua.obj0DarkGrey,d.obj0Black=ua.obj0Black,d.obj1White=ua.obj1White,d.obj1LightGrey=ua.obj1LightGrey,d.obj1DarkGrey=ua.obj1DarkGrey,d.obj1Black=ua.obj1Black}}function n(a,c){return(a&255)<<8|c&255}function E(a){return(a&65280)>>8}function H(a,c){return c&~(1<<a)}function p(a,c){return 0!=
(c&1<<a)}function pb(a,c){a=w(c)>>2*a&3;if(c===Xa.memoryLocationSpritePaletteOne)switch(c=d.obj0White,a){case 1:c=d.obj0LightGrey;break;case 2:c=d.obj0DarkGrey;break;case 3:c=d.obj0Black}else if(c===Xa.memoryLocationSpritePaletteTwo)switch(c=d.obj1White,a){case 1:c=d.obj1LightGrey;break;case 2:c=d.obj1DarkGrey;break;case 3:c=d.obj1Black}else switch(c=d.bgWhite,a){case 1:c=d.bgLightGrey;break;case 2:c=d.bgDarkGrey;break;case 3:c=d.bgBlack}return c}function qb(a,c,b){c=8*a+2*c;a=Zb(c+1,b);b=Zb(c,b);
return n(a,b)}function va(a,c){a*=5;return 8*((c&31<<a)>>a)}function Zb(a,c){a&=63;c&&(a+=64);return e[Ya+a]}function rb(a,c,b,d){void 0===b&&(b=0);void 0===d&&(d=!1);b&=3;d&&(b|=4);e[Za+(160*c+a)]=b}function Cb(a,c,d,B,f,h,g,k,m,l,n,u,v,q){var P=0;c=gb(c,a);a=X(c+2*h,d);d=X(c+2*h+1,d);for(h=B;h<=f;++h)if(c=g+(h-B),c<m){var C=h;if(0>v||!p(5,v))C=7-C;var ia=0;p(C,d)&&(ia+=1,ia<<=1);p(C,a)&&(ia+=1);if(b.GBCEnabled&&(0<=v||0<=q)){C=0<=q;var fa=v&7;C&&(fa=q&7);var ha=qb(fa,ia,C);C=va(0,ha);fa=va(1,ha);
ha=va(2,ha)}else if(0>=u&&(u=r.memoryLocationBackgroundPalette),n){fa=ia;ha=n;void 0===ha&&(ha=!1);C=fa;ha||(C=w(u)>>(fa<<1)&3);fa=242;switch(C){case 1:fa=160;break;case 2:fa=88;break;case 3:fa=8}fa=C=ha=fa}else ha=pb(ia,u),C=(ha&16711680)>>16,fa=(ha&65280)>>8,ha&=255;l+=3*(k*m+c);e[l+0]=C;e[l+1]=fa;e[l+2]=ha;C=!1;0<=v&&(C=p(7,v));rb(c,k,ia,C);P++}return P}function gb(a,c){a===r.memoryLocationTileDataSelectZeroStart&&(c=p(7,c)?c-128:c+128);return a+16*c}function $b(a,c){switch(a){case 1:return p(c,
129);case 2:return p(c,135);case 3:return p(c,126);default:return p(c,1)}}function ac(){var a=bc();2047>=a&&0<z.NRx0SweepShift&&(z.sweepShadowFrequency=a,z.setFrequency(a),a=bc());2047<a&&(z.isEnabled=!1)}function bc(){var a=z.sweepShadowFrequency;var c=a>>z.NRx0SweepShift;return c=z.NRx0Negate?a-c:a+c}function sb(a){switch(a){case z.channelNumber:a=z.isDacEnabled;var c=q.channel1DacEnabled!==a;q.channel1DacEnabled=a;return c;case N.channelNumber:return a=N.isDacEnabled,c=q.channel2DacEnabled!==a,
q.channel2DacEnabled=a,c;case J.channelNumber:return a=J.isDacEnabled,c=q.channel3DacEnabled!==a,q.channel3DacEnabled=a,c;case O.channelNumber:return a=O.isDacEnabled,c=q.channel4DacEnabled!==a,q.channel4DacEnabled=a,c}return!1}function tb(){for(var a=k.batchProcessCycles();k.currentCycles>=a;)cc(a),k.currentCycles-=a}function cc(a){var c=k.maxFrameSequenceCycles();var b=k.frameSequenceCycleCounter+a;if(b>=c){k.frameSequenceCycleCounter=b-c;c=k.frameSequencer;switch(c){case 0:z.updateLength();N.updateLength();
J.updateLength();O.updateLength();break;case 2:z.updateLength();N.updateLength();J.updateLength();O.updateLength();z.updateSweep();break;case 4:z.updateLength();N.updateLength();J.updateLength();O.updateLength();break;case 6:z.updateLength();N.updateLength();J.updateLength();O.updateLength();z.updateSweep();break;case 7:z.updateEnvelope(),N.updateEnvelope(),O.updateEnvelope()}k.frameSequencer=c+1&7;c=!0}else k.frameSequenceCycleCounter=b,c=!1;if(S.audioAccumulateSamples&&!c){c=z.willChannelUpdate(a)||
sb(z.channelNumber);b=N.willChannelUpdate(a)||sb(N.channelNumber);var d=J.willChannelUpdate(a)||sb(J.channelNumber),f=O.willChannelUpdate(a)||sb(O.channelNumber);c&&(q.channel1Sample=z.getSampleFromCycleCounter());b&&(q.channel2Sample=N.getSampleFromCycleCounter());d&&(q.channel3Sample=J.getSampleFromCycleCounter());f&&(q.channel4Sample=O.getSampleFromCycleCounter());if(c||b||d||f)q.needToRemixSamples=!0;c=k.downSampleCycleCounter;c+=a*k.downSampleCycleMultiplier;a=k.maxDownSampleCycles();c>=a&&(c-=
a,k.downSampleCycleCounter=c,q.needToRemixSamples||q.mixerVolumeChanged||q.mixerEnabledChanged?$a(q.channel1Sample,q.channel2Sample,q.channel3Sample,q.channel4Sample):k.downSampleCycleCounter=c,ab(q.leftChannelSampleUnsignedByte+1,q.rightChannelSampleUnsignedByte+1,ub),a=k.audioQueueIndex+1,a>=(k.wasmBoyMemoryMaxBufferSize>>1|0)-1&&--a,k.audioQueueIndex=a)}else if(c=z.getSample(a)|0,b=N.getSample(a)|0,d=J.getSample(a)|0,f=O.getSample(a)|0,q.channel1Sample=c,q.channel2Sample=b,q.channel3Sample=d,q.channel4Sample=
f,a=k.downSampleCycleCounter+a*k.downSampleCycleMultiplier,a>=k.maxDownSampleCycles()){a-=k.maxDownSampleCycles();k.downSampleCycleCounter=a;a=$a(c,b,d,f);var e=E(a);ab(e+1,(a&255)+1,ub);S.enableAudioDebugging&&(a=$a(c,15,15,15),e=E(a),ab(e+1,(a&255)+1,Db),a=$a(15,b,15,15),e=E(a),ab(e+1,(a&255)+1,Eb),a=$a(15,15,d,15),e=E(a),ab(e+1,(a&255)+1,Fb),a=$a(15,15,15,f),e=E(a),ab(e+1,(a&255)+1,Gb));a=k.audioQueueIndex+1;a>=(k.wasmBoyMemoryMaxBufferSize>>1|0)-1&&--a;k.audioQueueIndex=a}}function dc(){return k.audioQueueIndex}
function ec(){k.audioQueueIndex=0}function $a(a,c,b,d){void 0===a&&(a=15);void 0===c&&(c=15);void 0===b&&(b=15);void 0===d&&(d=15);q.mixerVolumeChanged=!1;var P=0+(k.NR51IsChannel1EnabledOnLeftOutput?a:15);P+=k.NR51IsChannel2EnabledOnLeftOutput?c:15;P+=k.NR51IsChannel3EnabledOnLeftOutput?b:15;P+=k.NR51IsChannel4EnabledOnLeftOutput?d:15;a=0+(k.NR51IsChannel1EnabledOnRightOutput?a:15);a+=k.NR51IsChannel2EnabledOnRightOutput?c:15;a+=k.NR51IsChannel3EnabledOnRightOutput?b:15;a+=k.NR51IsChannel4EnabledOnRightOutput?
d:15;q.mixerEnabledChanged=!1;q.needToRemixSamples=!1;c=fc(P,k.NR50LeftMixerVolume+1);b=fc(a,k.NR50RightMixerVolume+1);q.leftChannelSampleUnsignedByte=c;q.rightChannelSampleUnsignedByte=b;return n(c,b)}function fc(a,c){if(60===a)return 127;a=1E5*(a-60)*c>>3;a=(a/1E5|0)+60;a=1E5*a/(12E6/254|0)|0;return a|=0}function ab(a,c,b){b+=k.audioQueueIndex<<1;e[b+0]=a+1;e[b+1]=c+1}function hb(a){vb(!1);var c=w(m.memoryLocationInterruptRequest);c=H(a,c);m.interruptsRequestedValue=c;h(m.memoryLocationInterruptRequest,
c);b.stackPointer-=2;b.isHalted();c=b.stackPointer;var d=b.programCounter,B=E(d);h(c+0,d&255);h(c+1,B);switch(a){case m.bitPositionVBlankInterrupt:m.isVBlankInterruptRequested=!1;b.programCounter=64;break;case m.bitPositionLcdInterrupt:m.isLcdInterruptRequested=!1;b.programCounter=72;break;case m.bitPositionTimerInterrupt:m.isTimerInterruptRequested=!1;b.programCounter=80;break;case m.bitPositionSerialInterrupt:m.isSerialInterruptRequested=!1;b.programCounter=88;break;case m.bitPositionJoypadInterrupt:m.isJoypadInterruptRequested=
!1,b.programCounter=96}}function bb(a){var c=w(m.memoryLocationInterruptRequest);c|=1<<a;m.interruptsRequestedValue=c;h(m.memoryLocationInterruptRequest,c)}function vb(a){a?m.masterInterruptSwitchDelay=!0:m.masterInterruptSwitch=!1}function Hb(a){for(var c=0;c<a;){var b=u.dividerRegister,d=b;c+=4;d+=4;d&=65535;u.dividerRegister=d;if(u.timerEnabled){var f=u.timerCounterWasReset;u.timerCounterOverflowDelay?(u.timerCounter=u.timerModulo,m.isTimerInterruptRequested=!0,bb(m.bitPositionTimerInterrupt),
u.timerCounterOverflowDelay=!1,u.timerCounterWasReset=!0):f&&(u.timerCounterWasReset=!1);gc(b,d)&&Ib()}}}function Ib(){var a=u.timerCounter;255<++a&&(u.timerCounterOverflowDelay=!0,a=0);u.timerCounter=a}function gc(a,c){var b=Jb(u.timerInputClock);return p(b,a)&&!p(b,c)}function Jb(a){switch(a){case 0:return 9;case 1:return 3;case 2:return 5;case 3:return 7}return 0}function Ua(a){var c=b.isStopped=!1;Ac(a)||(c=!0);Ja(a,!0);c&&(c=!1,3>=a&&(c=!0),a=!1,A.isDpadType&&c&&(a=!0),A.isButtonType&&!c&&(a=
!0),a&&(m.isJoypadInterruptRequested=!0,bb(m.bitPositionJoypadInterrupt)))}function Ac(a){switch(a){case 0:return A.up;case 1:return A.right;case 2:return A.down;case 3:return A.left;case 4:return A.a;case 5:return A.b;case 6:return A.select;case 7:return A.start;default:return!1}}function Ja(a,c){switch(a){case 0:A.up=c;break;case 1:A.right=c;break;case 2:A.down=c;break;case 3:A.left=c;break;case 4:A.a=c;break;case 5:A.b=c;break;case 6:A.select=c;break;case 7:A.start=c}}function hc(a,c,d){for(var P=
0;P<d;++P){for(var f=Kb(a+P),e=c+P;40959<e;)e-=8192;ic(e,f)}g.DMACycles+=(32<<b.GBCDoubleSpeed)*(d>>4)}function Lb(a,c){if(a===b.memoryLocationSpeedSwitch)return h(b.memoryLocationSpeedSwitch,c&1),!1;var d=g.videoRamLocation,B=g.spriteInformationTableLocation;if(a<d){if(!g.isRomOnly){d=g.isMBC1;var f=g.isMBC2;if(8191>=a){if(!f||p(4,c))c&=15,0===c?g.isRamBankingEnabled=!1:10===c&&(g.isRamBankingEnabled=!0)}else 16383>=a?(B=g.isMBC5,!B||12287>=a?(a=g.currentRomBank,f&&(a=c&15),d?(c&=31,a&=224):g.isMBC3?
(c&=127,a&=128):B&&(a&=0),g.currentRomBank=a|c):g.currentRomBank=n(0<c,g.currentRomBank&255)):!f&&24575>=a?d&&g.isMBC1RomModeEnabled?(a=g.currentRomBank&31,g.currentRomBank=a|c&224):(c=g.isMBC5?c&15:c&3,g.currentRamBank=c):!f&&32767>=a&&d&&(g.isMBC1RomModeEnabled=p(0,c))}return!1}if(a>=d&&a<g.cartridgeRamLocation)return!0;if(a>=g.echoRamLocation&&a<B)return h(a-8192,c),!0;if(a>=B&&a<=g.spriteInformationTableLocationEnd)return 2<=y.currentLcdMode;if(a>=g.unusableMemoryLocation&&a<=g.unusableMemoryEndLocation)return!1;
if(a===Z.memoryLocationSerialTransferControl)return Z.updateTransferControl(c);if(65296<=a&&65318>=a){tb();if(a===k.memoryLocationNR52||k.NR52IsSoundEnabled){switch(a){case z.memoryLocationNRx0:z.updateNRx0(c);break;case J.memoryLocationNRx0:J.updateNRx0(c);break;case z.memoryLocationNRx1:z.updateNRx1(c);break;case N.memoryLocationNRx1:N.updateNRx1(c);break;case J.memoryLocationNRx1:J.updateNRx1(c);break;case O.memoryLocationNRx1:O.updateNRx1(c);break;case z.memoryLocationNRx2:z.updateNRx2(c);break;
case N.memoryLocationNRx2:N.updateNRx2(c);break;case J.memoryLocationNRx2:J.volumeCodeChanged=!0;J.updateNRx2(c);break;case O.memoryLocationNRx2:O.updateNRx2(c);break;case z.memoryLocationNRx3:z.updateNRx3(c);break;case N.memoryLocationNRx3:N.updateNRx3(c);break;case J.memoryLocationNRx3:J.updateNRx3(c);break;case O.memoryLocationNRx3:O.updateNRx3(c);break;case z.memoryLocationNRx4:p(7,c)&&(z.updateNRx4(c),z.trigger());break;case N.memoryLocationNRx4:p(7,c)&&(N.updateNRx4(c),N.trigger());break;case J.memoryLocationNRx4:p(7,
c)&&(J.updateNRx4(c),J.trigger());break;case O.memoryLocationNRx4:p(7,c)&&(O.updateNRx4(c),O.trigger());break;case k.memoryLocationNR50:k.updateNR50(c);q.mixerVolumeChanged=!0;break;case k.memoryLocationNR51:k.updateNR51(c);q.mixerEnabledChanged=!0;break;case k.memoryLocationNR52:if(k.updateNR52(c),!p(7,c))for(c=65296;65318>c;++c)h(c,0)}c=!0}else c=!1;return c}65328<=a&&65343>=a&&tb();if(a>=y.memoryLocationLcdControl&&a<=r.memoryLocationWindowX){if(a===y.memoryLocationLcdControl)return y.updateLcdControl(c),
!0;if(a===y.memoryLocationLcdStatus)return y.updateLcdStatus(c),!1;if(a===r.memoryLocationScanlineRegister)return r.scanlineRegister=0,h(a,0),!1;if(a===y.memoryLocationCoincidenceCompare)return y.coincidenceCompare=c,!0;if(a===r.memoryLocationDmaTransfer){c<<=8;for(a=0;159>=a;++a)d=w(c+a),h(g.spriteInformationTableLocation+a,d);g.DMACycles=644;return!0}switch(a){case r.memoryLocationScrollX:r.scrollX=c;break;case r.memoryLocationScrollY:r.scrollY=c;break;case r.memoryLocationWindowX:r.windowX=c;break;
case r.memoryLocationWindowY:r.windowY=c}return!0}if(a===g.memoryLocationHdmaTrigger)return b.GBCEnabled&&(g.isHblankHdmaActive&&!p(7,c)?(g.isHblankHdmaActive=!1,c=w(g.memoryLocationHdmaTrigger),h(g.memoryLocationHdmaTrigger,c|128)):(a=w(g.memoryLocationHdmaSourceHigh),d=w(g.memoryLocationHdmaSourceLow),a=n(a,d)&65520,d=w(g.memoryLocationHdmaDestinationHigh),B=w(g.memoryLocationHdmaDestinationLow),d=n(d,B),d=(d&8176)+g.videoRamLocation,B=H(7,c),B=B+1<<4,p(7,c)?(g.isHblankHdmaActive=!0,g.hblankHdmaTransferLengthRemaining=
B,g.hblankHdmaSource=a,g.hblankHdmaDestination=d,h(g.memoryLocationHdmaTrigger,H(7,c))):(hc(a,d,B),h(g.memoryLocationHdmaTrigger,255)))),!1;if((a===g.memoryLocationGBCWRAMBank||a===g.memoryLocationGBCVRAMBank)&&g.isHblankHdmaActive&&(d=g.hblankHdmaSource,16384<=d&&32767>=d||53248<=d&&57343>=d))return!1;if(a>=Xa.memoryLocationBackgroundPaletteIndex&&a<=Xa.memoryLocationSpritePaletteData){d=Xa.memoryLocationSpritePaletteData;if(a===Xa.memoryLocationBackgroundPaletteData||a===d)B=w(a-1),B=H(6,B),f=B&
63,a===d&&(f+=64),e[Ya+f]=c,c=B,--a,p(7,c)&&h(a,c+1|128);return!0}if(a>=u.memoryLocationDividerRegister&&a<=u.memoryLocationTimerControl){Hb(u.currentCycles);u.currentCycles=0;switch(a){case u.memoryLocationDividerRegister:return u.updateDividerRegister(),!1;case u.memoryLocationTimerCounter:u.updateTimerCounter(c);break;case u.memoryLocationTimerModulo:u.updateTimerModulo(c);break;case u.memoryLocationTimerControl:u.updateTimerControl(c)}return!0}a===A.memoryLocationJoypadRegister&&A.updateJoypad(c);
if(a===m.memoryLocationInterruptRequest)return m.updateInterruptRequested(c),!0;a===m.memoryLocationInterruptEnabled&&m.updateInterruptEnabled(c);return!0}function Mb(a){switch(a>>12){case 0:case 1:case 2:case 3:return a+wb;case 4:case 5:case 6:case 7:var c=g.currentRomBank;g.isMBC5||0!==c||(c=1);return 16384*c+(a-g.switchableCartridgeRomLocation)+wb;case 8:case 9:return c=0,b.GBCEnabled&&(c=w(g.memoryLocationGBCVRAMBank)&1),a-g.videoRamLocation+2048+8192*c;case 10:case 11:return 8192*g.currentRamBank+
(a-g.cartridgeRamLocation)+Nb;case 12:return a-g.internalRamBankZeroLocation+18432;case 13:return c=0,b.GBCEnabled&&(c=w(g.memoryLocationGBCWRAMBank)&7),a-g.internalRamBankZeroLocation+18432+4096*((1>c?1:c)-1);default:return a-g.echoRamLocation+51200}}function h(a,c){a=Mb(a);e[a]=c}function ic(a,c){a===aa.writeGbMemory&&(aa.reachedBreakpoint=!0);Lb(a,c)&&h(a,c)}function jc(a){r.scanlineCycleCounter=0;r.scanlineRegister=0;h(r.memoryLocationScanlineRegister,0);var c=w(y.memoryLocationLcdStatus);c=H(1,
c);c=H(0,c);y.currentLcdMode=0;h(y.memoryLocationLcdStatus,c);if(a)for(a=0;93184>a;++a)e[cb+a]=255}function kc(a,c){0!==a&&1!==a||r.scanlineRegister!==y.coincidenceCompare?c=H(2,c):(c|=4,p(6,c)&&(m.isLcdInterruptRequested=!0,bb(m.bitPositionLcdInterrupt)));return c}function lc(a,c,d,B,f,h){for(var P=B>>3;160>f;++f){var g=f+h;256<=g&&(g-=256);var C=d+(P<<5)+(g>>3),k=X(C,0),m=!1;if(S.tileCaching){var l=f;var n=a,u=g,ia=C,v=k,q=0,t=db.nextXIndexToPerformCacheCheck;if(0<n&&8<l&&v===db.tileId&&l===t){v=
p(5,w(ia-1));ia=p(5,w(ia));for(var y=0;8>y;++y){v!==ia&&(y=7-y);var x=l+y;if(160>=x){var z=l-(8-y),A=cb+3*(160*n+x);ca(x,n,0,e[A]);ca(x,n,1,e[A]);ca(x,n,2,e[A]);z=e[Za+(160*n+z)];rb(x,n,H(2,z),p(2,z));q++}}}else db.tileId=v;l>=t&&(t=l+8,n=u&7|0,l<n&&(t+=n));db.nextXIndexToPerformCacheCheck=t;l=q;0<l&&(f+=l-1,m=!0)}S.tileRendering&&!m?(m=f,l=a,n=g,g=c,q=B&7|0,t=0,0==m&&(t=n-(n>>3<<3)),n=7,160<m+8&&(n=160-m),u=-1,v=0,b.GBCEnabled&&(u=X(C,1),v=p(3,u)|0,p(6,u)&&(q=7-q)),l=Cb(k,g,v,t,n,q,m,l,160,cb,!1,
0,u,-1),0<l&&(f+=l-1)):m||(b.GBCEnabled?(m=f,l=a,t=B,q=gb(c,k),k=X(C,1),t=t&7|0,p(6,k)&&(t=7-t),n=p(3,k)|0,C=X(q+2*t,n),q=X(q+2*t+1,n),t=g&7|0,p(5,k)||(t=7-t),g=0,p(t,q)&&(g=g+1<<1),p(t,C)&&(g+=1),t=qb(k&7,g,!1),C=va(0,t),q=va(1,t),t=va(2,t),ca(m,l,0,C),ca(m,l,1,q),ca(m,l,2,t),rb(m,l,g,p(7,k))):(C=f,m=a,q=B,l=gb(c,k),q=q&7|0,k=X(l+2*q,0),l=X(l+2*q+1,0),q=g&7|0,q=7-q,g=0,p(q,l)&&(g=g+1<<1),p(q,k)&&(g+=1),k=pb(g,r.memoryLocationBackgroundPalette),ca(C,m,0,(k&16711680)>>16),ca(C,m,1,(k&65280)>>8),ca(C,
m,2,k&255),rb(C,m,g)))}}function mc(a){if(y.enabled)for(r.scanlineCycleCounter+=a,a=S.graphicsDisableScanlineRendering;r.scanlineCycleCounter>=r.MAX_CYCLES_PER_SCANLINE();){r.scanlineCycleCounter-=r.MAX_CYCLES_PER_SCANLINE();var c=r.scanlineRegister;if(144===c){if(a)for(var b=0;144>=b;++b)Ob(b);else Ob(c);for(b=0;144>b;++b)for(var d=0;160>d;++d)e[Za+(160*b+d)]=0;db.tileId=-1;db.nextXIndexToPerformCacheCheck=-1}else 144>c&&(a||Ob(c));c=153<c?0:c+1;r.scanlineRegister=c}if(y.enabled){c=r.scanlineRegister;
b=y.currentLcdMode;a=0;if(144<=c)a=1;else{d=r.scanlineCycleCounter;var f=r.MIN_CYCLES_SPRITES_LCD_MODE();d>=f?a=2:d>=f&&(a=3)}if(b!==a){c=w(y.memoryLocationLcdStatus);y.currentLcdMode=a;b=!1;switch(a){case 0:c=H(0,c);c=H(1,c);b=p(3,c);break;case 1:c=H(1,c);c|=1;b=p(4,c);break;case 2:c=H(0,c);c|=2;b=p(5,c);break;case 3:c|=3}b&&(m.isLcdInterruptRequested=!0,bb(m.bitPositionLcdInterrupt));0===a&&g.isHblankHdmaActive&&(d=16,b=g.hblankHdmaTransferLengthRemaining,b<d&&(d=b),hc(g.hblankHdmaSource,g.hblankHdmaDestination,
d),g.hblankHdmaSource+=d,g.hblankHdmaDestination+=d,b-=d,g.hblankHdmaTransferLengthRemaining=b,d=g.memoryLocationHdmaTrigger,0>=b?(g.isHblankHdmaActive=!1,h(d,255)):h(d,H(7,(b>>4)-1)));1===a&&(m.isVBlankInterruptRequested=!0,bb(m.bitPositionVBlankInterrupt));c=kc(a,c);h(y.memoryLocationLcdStatus,c)}else 153===c&&(c=w(y.memoryLocationLcdStatus),c=kc(a,c),h(y.memoryLocationLcdStatus,c))}}function Ob(a){var c=r.memoryLocationTileDataSelectZeroStart;y.bgWindowTileDataSelect&&(c=r.memoryLocationTileDataSelectOneStart);
if(b.GBCEnabled||y.bgDisplayEnabled){var d=r.memoryLocationTileMapSelectZeroStart;y.bgTileMapDisplaySelect&&(d=r.memoryLocationTileMapSelectOneStart);lc(a,c,d,a+r.scrollY&255,0,r.scrollX)}if(y.windowDisplayEnabled){d=r.memoryLocationTileMapSelectZeroStart;y.windowTileMapDisplaySelect&&(d=r.memoryLocationTileMapSelectOneStart);var B=r.windowX,f=r.windowY;a<f||(B-=7,lc(a,c,d,a-f,B,-B|0))}if(y.spriteDisplayEnable)for(c=y.tallSpriteSize,d=39;0<=d;--d){f=4*d;var g=r.memoryLocationSpriteAttributesTable+
f,h=w(g+0);B=w(g+1);var k=w(g+2);h-=16;B-=8;var l=8;c&&(l=16,k-=k&1);if(a>=h&&a<h+l){f=w(r.memoryLocationSpriteAttributesTable+f+3);g=p(7,f);var m=p(6,f),n=p(5,f);h=a-h;m&&(h=l-h,--h);h<<=1;k=gb(r.memoryLocationTileDataSelectOneStart,k);k+=h;l=b.GBCEnabled&&p(3,f);h=X(k+0,l);k=X(k+1,l);for(l=7;0<=l;--l){m=l;n&&(m-=7,m=-m);var q=0;p(m,k)&&(q=q+1<<1);p(m,h)&&(q+=1);if(0!==q&&(m=B+(7-l),0<=m&&160>=m)){var t=b.GBCEnabled&&!y.bgDisplayEnabled,u=!1,v=!1;if(!t){var x=e[Za+(160*a+m)],z=x&3;g&&0<z?u=!0:b.GBCEnabled&&
p(2,x)&&0<z&&(v=!0)}if(t||!u&&!v)b.GBCEnabled?(u=qb(f&7,q,!0),q=va(0,u),t=va(1,u),u=va(2,u),ca(m,a,0,q),ca(m,a,1,t),ca(m,a,2,u)):(t=r.memoryLocationSpritePaletteOne,p(4,f)&&(t=r.memoryLocationSpritePaletteTwo),q=pb(q,t),ca(m,a,0,(q&16711680)>>16),ca(m,a,1,(q&65280)>>8),ca(m,a,2,q&255))}}}}}function ca(a,c,b,d){e[cb+3*(160*c+a)+b]=d}function X(a,c){return e[a-g.videoRamLocation+2048+8192*(c&1)]}function Pb(a){var c=g.videoRamLocation;return a<c||a>=c&&a<g.cartridgeRamLocation?-1:a>=g.echoRamLocation&&
a<g.spriteInformationTableLocation?w(a-8192):a>=g.spriteInformationTableLocation&&a<=g.spriteInformationTableLocationEnd?2>y.currentLcdMode?255:-1:a===b.memoryLocationSpeedSwitch?(a=255,c=w(b.memoryLocationSpeedSwitch),p(0,c)||(a=H(0,a)),b.GBCDoubleSpeed||(a=H(7,a)),a):a===r.memoryLocationScanlineRegister?(h(a,r.scanlineRegister),r.scanlineRegister):65296<=a&&65318>=a?(tb(),a=a===k.memoryLocationNR52?w(k.memoryLocationNR52)&128|112:-1,a):65328<=a&&65343>=a?(tb(),-1):a===u.memoryLocationDividerRegister?
(c=E(u.dividerRegister),h(a,c),c):a===u.memoryLocationTimerCounter?(h(a,u.timerCounter),u.timerCounter):a===m.memoryLocationInterruptRequest?224|m.interruptsRequestedValue:a===A.memoryLocationJoypadRegister?(a=A.joypadRegisterFlipped,A.isDpadType?(a=A.up?H(2,a):a|4,a=A.right?H(0,a):a|1,a=A.down?H(3,a):a|8,a=A.left?H(1,a):a|2):A.isButtonType&&(a=A.a?H(0,a):a|1,a=A.b?H(1,a):a|2,a=A.select?H(2,a):a|4,a=A.start?H(3,a):a|8),a|240):-1}function w(a){return e[Mb(a)]}function Kb(a){a===aa.readGbMemory&&(aa.reachedBreakpoint=
!0);var c=Pb(a);return-1===c?w(a):c}function Q(a){return 0<e[a]}function Ka(a){var c=b.registerA;R(c,a);Bb(c,a);c=c+a&255;b.registerA=c;t(0===c);v(0)}function La(a){var c=b.registerA,d=c+a+U()&255;G(0!=((c^a^d)&16));a=c+a+U()&65535;K(0<(a&256));b.registerA=d;t(0===d);v(0)}function Ma(a){var c=-1*a;var d=b.registerA;R(d,c);Bb(d,c);d=d-a&255;b.registerA=d;t(0===d);v(1)}function Na(a){var c=b.registerA,d=c-a-U()&255;G(0!=((c^a^d)&16));a=c-a-U()&65535;K(0<(a&256));b.registerA=d;t(0===d);v(1)}function Oa(a){a&=
b.registerA;b.registerA=a;t(0===a);v(0);G(1);K(0)}function Pa(a){a=(b.registerA^a)&255;b.registerA=a;t(0===a);v(0);G(0);K(0)}function Qa(a){a|=b.registerA;b.registerA=a;t(0===a);v(0);G(0);K(0)}function Ra(a){var c=b.registerA;a*=-1;R(c,a);Bb(c,a);t(0===c+a);v(1)}function Va(a,c){t(0===(c&1<<a));v(0);G(1);return c}function ba(a,c,b){return 0<c?b|1<<a:b&~(1<<a)}function ib(a){var c=b.programCounter;c=(c+(a<<24>>24)&65535)+1&65535;b.programCounter=c}function nc(a){var c=b.programCounter;c=c+1&65535;
b.isHaltBug&&(c=c-1&65535);b.programCounter=c;switch((a&240)>>4){case 0:return Bc(a);case 1:return Cc(a);case 2:return Dc(a);case 3:return Ec(a);case 4:return Fc(a);case 5:return Gc(a);case 6:return Hc(a);case 7:return Ic(a);case 8:return Jc(a);case 9:return Kc(a);case 10:return Lc(a);case 11:return Mc(a);case 12:return Nc(a);case 13:return Oc(a);case 14:return Pc(a);default:return Qc(a)}}function I(a){Sa(4);return Kb(a)}function T(a,c){Sa(4);ic(a,c)}function Ia(a){Sa(8);var c=Pb(a);c=-1===c?w(a):
c;a+=1;var b=Pb(a);a=-1===b?w(a):b;return n(a,c)}function V(a,c){Sa(8);var b=E(c);c&=255;Lb(a,c)&&h(a,c);a+=1;Lb(a,b)&&h(a,b)}function F(){Sa(4);return w(b.programCounter)}function Y(){Sa(4);var a=w(b.programCounter+1&65535);return n(a,F())}function Bc(a){switch(a){case 0:return 4;case 1:return a=Y(),b.registerB=E(a),b.registerC=a&255,b.programCounter=b.programCounter+2&65535,4;case 2:return T(n(b.registerB,b.registerC),b.registerA),4;case 3:return a=n(b.registerB,b.registerC),a++,b.registerB=E(a),
b.registerC=a&255,8;case 4:return a=b.registerB,R(a,1),a=a+1&255,b.registerB=a,t(0===a),v(0),4;case 5:return a=b.registerB,R(a,-1),a=a-1&255,b.registerB=a,t(0===a),v(1),4;case 6:return b.registerB=F(),b.programCounter=b.programCounter+1&65535,4;case 7:return a=b.registerA,K(128===(a&128)),b.registerA=(a<<1|a>>7)&255,t(0),v(0),G(0),4;case 8:return V(Y(),b.stackPointer),b.programCounter=b.programCounter+2&65535,4;case 9:a=n(b.registerH,b.registerL);var c=n(b.registerB,b.registerC);Wa(a,c,!1);a=a+c&
65535;b.registerH=E(a);b.registerL=a&255;v(0);return 8;case 10:return b.registerA=I(n(b.registerB,b.registerC)),4;case 11:return a=n(b.registerB,b.registerC),a=a-1&65535,b.registerB=E(a),b.registerC=a&255,8;case 12:return a=b.registerC,R(a,1),a=a+1&255,b.registerC=a,t(0===a),v(0),4;case 13:return a=b.registerC,R(a,-1),a=a-1&255,b.registerC=a,t(0===a),v(1),4;case 14:return b.registerC=F(),b.programCounter=b.programCounter+1&65535,4;case 15:return a=b.registerA,K(0<(a&1)),b.registerA=(a>>1|a<<7)&255,
t(0),v(0),G(0),4}return-1}function Cc(a){switch(a){case 16:if(b.GBCEnabled&&(a=I(b.memoryLocationSpeedSwitch),p(0,a)))return a=H(0,a),p(7,a)?(b.GBCDoubleSpeed=!1,a=H(7,a)):(b.GBCDoubleSpeed=!0,a|=128),T(b.memoryLocationSpeedSwitch,a),68;b.isStopped=!0;b.programCounter=b.programCounter+1&65535;return 4;case 17:return a=Y(),b.registerD=E(a),b.registerE=a&255,b.programCounter=b.programCounter+2&65535,4;case 18:return T(n(b.registerD,b.registerE),b.registerA),4;case 19:return a=n(b.registerD,b.registerE),
a=a+1&65535,b.registerD=E(a),b.registerE=a&255,8;case 20:return a=b.registerD,R(a,1),b.registerD=a+1&255,t(0===b.registerD),v(0),4;case 21:return a=b.registerD,R(a,-1),b.registerD=a-1&255,t(0===b.registerD),v(1),4;case 22:return b.registerD=F(),b.programCounter=b.programCounter+1&65535,4;case 23:return a=128===(b.registerA&128),b.registerA=(b.registerA<<1|U())&255,K(a),t(0),v(0),G(0),4;case 24:return ib(F()),8;case 25:a=n(b.registerH,b.registerL);var c=n(b.registerD,b.registerE);Wa(a,c,!1);a=a+c&
65535;b.registerH=E(a);b.registerL=a&255;v(0);return 8;case 26:return a=n(b.registerD,b.registerE),b.registerA=I(a),4;case 27:return a=n(b.registerD,b.registerE),a=a-1&65535,b.registerD=E(a),b.registerE=a&255,8;case 28:return a=b.registerE,R(a,1),a=a+1&255,b.registerE=a,t(0===a),v(0),4;case 29:return a=b.registerE,R(a,-1),a=a-1&255,b.registerE=a,t(0===a),v(1),4;case 30:return b.registerE=F(),b.programCounter=b.programCounter+1&65535,4;case 31:return a=1===(b.registerA&1),b.registerA=(b.registerA>>
1|U()<<7)&255,K(a),t(0),v(0),G(0),4}return-1}function Dc(a){switch(a){case 32:return 0===Ta()?ib(F()):b.programCounter=b.programCounter+1&65535,8;case 33:return a=Y(),b.registerH=E(a),b.registerL=a&255,b.programCounter=b.programCounter+2&65535,4;case 34:return a=n(b.registerH,b.registerL),T(a,b.registerA),a=a+1&65535,b.registerH=E(a),b.registerL=a&255,4;case 35:return a=n(b.registerH,b.registerL),a=a+1&65535,b.registerH=E(a),b.registerL=a&255,8;case 36:return a=b.registerH,R(a,1),a=a+1&255,b.registerH=
a,t(0===a),v(0),4;case 37:return a=b.registerH,R(a,-1),a=a-1&255,b.registerH=a,t(0===a),v(1),4;case 38:return b.registerH=F(),b.programCounter=b.programCounter+1&65535,4;case 39:a=0;0<(b.registerF>>5&1)&&(a|=6);0<U()&&(a|=96);var c=b.registerA;0<(b.registerF>>6&1)?c=c-a&255:(9<(c&15)&&(a|=6),153<c&&(a|=96),c=c+a&255);t(0===c);K(0!==(a&96));G(0);b.registerA=c;return 4;case 40:return 0<Ta()?ib(F()):b.programCounter=b.programCounter+1&65535,8;case 41:return a=n(b.registerH,b.registerL),Wa(a,a,!1),a=
2*a&65535,b.registerH=E(a),b.registerL=a&255,v(0),8;case 42:return a=n(b.registerH,b.registerL),b.registerA=I(a),a=a+1&65535,b.registerH=E(a),b.registerL=a&255,4;case 43:return a=n(b.registerH,b.registerL),a=a-1&65535,b.registerH=E(a),b.registerL=a&255,8;case 44:return a=b.registerL,R(a,1),a=a+1&255,b.registerL=a,t(0===a),v(0),4;case 45:return a=b.registerL,R(a,-1),a=a-1&255,b.registerL=a,t(0===a),v(1),4;case 46:return b.registerL=F(),b.programCounter=b.programCounter+1&65535,4;case 47:return b.registerA=
~b.registerA,v(1),G(1),4}return-1}function Ec(a){switch(a){case 48:return 0===U()?ib(F()):b.programCounter=b.programCounter+1&65535,8;case 49:return b.stackPointer=Y(),b.programCounter=b.programCounter+2&65535,4;case 50:return a=n(b.registerH,b.registerL),T(a,b.registerA),a=a-1&65535,b.registerH=E(a),b.registerL=a&255,4;case 51:return b.stackPointer=b.stackPointer+1&65535,8;case 52:a=n(b.registerH,b.registerL);var c=I(a);R(c,1);c=c+1&255;t(0===c);v(0);T(a,c);return 4;case 53:return a=n(b.registerH,
b.registerL),c=I(a),R(c,-1),c=c-1&255,t(0===c),v(1),T(a,c),4;case 54:return T(n(b.registerH,b.registerL),F()),b.programCounter=b.programCounter+1&65535,4;case 55:return v(0),G(0),K(1),4;case 56:return 1===U()?ib(F()):b.programCounter=b.programCounter+1&65535,8;case 57:return a=n(b.registerH,b.registerL),Wa(a,b.stackPointer,!1),a=a+b.stackPointer&65535,b.registerH=E(a),b.registerL=a&255,v(0),8;case 58:return a=n(b.registerH,b.registerL),b.registerA=I(a),a=a-1&65535,b.registerH=E(a),b.registerL=a&255,
4;case 59:return b.stackPointer=b.stackPointer-1&65535,8;case 60:return a=b.registerA,R(a,1),a=a+1&255,b.registerA=a,t(0===a),v(0),4;case 61:return a=b.registerA,R(a,-1),a=a-1&255,b.registerA=a,t(0===a),v(1),4;case 62:return b.registerA=F(),b.programCounter=b.programCounter+1&65535,4;case 63:return v(0),G(0),K(0>=U()),4}return-1}function Fc(a){switch(a){case 64:return 4;case 65:return b.registerB=b.registerC,4;case 66:return b.registerB=b.registerD,4;case 67:return b.registerB=b.registerE,4;case 68:return b.registerB=
b.registerH,4;case 69:return b.registerB=b.registerL,4;case 70:return b.registerB=I(n(b.registerH,b.registerL)),4;case 71:return b.registerB=b.registerA,4;case 72:return b.registerC=b.registerB,4;case 73:return 4;case 74:return b.registerC=b.registerD,4;case 75:return b.registerC=b.registerE,4;case 76:return b.registerC=b.registerH,4;case 77:return b.registerC=b.registerL,4;case 78:return b.registerC=I(n(b.registerH,b.registerL)),4;case 79:return b.registerC=b.registerA,4}return-1}function Gc(a){switch(a){case 80:return b.registerD=
b.registerB,4;case 81:return b.registerD=b.registerC,4;case 82:return 4;case 83:return b.registerD=b.registerE,4;case 84:return b.registerD=b.registerH,4;case 85:return b.registerD=b.registerL,4;case 86:return b.registerD=I(n(b.registerH,b.registerL)),4;case 87:return b.registerD=b.registerA,4;case 88:return b.registerE=b.registerB,4;case 89:return b.registerE=b.registerC,4;case 90:return b.registerE=b.registerD,4;case 91:return 4;case 92:return b.registerE=b.registerH,4;case 93:return b.registerE=
b.registerL,4;case 94:return b.registerE=I(n(b.registerH,b.registerL)),4;case 95:return b.registerE=b.registerA,4}return-1}function Hc(a){switch(a){case 96:return b.registerH=b.registerB,4;case 97:return b.registerH=b.registerC,4;case 98:return b.registerH=b.registerD,4;case 99:return b.registerH=b.registerE,4;case 100:return b.registerH=b.registerH,4;case 101:return b.registerH=b.registerL,4;case 102:return b.registerH=I(n(b.registerH,b.registerL)),4;case 103:return b.registerH=b.registerA,4;case 104:return b.registerL=
b.registerB,4;case 105:return b.registerL=b.registerC,4;case 106:return b.registerL=b.registerD,4;case 107:return b.registerL=b.registerE,4;case 108:return b.registerL=b.registerH,4;case 109:return b.registerL=b.registerL,4;case 110:return b.registerL=I(n(b.registerH,b.registerL)),4;case 111:return b.registerL=b.registerA,4}return-1}function Ic(a){switch(a){case 112:return T(n(b.registerH,b.registerL),b.registerB),4;case 113:return T(n(b.registerH,b.registerL),b.registerC),4;case 114:return T(n(b.registerH,
b.registerL),b.registerD),4;case 115:return T(n(b.registerH,b.registerL),b.registerE),4;case 116:return T(n(b.registerH,b.registerL),b.registerH),4;case 117:return T(n(b.registerH,b.registerL),b.registerL),4;case 118:return g.isHblankHdmaActive||b.enableHalt(),4;case 119:return T(n(b.registerH,b.registerL),b.registerA),4;case 120:return b.registerA=b.registerB,4;case 121:return b.registerA=b.registerC,4;case 122:return b.registerA=b.registerD,4;case 123:return b.registerA=b.registerE,4;case 124:return b.registerA=
b.registerH,4;case 125:return b.registerA=b.registerL,4;case 126:return b.registerA=I(n(b.registerH,b.registerL)),4;case 127:return 4}return-1}function Jc(a){switch(a){case 128:return Ka(b.registerB),4;case 129:return Ka(b.registerC),4;case 130:return Ka(b.registerD),4;case 131:return Ka(b.registerE),4;case 132:return Ka(b.registerH),4;case 133:return Ka(b.registerL),4;case 134:return a=I(n(b.registerH,b.registerL)),Ka(a),4;case 135:return Ka(b.registerA),4;case 136:return La(b.registerB),4;case 137:return La(b.registerC),
4;case 138:return La(b.registerD),4;case 139:return La(b.registerE),4;case 140:return La(b.registerH),4;case 141:return La(b.registerL),4;case 142:return a=I(n(b.registerH,b.registerL)),La(a),4;case 143:return La(b.registerA),4}return-1}function Kc(a){switch(a){case 144:return Ma(b.registerB),4;case 145:return Ma(b.registerC),4;case 146:return Ma(b.registerD),4;case 147:return Ma(b.registerE),4;case 148:return Ma(b.registerH),4;case 149:return Ma(b.registerL),4;case 150:return a=I(n(b.registerH,b.registerL)),
Ma(a),4;case 151:return Ma(b.registerA),4;case 152:return Na(b.registerB),4;case 153:return Na(b.registerC),4;case 154:return Na(b.registerD),4;case 155:return Na(b.registerE),4;case 156:return Na(b.registerH),4;case 157:return Na(b.registerL),4;case 158:return a=I(n(b.registerH,b.registerL)),Na(a),4;case 159:return Na(b.registerA),4}return-1}function Lc(a){switch(a){case 160:return Oa(b.registerB),4;case 161:return Oa(b.registerC),4;case 162:return Oa(b.registerD),4;case 163:return Oa(b.registerE),
4;case 164:return Oa(b.registerH),4;case 165:return Oa(b.registerL),4;case 166:return a=I(n(b.registerH,b.registerL)),Oa(a),4;case 167:return Oa(b.registerA),4;case 168:return Pa(b.registerB),4;case 169:return Pa(b.registerC),4;case 170:return Pa(b.registerD),4;case 171:return Pa(b.registerE),4;case 172:return Pa(b.registerH),4;case 173:return Pa(b.registerL),4;case 174:return a=I(n(b.registerH,b.registerL)),Pa(a),4;case 175:return Pa(b.registerA),4}return-1}function Mc(a){switch(a){case 176:return Qa(b.registerB),
4;case 177:return Qa(b.registerC),4;case 178:return Qa(b.registerD),4;case 179:return Qa(b.registerE),4;case 180:return Qa(b.registerH),4;case 181:return Qa(b.registerL),4;case 182:return a=I(n(b.registerH,b.registerL)),Qa(a),4;case 183:return Qa(b.registerA),4;case 184:return Ra(b.registerB),4;case 185:return Ra(b.registerC),4;case 186:return Ra(b.registerD),4;case 187:return Ra(b.registerE),4;case 188:return Ra(b.registerH),4;case 189:return Ra(b.registerL),4;case 190:return a=I(n(b.registerH,b.registerL)),
Ra(a),4;case 191:return Ra(b.registerA),4}return-1}function Nc(a){switch(a){case 192:return 0===Ta()?(a=b.stackPointer,b.programCounter=Ia(a),b.stackPointer=a+2&65535,12):8;case 193:return a=Ia(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,b.registerB=E(a),b.registerC=a&255,4;case 194:if(0===Ta())return b.programCounter=Y(),8;b.programCounter=b.programCounter+2&65535;return 12;case 195:return b.programCounter=Y(),8;case 196:if(0===Ta())return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,
b.programCounter+2&65535),b.programCounter=Y(),8;b.programCounter=b.programCounter+2&65535;return 12;case 197:return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,n(b.registerB,b.registerC)),8;case 198:return Ka(F()),b.programCounter=b.programCounter+1&65535,4;case 199:return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,b.programCounter),b.programCounter=0,8;case 200:return 1===Ta()?(a=b.stackPointer,b.programCounter=Ia(a),b.stackPointer=a+2&65535,12):8;case 201:return a=b.stackPointer,b.programCounter=
Ia(a),b.stackPointer=a+2&65535,8;case 202:if(1===Ta())return b.programCounter=Y(),8;b.programCounter=b.programCounter+2&65535;return 12;case 203:var c=F();a=-1;var d=!1,e=0,f=0,h=c&7;switch(h){case 0:e=b.registerB;break;case 1:e=b.registerC;break;case 2:e=b.registerD;break;case 3:e=b.registerE;break;case 4:e=b.registerH;break;case 5:e=b.registerL;break;case 6:e=I(n(b.registerH,b.registerL));break;case 7:e=b.registerA}var g=(c&240)>>4;switch(g){case 0:7>=c?(c=e,K(128===(c&128)),c=(c<<1|c>>7)&255,t(0===
c),v(0),G(0),f=c,d=!0):15>=c&&(c=e,K(0<(c&1)),c=(c>>1|c<<7)&255,t(0===c),v(0),G(0),f=c,d=!0);break;case 1:23>=c?(c=e,d=128===(c&128),c=(c<<1|U())&255,K(d),t(0===c),v(0),G(0),f=c,d=!0):31>=c&&(c=e,d=1===(c&1),c=(c>>1|U()<<7)&255,K(d),t(0===c),v(0),G(0),f=c,d=!0);break;case 2:39>=c?(c=e,d=128===(c&128),c=c<<1&255,K(d),t(0===c),v(0),G(0),f=c,d=!0):47>=c&&(c=e,d=128===(c&128),e=1===(c&1),c=c>>1&255,d&&(c|=128),t(0===c),v(0),G(0),K(e),f=c,d=!0);break;case 3:55>=c?(c=e,c=((c&15)<<4|(c&240)>>4)&255,t(0===
c),v(0),G(0),K(0),f=c,d=!0):63>=c&&(c=e,d=1===(c&1),c=c>>1&255,t(0===c),v(0),G(0),K(d),f=c,d=!0);break;case 4:71>=c?(f=Va(0,e),d=!0):79>=c&&(f=Va(1,e),d=!0);break;case 5:87>=c?(f=Va(2,e),d=!0):95>=c&&(f=Va(3,e),d=!0);break;case 6:103>=c?(f=Va(4,e),d=!0):111>=c&&(f=Va(5,e),d=!0);break;case 7:119>=c?(f=Va(6,e),d=!0):127>=c&&(f=Va(7,e),d=!0);break;case 8:135>=c?(f=ba(0,0,e),d=!0):143>=c&&(f=ba(1,0,e),d=!0);break;case 9:151>=c?(f=ba(2,0,e),d=!0):159>=c&&(f=ba(3,0,e),d=!0);break;case 10:167>=c?(f=ba(4,
0,e),d=!0):175>=c&&(f=ba(5,0,e),d=!0);break;case 11:183>=c?(f=ba(6,0,e),d=!0):191>=c&&(f=ba(7,0,e),d=!0);break;case 12:199>=c?(f=ba(0,1,e),d=!0):207>=c&&(f=ba(1,1,e),d=!0);break;case 13:215>=c?(f=ba(2,1,e),d=!0):223>=c&&(f=ba(3,1,e),d=!0);break;case 14:231>=c?(f=ba(4,1,e),d=!0):239>=c&&(f=ba(5,1,e),d=!0);break;case 15:247>=c?(f=ba(6,1,e),d=!0):255>=c&&(f=ba(7,1,e),d=!0)}switch(h){case 0:b.registerB=f;break;case 1:b.registerC=f;break;case 2:b.registerD=f;break;case 3:b.registerE=f;break;case 4:b.registerH=
f;break;case 5:b.registerL=f;break;case 6:(4>g||7<g)&&T(n(b.registerH,b.registerL),f);break;case 7:b.registerA=f}d&&(a=4);b.programCounter=b.programCounter+1&65535;return a;case 204:if(1===Ta())return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,b.programCounter+2),b.programCounter=Y(),8;b.programCounter=b.programCounter+2&65535;return 12;case 205:return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,b.programCounter+2&65535),b.programCounter=Y(),8;case 206:return La(F()),b.programCounter=b.programCounter+
1&65535,4;case 207:return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,b.programCounter),b.programCounter=8}return-1}function Oc(a){switch(a){case 208:return 0===U()?(a=b.stackPointer,b.programCounter=Ia(a),b.stackPointer=a+2&65535,12):8;case 209:a=b.stackPointer;var c=Ia(a);b.stackPointer=a+2&65535;b.registerD=E(c);b.registerE=c&255;return 4;case 210:if(0===U())return b.programCounter=Y(),8;b.programCounter=b.programCounter+2&65535;return 12;case 212:if(0===U())return a=b.stackPointer-2&65535,b.stackPointer=
a,V(a,b.programCounter+2),b.programCounter=Y(),8;b.programCounter=b.programCounter+2&65535;return 12;case 213:return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,n(b.registerD,b.registerE)),8;case 214:return Ma(F()),b.programCounter=b.programCounter+1&65535,4;case 215:return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,b.programCounter),b.programCounter=16,8;case 216:return 1===U()?(a=b.stackPointer,b.programCounter=Ia(a),b.stackPointer=a+2&65535,12):8;case 217:return a=b.stackPointer,b.programCounter=
Ia(a),vb(!0),b.stackPointer=a+2&65535,8;case 218:if(1===U())return b.programCounter=Y(),8;b.programCounter=b.programCounter+2&65535;return 12;case 220:if(1===U())return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,b.programCounter+2&65535),b.programCounter=Y(),8;b.programCounter=b.programCounter+2&65535;return 12;case 222:return Na(F()),b.programCounter=b.programCounter+1&65535,4;case 223:return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,b.programCounter),b.programCounter=24,8}return-1}function Pc(a){switch(a){case 224:return a=
F(),T(65280+a,b.registerA),b.programCounter=b.programCounter+1&65535,4;case 225:a=b.stackPointer;var c=Ia(a);b.stackPointer=a+2&65535;b.registerH=E(c);b.registerL=c&255;return 4;case 226:return T(65280+b.registerC,b.registerA),4;case 229:return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,n(b.registerH,b.registerL)),8;case 230:return Oa(F()),b.programCounter=b.programCounter+1&65535,4;case 231:return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,b.programCounter),b.programCounter=32,8;case 232:return a=
F()<<24>>24,Wa(b.stackPointer,a,!0),b.stackPointer=b.stackPointer+a&65535,t(0),v(0),b.programCounter=b.programCounter+1&65535,12;case 233:return b.programCounter=n(b.registerH,b.registerL),4;case 234:return T(Y(),b.registerA),b.programCounter=b.programCounter+2&65535,4;case 238:return Pa(F()),b.programCounter=b.programCounter+1&65535,4;case 239:return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,b.programCounter),b.programCounter=40,8}return-1}function Qc(a){switch(a){case 240:return a=F(),b.registerA=
I(65280+a)&255,b.programCounter=b.programCounter+1&65535,4;case 241:a=b.stackPointer;var c=Ia(a);b.stackPointer=a+2&65535;b.registerA=E(c);b.registerF=c&255;return 4;case 242:return b.registerA=I(65280+b.registerC)&255,4;case 243:return vb(!1),4;case 245:return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,n(b.registerA,b.registerF)),8;case 246:return Qa(F()),b.programCounter=b.programCounter+1&65535,4;case 247:return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,b.programCounter),b.programCounter=
48,8;case 248:return c=F()<<24>>24,a=b.stackPointer,t(0),v(0),Wa(a,c,!0),a=a+c&65535,b.registerH=E(a),b.registerL=a&255,b.programCounter=b.programCounter+1&65535,8;case 249:return b.stackPointer=n(b.registerH,b.registerL),8;case 250:return b.registerA=I(Y()),b.programCounter=b.programCounter+2&65535,4;case 251:return vb(!0),4;case 254:return Ra(F()),b.programCounter=b.programCounter+1&65535,4;case 255:return a=b.stackPointer-2&65535,b.stackPointer=a,V(a,b.programCounter),b.programCounter=56,8}return-1}
function Sa(a){0<g.DMACycles&&(a+=g.DMACycles,g.DMACycles=0);b.currentCycles+=a;if(!b.isStopped){if(S.graphicsBatchProcessing){r.currentCycles+=a;for(var c=r.batchProcessCycles();r.currentCycles>=c;)mc(c),r.currentCycles-=c}else mc(a);S.audioBatchProcessing?k.currentCycles+=a:cc(a);c=a;if(Z.transferStartFlag)for(var d=0;d<c;){var e=Z.currentCycles,f=e;d+=4;f+=4;65535<f&&(f-=65536);Z.currentCycles=f;var l=Z.isClockSpeedFast?2:7;p(l,e)&&!p(l,f)&&(e=Z.memoryLocationSerialTransferData,f=w(e),f=(f<<1)+
1,f&=255,h(e,f),e=Z.numberOfBitsTransferred,8===++e?(Z.numberOfBitsTransferred=0,m.isSerialInterruptRequested=!0,bb(m.bitPositionSerialInterrupt),e=Z.memoryLocationSerialTransferControl,f=w(e),h(e,H(7,f)),Z.transferStartFlag=!1):Z.numberOfBitsTransferred=e)}}S.timersBatchProcessing?(u.currentCycles+=a,Hb(u.currentCycles),u.currentCycles=0):Hb(a);c=da.cycles;c+=a;c>=da.cyclesPerCycleSet&&(da.cycleSets+=1,c-=da.cyclesPerCycleSet);da.cycles=c}function oc(){return Qb(!0,-1)}function Qb(a,c){void 0===
c&&(c=-1);a=1024;0<c?a=c:0>c&&(a=-1);for(var d=!1,e=!1,f=!1;!(d||e||f||aa.reachedBreakpoint);)c=pc(),0>c?d=!0:b.currentCycles>=b.MAX_CYCLES_PER_FRAME()?e=!0:-1<a&&dc()>=a&&(f=!0);if(e)return b.currentCycles-=b.MAX_CYCLES_PER_FRAME(),W.RESPONSE_CONDITION_FRAME;if(f)return W.RESPONSE_CONDITION_AUDIO;if(aa.reachedBreakpoint)return aa.reachedBreakpoint=!1,W.RESPONSE_CONDITION_BREAKPOINT;b.programCounter=b.programCounter-1&65535;return-1}function pc(){jb=!0;if(b.isHaltBug){var a=w(b.programCounter);a=
nc(a);Sa(a);b.exitHaltAndStop()}m.masterInterruptSwitchDelay&&(m.masterInterruptSwitch=!0,m.masterInterruptSwitchDelay=!1);if(0<(m.interruptsEnabledValue&m.interruptsRequestedValue&31)){a=!1;m.masterInterruptSwitch&&!b.isHaltNoJump&&(m.isVBlankInterruptEnabled&&m.isVBlankInterruptRequested?(hb(m.bitPositionVBlankInterrupt),a=!0):m.isLcdInterruptEnabled&&m.isLcdInterruptRequested?(hb(m.bitPositionLcdInterrupt),a=!0):m.isTimerInterruptEnabled&&m.isTimerInterruptRequested?(hb(m.bitPositionTimerInterrupt),
a=!0):m.isSerialInterruptEnabled&&m.isSerialInterruptRequested?(hb(m.bitPositionSerialInterrupt),a=!0):m.isJoypadInterruptEnabled&&m.isJoypadInterruptRequested&&(hb(m.bitPositionJoypadInterrupt),a=!0));var c=0;a&&(c=20,b.isHalted()&&(b.exitHaltAndStop(),c+=4));b.isHalted()&&b.exitHaltAndStop();a=c}else a=0;0<a&&Sa(a);a=4;b.isHalted()||b.isStopped||(a=w(b.programCounter),a=nc(a));b.registerF&=240;if(0>=a)return a;Sa(a);c=W.steps;c+=1;c>=W.stepsPerStepSet&&(W.stepSets+=1,c-=W.stepsPerStepSet);W.steps=
c;b.programCounter===aa.programCounter&&(aa.reachedBreakpoint=!0);return a}function Rc(a){const c="undefined"!==typeof window?performance.now():Date.now();for(;a.fpsTimeStamps[0]<c-1E3;)a.fpsTimeStamps.shift();a.fpsTimeStamps.push(c);a.timeStampsUntilReady--;0>a.timeStampsUntilReady&&(a.timeStampsUntilReady=0);return c}function Rb(a){a.timeStampsUntilReady=90>=a.options.gameboyFrameRate?1.25*Math.floor(a.options.gameboyFrameRate):120}function qc(a){const c=a.wasmByteMemory.slice(a.WASMBOY_CURRENT_FRAME_OUTPUT_LOCATION,
a.WASMBOY_CURRENT_FRAME_OUTPUT_LOCATION+a.WASMBOY_CURRENT_FRAME_SIZE).buffer;a.graphicsWorkerPort.postMessage(M({type:x.UPDATED,graphicsFrameBuffer:c}),[c])}function rc(a){var c=("undefined"!==typeof window?performance.now():Date.now())-a.fpsTimeStamps[a.fpsTimeStamps.length-1];c=sc-c;0>c&&(c=0);a.speed&&0<a.speed&&(c/=a.speed);a.updateId=setTimeout(()=>{tc(a)},Math.floor(c))}function tc(a,c){if(a.paused)return!0;void 0!==c&&(sc=c);kb=a.getFPS();xb=a.options.gameboyFrameRate+1;a.speed&&0<a.speed&&
(xb*=a.speed);if(kb>xb)return a.fpsTimeStamps.shift(),rc(a),!0;Rc(a);const b=!a.options.headless&&!a.pauseFpsThrottle&&a.options.isAudioEnabled;(new Promise((c)=>{let d;b?Sb(a,c):(d=a.wasmInstance.exports.executeFrame(),c(d))})).then((c)=>{if(0<=c){ea(M({type:x.UPDATED,fps:kb}));let b=!1;a.options.frameSkip&&0<a.options.frameSkip&&(a.frameSkipCounter++,a.frameSkipCounter<=a.options.frameSkip?b=!0:a.frameSkipCounter=0);b||qc(a);const d={type:x.UPDATED};d[D.CARTRIDGE_RAM]=Wb(a).buffer;d[D.GAMEBOY_MEMORY]=
a.wasmByteMemory.slice(a.WASMBOY_INTERNAL_MEMORY_LOCATION,a.WASMBOY_INTERNAL_MEMORY_LOCATION+a.WASMBOY_INTERNAL_MEMORY_SIZE).buffer;d[D.PALETTE_MEMORY]=a.wasmByteMemory.slice(a.WASMBOY_PALETTE_MEMORY_LOCATION,a.WASMBOY_PALETTE_MEMORY_LOCATION+a.WASMBOY_PALETTE_MEMORY_SIZE).buffer;d[D.INTERNAL_STATE]=Xb(a).buffer;Object.keys(d).forEach((a)=>{void 0===d[a]&&(d[a]=(new Uint8Array).buffer)});a.memoryWorkerPort.postMessage(M(d),[d[D.CARTRIDGE_RAM],d[D.GAMEBOY_MEMORY],d[D.PALETTE_MEMORY],d[D.INTERNAL_STATE]]);
2===c?ea(M({type:x.BREAKPOINT})):rc(a)}else ea(M({type:x.CRASHED})),a.paused=!0})}function Sb(a,c){var b=-1;b=a.wasmInstance.exports.executeFrameAndCheckAudio(1024);1!==b&&c(b);if(1===b){b=a.wasmInstance.exports.getNumberOfSamplesInAudioBuffer();const d=kb>=xb;.25<a.currentAudioLatencyInSeconds&&d?(uc(a,b),setTimeout(()=>{Rb(a);Sb(a,c)},Math.floor(Math.floor(1E3*(a.currentAudioLatencyInSeconds-.25))/10))):(uc(a,b),Sb(a,c))}}function uc(a,c){var b=a.wasmByteMemory.slice(a.WASMBOY_SOUND_OUTPUT_LOCATION,
a.WASMBOY_SOUND_OUTPUT_LOCATION+2*c).buffer;const d={type:x.UPDATED,audioBuffer:b,numberOfSamples:c,fps:kb,allowFastSpeedStretching:60<a.options.gameboyFrameRate};b=[b];if(a.options&&a.options.enableAudioDebugging){var e=a.wasmByteMemory.slice(a.WASMBOY_CHANNEL_1_OUTPUT_LOCATION,a.WASMBOY_CHANNEL_1_OUTPUT_LOCATION+2*c).buffer;d.channel1Buffer=e;b.push(e);e=a.wasmByteMemory.slice(a.WASMBOY_CHANNEL_2_OUTPUT_LOCATION,a.WASMBOY_CHANNEL_2_OUTPUT_LOCATION+2*c).buffer;d.channel2Buffer=e;b.push(e);e=a.wasmByteMemory.slice(a.WASMBOY_CHANNEL_3_OUTPUT_LOCATION,
a.WASMBOY_CHANNEL_3_OUTPUT_LOCATION+2*c).buffer;d.channel3Buffer=e;b.push(e);c=a.wasmByteMemory.slice(a.WASMBOY_CHANNEL_4_OUTPUT_LOCATION,a.WASMBOY_CHANNEL_4_OUTPUT_LOCATION+2*c).buffer;d.channel4Buffer=c;b.push(c)}a.audioWorkerPort.postMessage(M(d),b);a.wasmInstance.exports.clearAudioBuffer()}const mb="undefined"!==typeof self;let Ab;mb||(Ab=require("worker_threads").parentPort);const x={CONNECT:"CONNECT",INSTANTIATE_WASM:"INSTANTIATE_WASM",CLEAR_MEMORY:"CLEAR_MEMORY",CLEAR_MEMORY_DONE:"CLEAR_MEMORY_DONE",
GET_MEMORY:"GET_MEMORY",SET_MEMORY:"SET_MEMORY",SET_MEMORY_DONE:"SET_MEMORY_DONE",GET_CONSTANTS:"GET_CONSTANTS",GET_CONSTANTS_DONE:"GET_CONSTANTS_DONE",CONFIG:"CONFIG",RESET_AUDIO_QUEUE:"RESET_AUDIO_QUEUE",PLAY:"PLAY",BREAKPOINT:"BREAKPOINT",PAUSE:"PAUSE",UPDATED:"UPDATED",CRASHED:"CRASHED",SET_JOYPAD_STATE:"SET_JOYPAD_STATE",AUDIO_LATENCY:"AUDIO_LATENCY",RUN_WASM_EXPORT:"RUN_WASM_EXPORT",GET_WASM_MEMORY_SECTION:"GET_WASM_MEMORY_SECTION",GET_WASM_CONSTANT:"GET_WASM_CONSTANT",FORCE_OUTPUT_FRAME:"FORCE_OUTPUT_FRAME",
SET_SPEED:"SET_SPEED",IS_GBC:"IS_GBC"},D={CARTRIDGE_RAM:"CARTRIDGE_RAM",CARTRIDGE_ROM:"CARTRIDGE_ROM",CARTRIDGE_HEADER:"CARTRIDGE_HEADER",GAMEBOY_MEMORY:"GAMEBOY_MEMORY",PALETTE_MEMORY:"PALETTE_MEMORY",INTERNAL_STATE:"INTERNAL_STATE"};let nb=0;const e=new Uint8ClampedArray(9109504),lb={size:()=>9109504,grow:()=>{},wasmByteMemory:e};var Sc=65536,Ya=67584,Za=Ya+128,cb=Za+23552,yb=cb+93184,Tb=yb+196608,zb=Tb+147456,Tc=Ya,Uc=zb-Ya+15360,Db=zb+15360,Eb=Db+131072,Fb=Eb+131072,Gb=Fb+131072,ub=Gb+131072,
Nb=ub+131072,wb=Nb+131072,Ub=wb+8258560,vc=Ub+65535+1,Vb=Math.ceil(vc/1024/64)+1,S=function(){function a(){}a.enableBootRom=!1;a.useGbcWhenAvailable=!0;a.audioBatchProcessing=!1;a.graphicsBatchProcessing=!1;a.timersBatchProcessing=!1;a.graphicsDisableScanlineRendering=!1;a.audioAccumulateSamples=!1;a.tileRendering=!1;a.tileCaching=!1;a.enableAudioDebugging=!1;return a}(),L=function(){function a(){}a.bgWhite=15921906;a.bgLightGrey=10526880;a.bgDarkGrey=5789784;a.bgBlack=526344;a.obj0White=15921906;
a.obj0LightGrey=10526880;a.obj0DarkGrey=5789784;a.obj0Black=526344;a.obj1White=15921906;a.obj1LightGrey=10526880;a.obj1DarkGrey=5789784;a.obj1Black=526344;return a}(),ma=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=5439232;a.bgDarkGrey=16728576;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=5439232;a.obj0DarkGrey=16728576;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=5439232;a.obj1DarkGrey=16728576;a.obj1Black=0;return a}(),qa=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=
16776960;a.bgDarkGrey=16711680;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=16776960;a.obj0DarkGrey=16711680;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=16776960;a.obj1DarkGrey=16711680;a.obj1Black=0;return a}(),ja=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=16756067;a.bgDarkGrey=8663296;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=16756067;a.obj0DarkGrey=8663296;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=16756067;a.obj1DarkGrey=8663296;a.obj1Black=0;return a}(),
oa=function(){function a(){}a.bgWhite=0;a.bgLightGrey=33924;a.bgDarkGrey=16768512;a.bgBlack=16777215;a.obj0White=0;a.obj0LightGrey=33924;a.obj0DarkGrey=16768512;a.obj0Black=16777215;a.obj1White=0;a.obj1LightGrey=33924;a.obj1DarkGrey=16768512;a.obj1Black=16777215;return a}(),ua=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=10855845;a.bgDarkGrey=5395026;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=10855845;a.obj0DarkGrey=5395026;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=10855845;
a.obj1DarkGrey=5395026;a.obj1Black=0;return a}(),pa=function(){function a(){}a.bgWhite=16777125;a.bgLightGrey=16749716;a.bgDarkGrey=9737471;a.bgBlack=0;a.obj0White=16777125;a.obj0LightGrey=16749716;a.obj0DarkGrey=9737471;a.obj0Black=0;a.obj1White=16777125;a.obj1LightGrey=16749716;a.obj1DarkGrey=9737471;a.obj1Black=0;return a}(),la=function(){function a(){}a.bgWhite=16770757;a.bgLightGrey=13540484;a.bgDarkGrey=8678185;a.bgBlack=5910792;a.obj0White=16777215;a.obj0LightGrey=16756067;a.obj0DarkGrey=8663296;
a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=16756067;a.obj1DarkGrey=8663296;a.obj1Black=0;return a}(),na=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=8126257;a.bgDarkGrey=25541;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=16745604;a.obj0DarkGrey=9714234;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=16745604;a.obj1DarkGrey=9714234;a.obj1Black=0;return a}(),ta=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=9211102;a.bgDarkGrey=5395084;a.bgBlack=0;a.obj0White=
16777215;a.obj0LightGrey=16745604;a.obj0DarkGrey=9714234;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=16756067;a.obj1DarkGrey=8663296;a.obj1Black=0;return a}(),ka=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=16745604;a.bgDarkGrey=9714234;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=8126257;a.obj0DarkGrey=33792;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=6530559;a.obj1DarkGrey=255;a.obj1Black=0;return a}(),sa=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=6530559;
a.bgDarkGrey=255;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=16745604;a.obj0DarkGrey=9714234;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=8126257;a.obj1DarkGrey=33792;a.obj1Black=0;return a}(),ra=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=16776960;a.bgDarkGrey=8079872;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=6530559;a.obj0DarkGrey=255;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=8126257;a.obj1DarkGrey=33792;a.obj1Black=0;return a}(),wa=function(){function a(){}
a.bgWhite=10853631;a.bgLightGrey=16776960;a.bgDarkGrey=25344;a.bgBlack=0;a.obj0White=10853631;a.obj0LightGrey=16776960;a.obj0DarkGrey=25344;a.obj0Black=0;a.obj1White=10853631;a.obj1LightGrey=16776960;a.obj1DarkGrey=25344;a.obj1Black=0;return a}(),xa=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=6530559;a.bgDarkGrey=255;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=16745604;a.obj0DarkGrey=9714234;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=6530559;a.obj1DarkGrey=255;a.obj1Black=
0;return a}(),ya=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=16745604;a.bgDarkGrey=9714234;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=8126257;a.obj0DarkGrey=33792;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=16745604;a.obj1DarkGrey=9714234;a.obj1Black=0;return a}(),za=function(){function a(){}a.bgWhite=11908607;a.bgLightGrey=16777108;a.bgDarkGrey=11360834;a.bgBlack=0;a.obj0White=0;a.obj0LightGrey=16777215;a.obj0DarkGrey=16745604;a.obj0Black=9714234;a.obj1White=0;a.obj1LightGrey=
16777215;a.obj1DarkGrey=16745604;a.obj1Black=9714234;return a}(),Aa=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=11382148;a.bgDarkGrey=4354939;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=16741120;a.obj0DarkGrey=9716224;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=5946879;a.obj1DarkGrey=16711680;a.obj1Black=255;return a}(),Ba=function(){function a(){}a.bgWhite=16777116;a.bgLightGrey=9745919;a.bgDarkGrey=6526067;a.bgBlack=14906;a.obj0White=16762178;a.obj0LightGrey=16766464;a.obj0DarkGrey=
9714176;a.obj0Black=4849664;a.obj1White=16777215;a.obj1LightGrey=16745604;a.obj1DarkGrey=9714234;a.obj1Black=0;return a}(),Ca=function(){function a(){}a.bgWhite=7077632;a.bgLightGrey=16777215;a.bgDarkGrey=16732746;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=16777215;a.obj0DarkGrey=6530559;a.obj0Black=255;a.obj1White=16777215;a.obj1LightGrey=16756067;a.obj1DarkGrey=8663296;a.obj1Black=0;return a}(),Da=function(){function a(){}a.bgWhite=10853631;a.bgLightGrey=16776960;a.bgDarkGrey=25344;a.bgBlack=
0;a.obj0White=16737106;a.obj0LightGrey=14024704;a.obj0DarkGrey=6488064;a.obj0Black=0;a.obj1White=255;a.obj1LightGrey=16777215;a.obj1DarkGrey=16777083;a.obj1Black=34047;return a}(),Ea=function(){function a(){}a.bgWhite=16777166;a.bgLightGrey=6549487;a.bgDarkGrey=10257457;a.bgBlack=5921370;a.obj0White=16777215;a.obj0LightGrey=16741120;a.obj0DarkGrey=9716224;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=6530559;a.obj1DarkGrey=255;a.obj1Black=0;return a}(),Fa=function(){function a(){}a.bgWhite=16777215;
a.bgLightGrey=16745604;a.bgDarkGrey=9714234;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=65280;a.obj0DarkGrey=3245056;a.obj0Black=18944;a.obj1White=16777215;a.obj1LightGrey=6530559;a.obj1DarkGrey=255;a.obj1Black=0;return a}(),Ga=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=6530559;a.bgDarkGrey=255;a.bgBlack=0;a.obj0White=16776960;a.obj0LightGrey=16711680;a.obj0DarkGrey=6488064;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=8126257;a.obj1DarkGrey=33792;a.obj1Black=0;return a}(),
Ha=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=11382148;a.bgDarkGrey=4354939;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=16756067;a.obj0DarkGrey=16756067;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=6530559;a.obj1DarkGrey=255;a.obj1Black=0;return a}(),d=function(){function a(){}a.bgWhite=L.bgWhite;a.bgLightGrey=L.bgLightGrey;a.bgDarkGrey=L.bgDarkGrey;a.bgBlack=L.bgBlack;a.obj0White=L.obj0White;a.obj0LightGrey=L.obj0LightGrey;a.obj0DarkGrey=L.obj0DarkGrey;a.obj0Black=L.obj0Black;
a.obj1White=L.obj1White;a.obj1LightGrey=L.obj1LightGrey;a.obj1DarkGrey=L.obj1DarkGrey;a.obj1Black=L.obj1Black;return a}(),Xa=function(){function a(){}a.memoryLocationBackgroundPaletteIndex=65384;a.memoryLocationBackgroundPaletteData=65385;a.memoryLocationSpritePaletteIndex=65386;a.memoryLocationSpritePaletteData=65387;a.memoryLocationBackgroundPalette=65351;a.memoryLocationSpritePaletteOne=65352;a.memoryLocationSpritePaletteTwo=65353;return a}(),db=function(){function a(){}a.tileId=-1;a.horizontalFlip=
!1;a.nextXIndexToPerformCacheCheck=-1;return a}(),z=function(){function a(){}a.updateNRx0=function(c){a.NRx0SweepPeriod=(c&112)>>4;a.NRx0Negate=p(3,c);a.NRx0SweepShift=c&7};a.updateNRx1=function(c){a.NRx1Duty=c>>6&3;a.NRx1LengthLoad=c&63;a.lengthCounter=64-a.NRx1LengthLoad};a.updateNRx2=function(c){a.NRx2StartingVolume=c>>4&15;a.NRx2EnvelopeAddMode=p(3,c);a.NRx2EnvelopePeriod=c&7;a.isDacEnabled=0<(c&248)};a.updateNRx3=function(c){a.NRx3FrequencyLSB=c;a.frequency=a.NRx4FrequencyMSB<<8|c};a.updateNRx4=
function(c){a.NRx4LengthEnabled=p(6,c);c&=7;a.NRx4FrequencyMSB=c;a.frequency=c<<8|a.NRx3FrequencyLSB};a.saveState=function(){e[1024+50*a.saveStateSlot]=a.isEnabled;e[1025+50*a.saveStateSlot]=a.frequencyTimer;e[1029+50*a.saveStateSlot]=a.envelopeCounter;e[1033+50*a.saveStateSlot]=a.lengthCounter;e[1038+50*a.saveStateSlot]=a.volume;e[1043+50*a.saveStateSlot]=a.dutyCycle;e[1044+50*a.saveStateSlot]=a.waveFormPositionOnDuty;e[1049+50*a.saveStateSlot]=a.isSweepEnabled;e[1050+50*a.saveStateSlot]=a.sweepCounter;
e[1055+50*a.saveStateSlot]=a.sweepShadowFrequency};a.loadState=function(){a.isEnabled=Q(1024+50*a.saveStateSlot);a.frequencyTimer=e[1025+50*a.saveStateSlot];a.envelopeCounter=e[1029+50*a.saveStateSlot];a.lengthCounter=e[1033+50*a.saveStateSlot];a.volume=e[1038+50*a.saveStateSlot];a.dutyCycle=e[1043+50*a.saveStateSlot];a.waveFormPositionOnDuty=e[1044+50*a.saveStateSlot];a.isSweepEnabled=Q(1049+50*a.saveStateSlot);a.sweepCounter=e[1050+50*a.saveStateSlot];a.sweepShadowFrequency=e[1055+50*a.saveStateSlot]};
a.initialize=function(){h(a.memoryLocationNRx0,128);h(a.memoryLocationNRx1,191);h(a.memoryLocationNRx2,243);h(a.memoryLocationNRx3,193);h(a.memoryLocationNRx4,191)};a.getSampleFromCycleCounter=function(){var c=a.cycleCounter;a.cycleCounter=0;return a.getSample(c)};a.resetTimer=function(){var c=2048-a.frequency<<2;b.GBCDoubleSpeed&&(c<<=2);a.frequencyTimer=c};a.getSample=function(c){c=a.frequencyTimer-c;if(0>=c){var b=Math.abs(c);a.frequencyTimer=c;a.resetTimer();a.frequencyTimer-=b;a.waveFormPositionOnDuty=
a.waveFormPositionOnDuty+1&7}else a.frequencyTimer=c;if(a.isEnabled&&a.isDacEnabled)c=a.volume;else return 15;b=1;$b(a.NRx1Duty,a.waveFormPositionOnDuty)||(b=-b);return b*c+15};a.trigger=function(){a.isEnabled=!0;0===a.lengthCounter&&(a.lengthCounter=64);a.resetTimer();a.envelopeCounter=a.NRx2EnvelopePeriod;a.volume=a.NRx2StartingVolume;a.sweepShadowFrequency=a.frequency;a.sweepCounter=a.NRx0SweepPeriod;a.isSweepEnabled=0<a.NRx0SweepPeriod&&0<a.NRx0SweepShift;0<a.NRx0SweepShift&&ac();a.isDacEnabled||
(a.isEnabled=!1)};a.willChannelUpdate=function(c){c=a.cycleCounter+c;a.cycleCounter=c;return!(0<a.frequencyTimer-c)};a.updateSweep=function(){var c=a.sweepCounter-1;0>=c?(a.sweepCounter=a.NRx0SweepPeriod,a.isSweepEnabled&&0<a.NRx0SweepPeriod&&ac()):a.sweepCounter=c};a.updateLength=function(){var c=a.lengthCounter;0<c&&a.NRx4LengthEnabled&&--c;0===c&&(a.isEnabled=!1);a.lengthCounter=c};a.updateEnvelope=function(){var c=a.envelopeCounter-1;0>=c?(a.envelopeCounter=a.NRx2EnvelopePeriod,0!==c&&(c=a.volume,
a.NRx2EnvelopeAddMode&&15>c?c+=1:!a.NRx2EnvelopeAddMode&&0<c&&--c,a.volume=c)):a.envelopeCounter=c};a.setFrequency=function(c){var b=c>>8;c&=255;var d=w(a.memoryLocationNRx4)&248|b;h(a.memoryLocationNRx3,c);h(a.memoryLocationNRx4,d);a.NRx3FrequencyLSB=c;a.NRx4FrequencyMSB=b;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.cycleCounter=0;a.memoryLocationNRx0=65296;a.NRx0SweepPeriod=0;a.NRx0Negate=!1;a.NRx0SweepShift=0;a.memoryLocationNRx1=65297;a.NRx1Duty=0;a.NRx1LengthLoad=0;a.memoryLocationNRx2=
65298;a.NRx2StartingVolume=0;a.NRx2EnvelopeAddMode=!1;a.NRx2EnvelopePeriod=0;a.memoryLocationNRx3=65299;a.NRx3FrequencyLSB=0;a.memoryLocationNRx4=65300;a.NRx4LengthEnabled=!1;a.NRx4FrequencyMSB=0;a.channelNumber=1;a.isEnabled=!1;a.isDacEnabled=!1;a.frequency=0;a.frequencyTimer=0;a.envelopeCounter=0;a.lengthCounter=0;a.volume=0;a.dutyCycle=0;a.waveFormPositionOnDuty=0;a.isSweepEnabled=!1;a.sweepCounter=0;a.sweepShadowFrequency=0;a.saveStateSlot=7;return a}(),N=function(){function a(){}a.updateNRx1=
function(c){a.NRx1Duty=c>>6&3;a.NRx1LengthLoad=c&63;a.lengthCounter=64-a.NRx1LengthLoad};a.updateNRx2=function(c){a.NRx2StartingVolume=c>>4&15;a.NRx2EnvelopeAddMode=p(3,c);a.NRx2EnvelopePeriod=c&7;a.isDacEnabled=0<(c&248)};a.updateNRx3=function(c){a.NRx3FrequencyLSB=c;a.frequency=a.NRx4FrequencyMSB<<8|c};a.updateNRx4=function(c){a.NRx4LengthEnabled=p(6,c);c&=7;a.NRx4FrequencyMSB=c;a.frequency=c<<8|a.NRx3FrequencyLSB};a.saveState=function(){e[1024+50*a.saveStateSlot]=a.isEnabled;e[1025+50*a.saveStateSlot]=
a.frequencyTimer;e[1029+50*a.saveStateSlot]=a.envelopeCounter;e[1033+50*a.saveStateSlot]=a.lengthCounter;e[1038+50*a.saveStateSlot]=a.volume;e[1043+50*a.saveStateSlot]=a.dutyCycle;e[1044+50*a.saveStateSlot]=a.waveFormPositionOnDuty};a.loadState=function(){a.isEnabled=Q(1024+50*a.saveStateSlot);a.frequencyTimer=e[1025+50*a.saveStateSlot];a.envelopeCounter=e[1029+50*a.saveStateSlot];a.lengthCounter=e[1033+50*a.saveStateSlot];a.volume=e[1038+50*a.saveStateSlot];a.dutyCycle=e[1043+50*a.saveStateSlot];
a.waveFormPositionOnDuty=e[1044+50*a.saveStateSlot]};a.initialize=function(){h(a.memoryLocationNRx1-1,255);h(a.memoryLocationNRx1,63);h(a.memoryLocationNRx2,0);h(a.memoryLocationNRx3,0);h(a.memoryLocationNRx4,184)};a.getSampleFromCycleCounter=function(){var c=a.cycleCounter;a.cycleCounter=0;return a.getSample(c)};a.resetTimer=function(){a.frequencyTimer=2048-a.frequency<<2<<b.GBCDoubleSpeed};a.getSample=function(c){c=a.frequencyTimer-c;a.frequencyTimer=c;0>=c&&(c=Math.abs(c),a.resetTimer(),a.frequencyTimer-=
c,a.waveFormPositionOnDuty=a.waveFormPositionOnDuty+1&7);if(a.isEnabled&&a.isDacEnabled)c=a.volume;else return 15;var b=1;$b(a.NRx1Duty,a.waveFormPositionOnDuty)||(b=-b);return b*c+15};a.trigger=function(){a.isEnabled=!0;0===a.lengthCounter&&(a.lengthCounter=64);a.resetTimer();a.envelopeCounter=a.NRx2EnvelopePeriod;a.volume=a.NRx2StartingVolume;a.isDacEnabled||(a.isEnabled=!1)};a.willChannelUpdate=function(c){c=a.cycleCounter+c;a.cycleCounter=c;return!(0<a.frequencyTimer-c)};a.updateLength=function(){var c=
a.lengthCounter;0<c&&a.NRx4LengthEnabled&&--c;0===c&&(a.isEnabled=!1);a.lengthCounter=c};a.updateEnvelope=function(){var c=a.envelopeCounter-1;if(0>=c&&(c=a.NRx2EnvelopePeriod,0!==c)){var b=a.volume;a.NRx2EnvelopeAddMode&&15>b?b+=1:!a.NRx2EnvelopeAddMode&&0<b&&--b;a.volume=b}a.envelopeCounter=c};a.setFrequency=function(c){var b=c>>8;c&=255;var d=w(a.memoryLocationNRx4)&248|b;h(a.memoryLocationNRx3,c);h(a.memoryLocationNRx4,d);a.NRx3FrequencyLSB=c;a.NRx4FrequencyMSB=b;a.frequency=b<<8|c};a.cycleCounter=
0;a.memoryLocationNRx1=65302;a.NRx1Duty=0;a.NRx1LengthLoad=0;a.memoryLocationNRx2=65303;a.NRx2StartingVolume=0;a.NRx2EnvelopeAddMode=!1;a.NRx2EnvelopePeriod=0;a.memoryLocationNRx3=65304;a.NRx3FrequencyLSB=0;a.memoryLocationNRx4=65305;a.NRx4LengthEnabled=!1;a.NRx4FrequencyMSB=0;a.channelNumber=2;a.isEnabled=!1;a.isDacEnabled=!1;a.frequency=0;a.frequencyTimer=0;a.envelopeCounter=0;a.lengthCounter=0;a.volume=0;a.dutyCycle=0;a.waveFormPositionOnDuty=0;a.saveStateSlot=8;return a}(),J=function(){function a(){}
a.updateNRx0=function(c){a.isDacEnabled=p(7,c)};a.updateNRx1=function(c){a.NRx1LengthLoad=c;a.lengthCounter=256-a.NRx1LengthLoad};a.updateNRx2=function(c){a.NRx2VolumeCode=c>>5&15};a.updateNRx3=function(c){a.NRx3FrequencyLSB=c;a.frequency=a.NRx4FrequencyMSB<<8|c};a.updateNRx4=function(c){a.NRx4LengthEnabled=p(6,c);c&=7;a.NRx4FrequencyMSB=c;a.frequency=c<<8|a.NRx3FrequencyLSB};a.saveState=function(){e[1024+50*a.saveStateSlot]=a.isEnabled;e[1025+50*a.saveStateSlot]=a.frequencyTimer;e[1029+50*a.saveStateSlot]=
a.lengthCounter;e[1033+50*a.saveStateSlot]=a.waveTablePosition};a.loadState=function(){a.isEnabled=Q(1024+50*a.saveStateSlot);a.frequencyTimer=e[1025+50*a.saveStateSlot];a.lengthCounter=e[1029+50*a.saveStateSlot];a.waveTablePosition=e[1033+50*a.saveStateSlot]};a.initialize=function(){h(a.memoryLocationNRx0,127);h(a.memoryLocationNRx1,255);h(a.memoryLocationNRx2,159);h(a.memoryLocationNRx3,0);h(a.memoryLocationNRx4,184);a.volumeCodeChanged=!0};a.getSampleFromCycleCounter=function(){var c=a.cycleCounter;
a.cycleCounter=0;return a.getSample(c)};a.resetTimer=function(){a.frequencyTimer=2048-a.frequency<<1<<b.GBCDoubleSpeed};a.getSample=function(c){var b=a.frequencyTimer;b-=c;0>=b?(c=Math.abs(b),a.frequencyTimer=b,a.resetTimer(),a.frequencyTimer-=c,a.waveTablePosition=a.waveTablePosition+1&31):a.frequencyTimer=b;b=a.volumeCode;if(a.isEnabled&&a.isDacEnabled)a.volumeCodeChanged&&(b=w(a.memoryLocationNRx2),b=b>>5&15,a.volumeCode=b,a.volumeCodeChanged=!1);else return 15;var d=a.waveTablePosition;c=w(a.memoryLocationWaveTable+
(d>>1|0));c=c>>((0===(d&1))<<2)&15;d=0;switch(b){case 0:c>>=4;break;case 1:d=1;break;case 2:c>>=1;d=2;break;default:c>>=2,d=4}return c=(0<d?c/d:0)+15};a.trigger=function(){a.isEnabled=!0;0===a.lengthCounter&&(a.lengthCounter=256);a.resetTimer();a.waveTablePosition=0;a.isDacEnabled||(a.isEnabled=!1)};a.willChannelUpdate=function(c){a.cycleCounter+=c;return!(!a.volumeCodeChanged&&0<a.frequencyTimer-a.cycleCounter)};a.updateLength=function(){var c=a.lengthCounter;0<c&&a.NRx4LengthEnabled&&--c;0===c&&
(a.isEnabled=!1);a.lengthCounter=c};a.cycleCounter=0;a.memoryLocationNRx0=65306;a.memoryLocationNRx1=65307;a.NRx1LengthLoad=0;a.memoryLocationNRx2=65308;a.NRx2VolumeCode=0;a.memoryLocationNRx3=65309;a.NRx3FrequencyLSB=0;a.memoryLocationNRx4=65310;a.NRx4LengthEnabled=!1;a.NRx4FrequencyMSB=0;a.memoryLocationWaveTable=65328;a.channelNumber=3;a.isEnabled=!1;a.isDacEnabled=!1;a.frequency=0;a.frequencyTimer=0;a.lengthCounter=0;a.waveTablePosition=0;a.volumeCode=0;a.volumeCodeChanged=!1;a.saveStateSlot=
9;return a}(),O=function(){function a(){}a.updateNRx1=function(c){a.NRx1LengthLoad=c&63;a.lengthCounter=64-a.NRx1LengthLoad};a.updateNRx2=function(c){a.NRx2StartingVolume=c>>4&15;a.NRx2EnvelopeAddMode=p(3,c);a.NRx2EnvelopePeriod=c&7;a.isDacEnabled=0<(c&248)};a.updateNRx3=function(c){var b=c&7;a.NRx3ClockShift=c>>4;a.NRx3WidthMode=p(3,c);a.NRx3DivisorCode=b;b<<=1;1>b&&(b=1);a.divisor=b<<3};a.updateNRx4=function(c){a.NRx4LengthEnabled=p(6,c)};a.saveState=function(){e[1024+50*a.saveStateSlot]=a.isEnabled;
e[1025+50*a.saveStateSlot]=a.frequencyTimer;e[1029+50*a.saveStateSlot]=a.envelopeCounter;e[1033+50*a.saveStateSlot]=a.lengthCounter;e[1038+50*a.saveStateSlot]=a.volume;e[1043+50*a.saveStateSlot]=a.linearFeedbackShiftRegister};a.loadState=function(){a.isEnabled=Q(1024+50*a.saveStateSlot);a.frequencyTimer=e[1025+50*a.saveStateSlot];a.envelopeCounter=e[1029+50*a.saveStateSlot];a.lengthCounter=e[1033+50*a.saveStateSlot];a.volume=e[1038+50*a.saveStateSlot];a.linearFeedbackShiftRegister=e[1043+50*a.saveStateSlot]};
a.initialize=function(){h(a.memoryLocationNRx1-1,255);h(a.memoryLocationNRx1,255);h(a.memoryLocationNRx2,0);h(a.memoryLocationNRx3,0);h(a.memoryLocationNRx4,191)};a.getSampleFromCycleCounter=function(){var c=a.cycleCounter;a.cycleCounter=0;return a.getSample(c)};a.getSample=function(c){var b=a.frequencyTimer;b-=c;if(0>=b){c=Math.abs(b);b=a.getNoiseChannelFrequencyPeriod();b-=c;c=a.linearFeedbackShiftRegister;var d=c&1^c>>1&1;c=c>>1|d<<14;a.NRx3WidthMode&&(c=c&-65|d<<6);a.linearFeedbackShiftRegister=
c}a.frequencyTimer=b;if(a.isEnabled&&a.isDacEnabled)b=a.volume;else return 15;c=p(0,a.linearFeedbackShiftRegister)?-1:1;return c*b+15};a.trigger=function(){a.isEnabled=!0;0===a.lengthCounter&&(a.lengthCounter=64);a.frequencyTimer=a.getNoiseChannelFrequencyPeriod();a.envelopeCounter=a.NRx2EnvelopePeriod;a.volume=a.NRx2StartingVolume;a.linearFeedbackShiftRegister=32767;a.isDacEnabled||(a.isEnabled=!1)};a.willChannelUpdate=function(c){a.cycleCounter+=c;return!(0<a.frequencyTimer-a.cycleCounter)};a.getNoiseChannelFrequencyPeriod=
function(){return a.divisor<<a.NRx3ClockShift<<b.GBCDoubleSpeed};a.updateLength=function(){var c=a.lengthCounter;0<c&&a.NRx4LengthEnabled&&--c;0===c&&(a.isEnabled=!1);a.lengthCounter=c};a.updateEnvelope=function(){var c=a.envelopeCounter-1;if(0>=c&&(c=a.NRx2EnvelopePeriod,0!==c)){var b=a.volume;a.NRx2EnvelopeAddMode&&15>b?b+=1:!a.NRx2EnvelopeAddMode&&0<b&&--b;a.volume=b}a.envelopeCounter=c};a.cycleCounter=0;a.memoryLocationNRx1=65312;a.NRx1LengthLoad=0;a.memoryLocationNRx2=65313;a.NRx2StartingVolume=
0;a.NRx2EnvelopeAddMode=!1;a.NRx2EnvelopePeriod=0;a.memoryLocationNRx3=65314;a.NRx3ClockShift=0;a.NRx3WidthMode=!1;a.NRx3DivisorCode=0;a.memoryLocationNRx4=65315;a.NRx4LengthEnabled=!1;a.channelNumber=4;a.isEnabled=!1;a.isDacEnabled=!1;a.frequencyTimer=0;a.envelopeCounter=0;a.lengthCounter=0;a.volume=0;a.divisor=0;a.linearFeedbackShiftRegister=0;a.saveStateSlot=10;return a}(),q=function(){function a(){}a.channel1Sample=15;a.channel2Sample=15;a.channel3Sample=15;a.channel4Sample=15;a.channel1DacEnabled=
!1;a.channel2DacEnabled=!1;a.channel3DacEnabled=!1;a.channel4DacEnabled=!1;a.leftChannelSampleUnsignedByte=127;a.rightChannelSampleUnsignedByte=127;a.mixerVolumeChanged=!1;a.mixerEnabledChanged=!1;a.needToRemixSamples=!1;return a}(),k=function(){function a(){}a.batchProcessCycles=function(){return 87<<b.GBCDoubleSpeed};a.updateNR50=function(b){a.NR50LeftMixerVolume=b>>4&7;a.NR50RightMixerVolume=b&7};a.updateNR51=function(b){a.NR51IsChannel4EnabledOnLeftOutput=p(7,b);a.NR51IsChannel3EnabledOnLeftOutput=
p(6,b);a.NR51IsChannel2EnabledOnLeftOutput=p(5,b);a.NR51IsChannel1EnabledOnLeftOutput=p(4,b);a.NR51IsChannel4EnabledOnRightOutput=p(3,b);a.NR51IsChannel3EnabledOnRightOutput=p(2,b);a.NR51IsChannel2EnabledOnRightOutput=p(1,b);a.NR51IsChannel1EnabledOnRightOutput=p(0,b)};a.updateNR52=function(b){a.NR52IsSoundEnabled=p(7,b)};a.maxFrameSequenceCycles=function(){return 8192<<b.GBCDoubleSpeed};a.maxDownSampleCycles=function(){return b.CLOCK_SPEED()};a.saveState=function(){e[1024+50*a.saveStateSlot]=a.frameSequenceCycleCounter;
e[1028+50*a.saveStateSlot]=a.downSampleCycleCounter;e[1029+50*a.saveStateSlot]=a.frameSequencer};a.loadState=function(){a.frameSequenceCycleCounter=e[1024+50*a.saveStateSlot];a.downSampleCycleCounter=e[1028+50*a.saveStateSlot];a.frameSequencer=e[1029+50*a.saveStateSlot];ec()};a.currentCycles=0;a.memoryLocationNR50=65316;a.NR50LeftMixerVolume=0;a.NR50RightMixerVolume=0;a.memoryLocationNR51=65317;a.NR51IsChannel1EnabledOnLeftOutput=!0;a.NR51IsChannel2EnabledOnLeftOutput=!0;a.NR51IsChannel3EnabledOnLeftOutput=
!0;a.NR51IsChannel4EnabledOnLeftOutput=!0;a.NR51IsChannel1EnabledOnRightOutput=!0;a.NR51IsChannel2EnabledOnRightOutput=!0;a.NR51IsChannel3EnabledOnRightOutput=!0;a.NR51IsChannel4EnabledOnRightOutput=!0;a.memoryLocationNR52=65318;a.NR52IsSoundEnabled=!0;a.memoryLocationChannel3LoadRegisterStart=65328;a.frameSequenceCycleCounter=0;a.downSampleCycleCounter=0;a.downSampleCycleMultiplier=48E3;a.frameSequencer=0;a.audioQueueIndex=0;a.wasmBoyMemoryMaxBufferSize=131072;a.saveStateSlot=6;return a}(),m=function(){function a(){}
a.updateInterruptEnabled=function(b){a.isVBlankInterruptEnabled=p(a.bitPositionVBlankInterrupt,b);a.isLcdInterruptEnabled=p(a.bitPositionLcdInterrupt,b);a.isTimerInterruptEnabled=p(a.bitPositionTimerInterrupt,b);a.isSerialInterruptEnabled=p(a.bitPositionSerialInterrupt,b);a.isJoypadInterruptEnabled=p(a.bitPositionJoypadInterrupt,b);a.interruptsEnabledValue=b};a.updateInterruptRequested=function(b){a.isVBlankInterruptRequested=p(a.bitPositionVBlankInterrupt,b);a.isLcdInterruptRequested=p(a.bitPositionLcdInterrupt,
b);a.isTimerInterruptRequested=p(a.bitPositionTimerInterrupt,b);a.isSerialInterruptRequested=p(a.bitPositionSerialInterrupt,b);a.isJoypadInterruptRequested=p(a.bitPositionJoypadInterrupt,b);a.interruptsRequestedValue=b};a.areInterruptsPending=function(){return 0<(a.interruptsRequestedValue&a.interruptsEnabledValue&31)};a.saveState=function(){e[1024+50*a.saveStateSlot]=a.masterInterruptSwitch;e[1025+50*a.saveStateSlot]=a.masterInterruptSwitchDelay};a.loadState=function(){a.masterInterruptSwitch=Q(1024+
50*a.saveStateSlot);a.masterInterruptSwitchDelay=Q(1025+50*a.saveStateSlot);a.updateInterruptEnabled(w(a.memoryLocationInterruptEnabled));a.updateInterruptRequested(w(a.memoryLocationInterruptRequest))};a.masterInterruptSwitch=!1;a.masterInterruptSwitchDelay=!1;a.bitPositionVBlankInterrupt=0;a.bitPositionLcdInterrupt=1;a.bitPositionTimerInterrupt=2;a.bitPositionSerialInterrupt=3;a.bitPositionJoypadInterrupt=4;a.memoryLocationInterruptEnabled=65535;a.interruptsEnabledValue=0;a.isVBlankInterruptEnabled=
!1;a.isLcdInterruptEnabled=!1;a.isTimerInterruptEnabled=!1;a.isSerialInterruptEnabled=!1;a.isJoypadInterruptEnabled=!1;a.memoryLocationInterruptRequest=65295;a.interruptsRequestedValue=0;a.isVBlankInterruptRequested=!1;a.isLcdInterruptRequested=!1;a.isTimerInterruptRequested=!1;a.isSerialInterruptRequested=!1;a.isJoypadInterruptRequested=!1;a.saveStateSlot=2;return a}(),u=function(){function a(){}a.batchProcessCycles=function(){return 256};a.updateDividerRegister=function(){var b=a.dividerRegister;
a.dividerRegister=0;h(a.memoryLocationDividerRegister,0);a.timerEnabled&&gc(b,0)&&Ib()};a.updateTimerCounter=function(b){if(a.timerEnabled){if(a.timerCounterWasReset)return;a.timerCounterOverflowDelay&&(a.timerCounterOverflowDelay=!1)}a.timerCounter=b};a.updateTimerModulo=function(b){a.timerModulo=b;a.timerEnabled&&a.timerCounterWasReset&&(a.timerCounter=b,a.timerCounterWasReset=!1)};a.updateTimerControl=function(b){var c=a.timerEnabled;a.timerEnabled=p(2,b);b&=3;if(!c){c=Jb(a.timerInputClock);var d=
Jb(b),e=a.dividerRegister;(a.timerEnabled?p(c,e):p(c,e)&&p(d,e))&&Ib()}a.timerInputClock=b};a.saveState=function(){e[1024+50*a.saveStateSlot]=a.currentCycles;e[1028+50*a.saveStateSlot]=a.dividerRegister;e[1032+50*a.saveStateSlot]=a.timerCounterOverflowDelay;e[1035+50*a.saveStateSlot]=a.timerCounterWasReset;h(a.memoryLocationTimerCounter,a.timerCounter)};a.loadState=function(){a.currentCycles=e[1024+50*a.saveStateSlot];a.dividerRegister=e[1028+50*a.saveStateSlot];a.timerCounterOverflowDelay=Q(1032+
50*a.saveStateSlot);a.timerCounterWasReset=Q(1035+50*a.saveStateSlot);a.timerCounter=w(a.memoryLocationTimerCounter);a.timerModulo=w(a.memoryLocationTimerModulo);a.timerInputClock=w(a.memoryLocationTimerControl)};a.currentCycles=0;a.memoryLocationDividerRegister=65284;a.dividerRegister=0;a.memoryLocationTimerCounter=65285;a.timerCounter=0;a.timerCounterOverflowDelay=!1;a.timerCounterWasReset=!1;a.timerCounterMask=0;a.memoryLocationTimerModulo=65286;a.timerModulo=0;a.memoryLocationTimerControl=65287;
a.timerEnabled=!1;a.timerInputClock=0;a.saveStateSlot=5;return a}(),Z=function(){function a(){}a.updateTransferControl=function(b){a.isShiftClockInternal=p(0,b);a.isClockSpeedFast=p(1,b);a.transferStartFlag=p(7,b);return!0};a.currentCycles=0;a.memoryLocationSerialTransferData=65281;a.memoryLocationSerialTransferControl=65282;a.numberOfBitsTransferred=0;a.isShiftClockInternal=!1;a.isClockSpeedFast=!1;a.transferStartFlag=!1;return a}(),A=function(){function a(){}a.updateJoypad=function(b){a.joypadRegisterFlipped=
b^255;a.isDpadType=p(4,a.joypadRegisterFlipped);a.isButtonType=p(5,a.joypadRegisterFlipped)};a.saveState=function(){};a.loadState=function(){a.updateJoypad(w(a.memoryLocationJoypadRegister))};a.up=!1;a.down=!1;a.left=!1;a.right=!1;a.a=!1;a.b=!1;a.select=!1;a.start=!1;a.memoryLocationJoypadRegister=65280;a.joypadRegisterFlipped=0;a.isDpadType=!1;a.isButtonType=!1;a.saveStateSlot=3;return a}(),aa=function(){function a(){}a.programCounter=-1;a.readGbMemory=-1;a.writeGbMemory=-1;a.reachedBreakpoint=!1;
return a}(),y=function(){function a(){}a.updateLcdStatus=function(b){var c=w(a.memoryLocationLcdStatus);b=b&248|c&7|128;h(a.memoryLocationLcdStatus,b)};a.updateLcdControl=function(b){var c=a.enabled;a.enabled=p(7,b);a.windowTileMapDisplaySelect=p(6,b);a.windowDisplayEnabled=p(5,b);a.bgWindowTileDataSelect=p(4,b);a.bgTileMapDisplaySelect=p(3,b);a.tallSpriteSize=p(2,b);a.spriteDisplayEnable=p(1,b);a.bgDisplayEnabled=p(0,b);c&&!a.enabled&&jc(!0);!c&&a.enabled&&jc(!1)};a.memoryLocationLcdStatus=65345;
a.currentLcdMode=0;a.memoryLocationCoincidenceCompare=65349;a.coincidenceCompare=0;a.memoryLocationLcdControl=65344;a.enabled=!0;a.windowTileMapDisplaySelect=!1;a.windowDisplayEnabled=!1;a.bgWindowTileDataSelect=!1;a.bgTileMapDisplaySelect=!1;a.tallSpriteSize=!1;a.spriteDisplayEnable=!1;a.bgDisplayEnabled=!1;return a}(),r=function(){function a(){}a.batchProcessCycles=function(){return a.MAX_CYCLES_PER_SCANLINE()};a.MAX_CYCLES_PER_SCANLINE=function(){return 153===a.scanlineRegister?4<<b.GBCDoubleSpeed:
456<<b.GBCDoubleSpeed};a.MIN_CYCLES_SPRITES_LCD_MODE=function(){return 376<<b.GBCDoubleSpeed};a.MIN_CYCLES_TRANSFER_DATA_LCD_MODE=function(){return 249<<b.GBCDoubleSpeed};a.saveState=function(){e[1024+50*a.saveStateSlot]=a.scanlineCycleCounter;e[1028+50*a.saveStateSlot]=y.currentLcdMode;h(a.memoryLocationScanlineRegister,a.scanlineRegister)};a.loadState=function(){a.scanlineCycleCounter=e[1024+50*a.saveStateSlot];y.currentLcdMode=e[1028+50*a.saveStateSlot];a.scanlineRegister=w(a.memoryLocationScanlineRegister);
y.updateLcdControl(w(y.memoryLocationLcdControl))};a.currentCycles=0;a.scanlineCycleCounter=0;a.memoryLocationScanlineRegister=65348;a.scanlineRegister=0;a.memoryLocationDmaTransfer=65350;a.memoryLocationScrollX=65347;a.scrollX=0;a.memoryLocationScrollY=65346;a.scrollY=0;a.memoryLocationWindowX=65355;a.windowX=0;a.memoryLocationWindowY=65354;a.windowY=0;a.memoryLocationTileMapSelectZeroStart=38912;a.memoryLocationTileMapSelectOneStart=39936;a.memoryLocationTileDataSelectZeroStart=34816;a.memoryLocationTileDataSelectOneStart=
32768;a.memoryLocationSpriteAttributesTable=65024;a.memoryLocationBackgroundPalette=65351;a.memoryLocationSpritePaletteOne=65352;a.memoryLocationSpritePaletteTwo=65353;a.saveStateSlot=1;return a}(),g=function(){function a(){}a.saveState=function(){e[1024+50*a.saveStateSlot]=a.currentRomBank;e[1026+50*a.saveStateSlot]=a.currentRamBank;e[1028+50*a.saveStateSlot]=a.isRamBankingEnabled;e[1029+50*a.saveStateSlot]=a.isMBC1RomModeEnabled;e[1030+50*a.saveStateSlot]=a.isRomOnly;e[1031+50*a.saveStateSlot]=
a.isMBC1;e[1032+50*a.saveStateSlot]=a.isMBC2;e[1033+50*a.saveStateSlot]=a.isMBC3;e[1034+50*a.saveStateSlot]=a.isMBC5};a.loadState=function(){a.currentRomBank=e[1024+50*a.saveStateSlot];a.currentRamBank=e[1026+50*a.saveStateSlot];a.isRamBankingEnabled=Q(1028+50*a.saveStateSlot);a.isMBC1RomModeEnabled=Q(1029+50*a.saveStateSlot);a.isRomOnly=Q(1030+50*a.saveStateSlot);a.isMBC1=Q(1031+50*a.saveStateSlot);a.isMBC2=Q(1032+50*a.saveStateSlot);a.isMBC3=Q(1033+50*a.saveStateSlot);a.isMBC5=Q(1034+50*a.saveStateSlot)};
a.cartridgeRomLocation=0;a.switchableCartridgeRomLocation=16384;a.videoRamLocation=32768;a.cartridgeRamLocation=40960;a.internalRamBankZeroLocation=49152;a.internalRamBankOneLocation=53248;a.echoRamLocation=57344;a.spriteInformationTableLocation=65024;a.spriteInformationTableLocationEnd=65183;a.unusableMemoryLocation=65184;a.unusableMemoryEndLocation=65279;a.currentRomBank=0;a.currentRamBank=0;a.isRamBankingEnabled=!1;a.isMBC1RomModeEnabled=!0;a.isRomOnly=!0;a.isMBC1=!1;a.isMBC2=!1;a.isMBC3=!1;a.isMBC5=
!1;a.memoryLocationHdmaSourceHigh=65361;a.memoryLocationHdmaSourceLow=65362;a.memoryLocationHdmaDestinationHigh=65363;a.memoryLocationHdmaDestinationLow=65364;a.memoryLocationHdmaTrigger=65365;a.DMACycles=0;a.isHblankHdmaActive=!1;a.hblankHdmaTransferLengthRemaining=0;a.hblankHdmaSource=0;a.hblankHdmaDestination=0;a.memoryLocationGBCVRAMBank=65359;a.memoryLocationGBCWRAMBank=65392;a.saveStateSlot=4;return a}(),b=function(){function a(){}a.CLOCK_SPEED=function(){return 4194304<<a.GBCDoubleSpeed};a.MAX_CYCLES_PER_FRAME=
function(){return 70224<<a.GBCDoubleSpeed};a.enableHalt=function(){m.masterInterruptSwitch?a.isHaltNormal=!0:0===(m.interruptsEnabledValue&m.interruptsRequestedValue&31)?a.isHaltNoJump=!0:a.isHaltBug=!0};a.exitHaltAndStop=function(){a.isHaltNoJump=!1;a.isHaltNormal=!1;a.isHaltBug=!1;a.isStopped=!1};a.isHalted=function(){return a.isHaltNormal||a.isHaltNoJump};a.saveState=function(){e[1024+50*a.saveStateSlot]=a.registerA;e[1025+50*a.saveStateSlot]=a.registerB;e[1026+50*a.saveStateSlot]=a.registerC;
e[1027+50*a.saveStateSlot]=a.registerD;e[1028+50*a.saveStateSlot]=a.registerE;e[1029+50*a.saveStateSlot]=a.registerH;e[1030+50*a.saveStateSlot]=a.registerL;e[1031+50*a.saveStateSlot]=a.registerF;e[1032+50*a.saveStateSlot]=a.stackPointer;e[1034+50*a.saveStateSlot]=a.programCounter;e[1036+50*a.saveStateSlot]=a.currentCycles;e[1041+50*a.saveStateSlot]=a.isHaltNormal;e[1042+50*a.saveStateSlot]=a.isHaltNoJump;e[1043+50*a.saveStateSlot]=a.isHaltBug;e[1044+50*a.saveStateSlot]=a.isStopped};a.loadState=function(){a.registerA=
e[1024+50*a.saveStateSlot];a.registerB=e[1025+50*a.saveStateSlot];a.registerC=e[1026+50*a.saveStateSlot];a.registerD=e[1027+50*a.saveStateSlot];a.registerE=e[1028+50*a.saveStateSlot];a.registerH=e[1029+50*a.saveStateSlot];a.registerL=e[1030+50*a.saveStateSlot];a.registerF=e[1031+50*a.saveStateSlot];a.stackPointer=e[1032+50*a.saveStateSlot];a.programCounter=e[1034+50*a.saveStateSlot];a.currentCycles=e[1036+50*a.saveStateSlot];a.isHaltNormal=Q(1041+50*a.saveStateSlot);a.isHaltNoJump=Q(1042+50*a.saveStateSlot);
a.isHaltBug=Q(1043+50*a.saveStateSlot);a.isStopped=Q(1044+50*a.saveStateSlot)};a.GBCEnabled=!1;a.memoryLocationSpeedSwitch=65357;a.GBCDoubleSpeed=!1;a.registerA=0;a.registerB=0;a.registerC=0;a.registerD=0;a.registerE=0;a.registerH=0;a.registerL=0;a.registerF=0;a.stackPointer=0;a.programCounter=0;a.currentCycles=0;a.isHaltNormal=!1;a.isHaltNoJump=!1;a.isHaltBug=!1;a.isStopped=!1;a.saveStateSlot=0;return a}(),da=function(){function a(){}a.cyclesPerCycleSet=2E9;a.cycleSets=0;a.cycles=0;return a}(),W=
function(){function a(){}a.stepsPerStepSet=2E9;a.stepSets=0;a.steps=0;a.RESPONSE_CONDITION_ERROR=-1;a.RESPONSE_CONDITION_FRAME=0;a.RESPONSE_CONDITION_AUDIO=1;a.RESPONSE_CONDITION_BREAKPOINT=2;return a}();lb.size()<Vb&&lb.grow(Vb-lb.size());var jb=!1,Vc=Object.freeze({memory:lb,config:function(a,c,e,l,f,p,n,t,C,v){S.enableBootRom=0<a;S.useGbcWhenAvailable=0<c;S.audioBatchProcessing=0<e;S.graphicsBatchProcessing=0<l;S.timersBatchProcessing=0<f;S.graphicsDisableScanlineRendering=0<p;S.audioAccumulateSamples=
0<n;S.tileRendering=0<t;S.tileCaching=0<C;S.enableAudioDebugging=0<v;a=w(323);b.GBCEnabled=192===a||S.useGbcWhenAvailable&&128===a?!0:!1;b.GBCDoubleSpeed=!1;b.registerA=0;b.registerB=0;b.registerC=0;b.registerD=0;b.registerE=0;b.registerH=0;b.registerL=0;b.registerF=0;b.stackPointer=0;b.programCounter=0;b.currentCycles=0;b.isHaltNormal=!1;b.isHaltNoJump=!1;b.isHaltBug=!1;b.isStopped=!1;b.GBCEnabled?(b.registerA=17,b.registerF=128,b.registerB=0,b.registerC=0,b.registerD=255,b.registerE=86,b.registerH=
0,b.registerL=13):(b.registerA=1,b.registerF=176,b.registerB=0,b.registerC=19,b.registerD=0,b.registerE=216,b.registerH=1,b.registerL=77);b.programCounter=256;b.stackPointer=65534;g.isRamBankingEnabled=!1;g.isMBC1RomModeEnabled=!0;a=w(327);g.isRomOnly=0===a;g.isMBC1=1<=a&&3>=a;g.isMBC2=5<=a&&6>=a;g.isMBC3=15<=a&&19>=a;g.isMBC5=25<=a&&30>=a;g.currentRomBank=1;g.currentRamBank=0;h(65361,255);h(65362,255);h(65363,255);h(65364,255);h(65365,255);r.currentCycles=0;r.scanlineCycleCounter=0;r.scanlineRegister=
0;r.scrollX=0;r.scrollY=0;r.windowX=0;r.windowY=0;r.scanlineRegister=144;b.GBCEnabled?(h(65344,145),h(65345,129),h(65348,144),h(65351,252)):(h(65344,145),h(65345,133),h(65350,255),h(65351,252),h(65352,255),h(65353,255));h(65359,0);h(65392,1);Yb(0);a=0;for(c=308;323>=c;c++)a+=w(c);switch(a&255){case 136:d.bgWhite=wa.bgWhite;d.bgLightGrey=wa.bgLightGrey;d.bgDarkGrey=wa.bgDarkGrey;d.bgBlack=wa.bgBlack;d.obj0White=wa.obj0White;d.obj0LightGrey=wa.obj0LightGrey;d.obj0DarkGrey=wa.obj0DarkGrey;d.obj0Black=
wa.obj0Black;d.obj1White=wa.obj1White;d.obj1LightGrey=wa.obj1LightGrey;d.obj1DarkGrey=wa.obj1DarkGrey;d.obj1Black=wa.obj1Black;break;case 97:d.bgWhite=xa.bgWhite;d.bgLightGrey=xa.bgLightGrey;d.bgDarkGrey=xa.bgDarkGrey;d.bgBlack=xa.bgBlack;d.obj0White=xa.obj0White;d.obj0LightGrey=xa.obj0LightGrey;d.obj0DarkGrey=xa.obj0DarkGrey;d.obj0Black=xa.obj0Black;d.obj1White=xa.obj1White;d.obj1LightGrey=xa.obj1LightGrey;d.obj1DarkGrey=xa.obj1DarkGrey;d.obj1Black=xa.obj1Black;break;case 20:d.bgWhite=ya.bgWhite;
d.bgLightGrey=ya.bgLightGrey;d.bgDarkGrey=ya.bgDarkGrey;d.bgBlack=ya.bgBlack;d.obj0White=ya.obj0White;d.obj0LightGrey=ya.obj0LightGrey;d.obj0DarkGrey=ya.obj0DarkGrey;d.obj0Black=ya.obj0Black;d.obj1White=ya.obj1White;d.obj1LightGrey=ya.obj1LightGrey;d.obj1DarkGrey=ya.obj1DarkGrey;d.obj1Black=ya.obj1Black;break;case 70:d.bgWhite=za.bgWhite;d.bgLightGrey=za.bgLightGrey;d.bgDarkGrey=za.bgDarkGrey;d.bgBlack=za.bgBlack;d.obj0White=za.obj0White;d.obj0LightGrey=za.obj0LightGrey;d.obj0DarkGrey=za.obj0DarkGrey;
d.obj0Black=za.obj0Black;d.obj1White=za.obj1White;d.obj1LightGrey=za.obj1LightGrey;d.obj1DarkGrey=za.obj1DarkGrey;d.obj1Black=za.obj1Black;break;case 89:case 198:d.bgWhite=Aa.bgWhite;d.bgLightGrey=Aa.bgLightGrey;d.bgDarkGrey=Aa.bgDarkGrey;d.bgBlack=Aa.bgBlack;d.obj0White=Aa.obj0White;d.obj0LightGrey=Aa.obj0LightGrey;d.obj0DarkGrey=Aa.obj0DarkGrey;d.obj0Black=Aa.obj0Black;d.obj1White=Aa.obj1White;d.obj1LightGrey=Aa.obj1LightGrey;d.obj1DarkGrey=Aa.obj1DarkGrey;d.obj1Black=Aa.obj1Black;break;case 134:case 168:d.bgWhite=
Ba.bgWhite;d.bgLightGrey=Ba.bgLightGrey;d.bgDarkGrey=Ba.bgDarkGrey;d.bgBlack=Ba.bgBlack;d.obj0White=Ba.obj0White;d.obj0LightGrey=Ba.obj0LightGrey;d.obj0DarkGrey=Ba.obj0DarkGrey;d.obj0Black=Ba.obj0Black;d.obj1White=Ba.obj1White;d.obj1LightGrey=Ba.obj1LightGrey;d.obj1DarkGrey=Ba.obj1DarkGrey;d.obj1Black=Ba.obj1Black;break;case 191:case 206:case 209:case 240:d.bgWhite=Ca.bgWhite;d.bgLightGrey=Ca.bgLightGrey;d.bgDarkGrey=Ca.bgDarkGrey;d.bgBlack=Ca.bgBlack;d.obj0White=Ca.obj0White;d.obj0LightGrey=Ca.obj0LightGrey;
d.obj0DarkGrey=Ca.obj0DarkGrey;d.obj0Black=Ca.obj0Black;d.obj1White=Ca.obj1White;d.obj1LightGrey=Ca.obj1LightGrey;d.obj1DarkGrey=Ca.obj1DarkGrey;d.obj1Black=Ca.obj1Black;break;case 39:case 73:case 92:case 179:d.bgWhite=Da.bgWhite;d.bgLightGrey=Da.bgLightGrey;d.bgDarkGrey=Da.bgDarkGrey;d.bgBlack=Da.bgBlack;d.obj0White=Da.obj0White;d.obj0LightGrey=Da.obj0LightGrey;d.obj0DarkGrey=Da.obj0DarkGrey;d.obj0Black=Da.obj0Black;d.obj1White=Da.obj1White;d.obj1LightGrey=Da.obj1LightGrey;d.obj1DarkGrey=Da.obj1DarkGrey;
d.obj1Black=Da.obj1Black;break;case 201:d.bgWhite=Ea.bgWhite;d.bgLightGrey=Ea.bgLightGrey;d.bgDarkGrey=Ea.bgDarkGrey;d.bgBlack=Ea.bgBlack;d.obj0White=Ea.obj0White;d.obj0LightGrey=Ea.obj0LightGrey;d.obj0DarkGrey=Ea.obj0DarkGrey;d.obj0Black=Ea.obj0Black;d.obj1White=Ea.obj1White;d.obj1LightGrey=Ea.obj1LightGrey;d.obj1DarkGrey=Ea.obj1DarkGrey;d.obj1Black=Ea.obj1Black;break;case 112:d.bgWhite=Fa.bgWhite;d.bgLightGrey=Fa.bgLightGrey;d.bgDarkGrey=Fa.bgDarkGrey;d.bgBlack=Fa.bgBlack;d.obj0White=Fa.obj0White;
d.obj0LightGrey=Fa.obj0LightGrey;d.obj0DarkGrey=Fa.obj0DarkGrey;d.obj0Black=Fa.obj0Black;d.obj1White=Fa.obj1White;d.obj1LightGrey=Fa.obj1LightGrey;d.obj1DarkGrey=Fa.obj1DarkGrey;d.obj1Black=Fa.obj1Black;break;case 70:d.bgWhite=Ga.bgWhite;d.bgLightGrey=Ga.bgLightGrey;d.bgDarkGrey=Ga.bgDarkGrey;d.bgBlack=Ga.bgBlack;d.obj0White=Ga.obj0White;d.obj0LightGrey=Ga.obj0LightGrey;d.obj0DarkGrey=Ga.obj0DarkGrey;d.obj0Black=Ga.obj0Black;d.obj1White=Ga.obj1White;d.obj1LightGrey=Ga.obj1LightGrey;d.obj1DarkGrey=
Ga.obj1DarkGrey;d.obj1Black=Ga.obj1Black;break;case 211:d.bgWhite=Ha.bgWhite,d.bgLightGrey=Ha.bgLightGrey,d.bgDarkGrey=Ha.bgDarkGrey,d.bgBlack=Ha.bgBlack,d.obj0White=Ha.obj0White,d.obj0LightGrey=Ha.obj0LightGrey,d.obj0DarkGrey=Ha.obj0DarkGrey,d.obj0Black=Ha.obj0Black,d.obj1White=Ha.obj1White,d.obj1LightGrey=Ha.obj1LightGrey,d.obj1DarkGrey=Ha.obj1DarkGrey,d.obj1Black=Ha.obj1Black}b.GBCEnabled?(h(65384,192),h(65385,255),h(65386,193),h(65387,13)):(h(65384,255),h(65385,255),h(65386,255),h(65387,255));
k.currentCycles=0;k.NR50LeftMixerVolume=0;k.NR50RightMixerVolume=0;k.NR51IsChannel1EnabledOnLeftOutput=!0;k.NR51IsChannel2EnabledOnLeftOutput=!0;k.NR51IsChannel3EnabledOnLeftOutput=!0;k.NR51IsChannel4EnabledOnLeftOutput=!0;k.NR51IsChannel1EnabledOnRightOutput=!0;k.NR51IsChannel2EnabledOnRightOutput=!0;k.NR51IsChannel3EnabledOnRightOutput=!0;k.NR51IsChannel4EnabledOnRightOutput=!0;k.NR52IsSoundEnabled=!0;k.frameSequenceCycleCounter=0;k.downSampleCycleCounter=0;k.frameSequencer=0;k.audioQueueIndex=
0;z.initialize();N.initialize();J.initialize();O.initialize();h(k.memoryLocationNR50,119);h(k.memoryLocationNR51,243);h(k.memoryLocationNR52,241);q.channel1Sample=15;q.channel2Sample=15;q.channel3Sample=15;q.channel4Sample=15;q.channel1DacEnabled=!1;q.channel2DacEnabled=!1;q.channel3DacEnabled=!1;q.channel4DacEnabled=!1;q.leftChannelSampleUnsignedByte=127;q.rightChannelSampleUnsignedByte=127;q.mixerVolumeChanged=!0;q.mixerEnabledChanged=!0;q.needToRemixSamples=!1;m.updateInterruptEnabled(0);h(m.memoryLocationInterruptEnabled,
m.interruptsEnabledValue);m.updateInterruptRequested(225);h(m.memoryLocationInterruptRequest,m.interruptsRequestedValue);u.currentCycles=0;u.dividerRegister=0;u.timerCounter=0;u.timerModulo=0;u.timerEnabled=!1;u.timerInputClock=0;u.timerCounterOverflowDelay=!1;u.timerCounterWasReset=!1;b.GBCEnabled?(h(65284,30),u.dividerRegister=7840):(h(65284,171),u.dividerRegister=43980);h(65287,248);u.timerInputClock=248;Z.currentCycles=0;Z.numberOfBitsTransferred=0;b.GBCEnabled?(h(65282,124),Z.updateTransferControl(124)):
(h(65282,126),Z.updateTransferControl(126));b.GBCEnabled?(h(65392,248),h(65359,254),h(65357,126),h(65280,207),h(65295,225),h(65388,254),h(65397,143)):(h(65392,255),h(65359,255),h(65357,255),h(65280,207),h(65295,225));jb=!1;da.cyclesPerCycleSet=2E9;da.cycleSets=0;da.cycles=0;W.stepsPerStepSet=2E9;W.stepSets=0;W.steps=0},hasCoreStarted:function(){return jb},saveState:function(){b.saveState();r.saveState();m.saveState();A.saveState();g.saveState();u.saveState();k.saveState();z.saveState();N.saveState();
J.saveState();O.saveState();jb=!1},loadState:function(){b.loadState();r.loadState();m.loadState();A.loadState();g.loadState();u.loadState();k.loadState();z.loadState();N.loadState();J.loadState();O.loadState();jb=!1;da.cyclesPerCycleSet=2E9;da.cycleSets=0;da.cycles=0;W.stepsPerStepSet=2E9;W.stepSets=0;W.steps=0},isGBC:function(){return b.GBCEnabled},getStepsPerStepSet:function(){return W.stepsPerStepSet},getStepSets:function(){return W.stepSets},getSteps:function(){return W.steps},executeMultipleFrames:function(a){for(var b=
0,d=0;d<a&&0<=b;)b=oc(),d+=1;return 0>b?b:0},executeFrame:oc,executeFrameAndCheckAudio:function(a){void 0===a&&(a=0);return Qb(!0,a)},executeUntilCondition:Qb,executeStep:pc,getCyclesPerCycleSet:function(){return da.cyclesPerCycleSet},getCycleSets:function(){return da.cycleSets},getCycles:function(){return da.cycles},setJoypadState:function(a,b,d,e,f,h,g,l){0<a?Ua(0):Ja(0,!1);0<b?Ua(1):Ja(1,!1);0<d?Ua(2):Ja(2,!1);0<e?Ua(3):Ja(3,!1);0<f?Ua(4):Ja(4,!1);0<h?Ua(5):Ja(5,!1);0<g?Ua(6):Ja(6,!1);0<l?Ua(7):
Ja(7,!1)},getNumberOfSamplesInAudioBuffer:dc,clearAudioBuffer:ec,setManualColorizationPalette:Yb,WASMBOY_MEMORY_LOCATION:0,WASMBOY_MEMORY_SIZE:vc,WASMBOY_WASM_PAGES:Vb,ASSEMBLYSCRIPT_MEMORY_LOCATION:0,ASSEMBLYSCRIPT_MEMORY_SIZE:1024,WASMBOY_STATE_LOCATION:1024,WASMBOY_STATE_SIZE:1024,GAMEBOY_INTERNAL_MEMORY_LOCATION:2048,GAMEBOY_INTERNAL_MEMORY_SIZE:Sc,VIDEO_RAM_LOCATION:2048,VIDEO_RAM_SIZE:16384,WORK_RAM_LOCATION:18432,WORK_RAM_SIZE:32768,OTHER_GAMEBOY_INTERNAL_MEMORY_LOCATION:51200,OTHER_GAMEBOY_INTERNAL_MEMORY_SIZE:16384,
GRAPHICS_OUTPUT_LOCATION:Tc,GRAPHICS_OUTPUT_SIZE:Uc,GBC_PALETTE_LOCATION:Ya,GBC_PALETTE_SIZE:128,BG_PRIORITY_MAP_LOCATION:Za,BG_PRIORITY_MAP_SIZE:23552,FRAME_LOCATION:cb,FRAME_SIZE:93184,BACKGROUND_MAP_LOCATION:yb,BACKGROUND_MAP_SIZE:196608,TILE_DATA_LOCATION:Tb,TILE_DATA_SIZE:147456,OAM_TILES_LOCATION:zb,OAM_TILES_SIZE:15360,AUDIO_BUFFER_LOCATION:ub,AUDIO_BUFFER_SIZE:131072,CHANNEL_1_BUFFER_LOCATION:Db,CHANNEL_1_BUFFER_SIZE:131072,CHANNEL_2_BUFFER_LOCATION:Eb,CHANNEL_2_BUFFER_SIZE:131072,CHANNEL_3_BUFFER_LOCATION:Fb,
CHANNEL_3_BUFFER_SIZE:131072,CHANNEL_4_BUFFER_LOCATION:Gb,CHANNEL_4_BUFFER_SIZE:131072,CARTRIDGE_RAM_LOCATION:Nb,CARTRIDGE_RAM_SIZE:131072,CARTRIDGE_ROM_LOCATION:wb,CARTRIDGE_ROM_SIZE:8258560,DEBUG_GAMEBOY_MEMORY_LOCATION:Ub,DEBUG_GAMEBOY_MEMORY_SIZE:65535,getWasmBoyOffsetFromGameBoyOffset:Mb,setProgramCounterBreakpoint:function(a){aa.programCounter=a},resetProgramCounterBreakpoint:function(){aa.programCounter=-1},setReadGbMemoryBreakpoint:function(a){aa.readGbMemory=a},resetReadGbMemoryBreakpoint:function(){aa.readGbMemory=
-1},setWriteGbMemoryBreakpoint:function(a){aa.writeGbMemory=a},resetWriteGbMemoryBreakpoint:function(){aa.writeGbMemory=-1},getRegisterA:function(){return b.registerA},getRegisterB:function(){return b.registerB},getRegisterC:function(){return b.registerC},getRegisterD:function(){return b.registerD},getRegisterE:function(){return b.registerE},getRegisterH:function(){return b.registerH},getRegisterL:function(){return b.registerL},getRegisterF:function(){return b.registerF},getProgramCounter:function(){return b.programCounter},
getStackPointer:function(){return b.stackPointer},getOpcodeAtProgramCounter:function(){return w(b.programCounter)},getLY:function(){return r.scanlineRegister},drawBackgroundMapToWasmMemory:function(a){var c=r.memoryLocationTileDataSelectZeroStart;y.bgWindowTileDataSelect&&(c=r.memoryLocationTileDataSelectOneStart);var d=r.memoryLocationTileMapSelectZeroStart;y.bgTileMapDisplaySelect&&(d=r.memoryLocationTileMapSelectOneStart);for(var h=0;256>h;h++)for(var f=0;256>f;f++){var g=h,l=f,m=d+32*(g>>3)+(l>>
3),k=X(m,0);k=gb(c,k);var n=g%8;g=l%8;g=7-g;l=0;b.GBCEnabled&&0<a&&(l=X(m,1));p(6,l)&&(n=7-n);var q=0;p(3,l)&&(q=1);m=X(k+2*n,q);k=X(k+2*n+1,q);n=0;p(g,k)&&(n+=1,n<<=1);p(g,m)&&(n+=1);k=3*(256*h+f);b.GBCEnabled&&0<a?(m=qb(l&7,n,!1),l=va(0,m),g=va(1,m),m=va(2,m),k=yb+k,e[k]=l,e[k+1]=g,e[k+2]=m):(l=pb(n,r.memoryLocationBackgroundPalette),k=yb+k,e[k+0]=(l&16711680)>>16,e[k+1]=(l&65280)>>8,e[k+2]=l&255)}},drawTileDataToWasmMemory:function(){for(var a=0;23>a;a++)for(var c=0;31>c;c++){var d=0;15<c&&(d=
1);var e=a;15<a&&(e-=15);e<<=4;e=15<c?e+(c-15):e+c;var f=r.memoryLocationTileDataSelectOneStart;15<a&&(f=r.memoryLocationTileDataSelectZeroStart);for(var g=r.memoryLocationBackgroundPalette,h=-1,l=-1,k=0;8>k;k++)for(var m=0;5>m;m++){var n=4*(8*m+k),q=w(r.memoryLocationSpriteAttributesTable+n+2);e===q&&(n=w(r.memoryLocationSpriteAttributesTable+n+3),q=0,b.GBCEnabled&&p(3,n)&&(q=1),q===d&&(l=n,k=8,m=5,g=r.memoryLocationSpritePaletteOne,p(4,l)&&(g=r.memoryLocationSpritePaletteTwo)))}if(b.GBCEnabled&&
0>l){k=r.memoryLocationTileMapSelectZeroStart;y.bgTileMapDisplaySelect&&(k=r.memoryLocationTileMapSelectOneStart);m=-1;for(n=0;32>n;n++)for(q=0;32>q;q++){var t=k+32*q+n,u=X(t,0);e===u&&(m=t,q=n=32)}0<=m&&(h=X(m,1))}for(k=0;8>k;k++)Cb(e,f,d,0,7,k,8*c,8*a+k,248,Tb,!1,g,h,l)}},drawOamToWasmMemory:function(){for(var a=0;8>a;a++)for(var c=0;5>c;c++){var d=4*(8*c+a);w(r.memoryLocationSpriteAttributesTable+d);w(r.memoryLocationSpriteAttributesTable+d+1);var e=w(r.memoryLocationSpriteAttributesTable+d+2),
f=1;y.tallSpriteSize&&(1===e%2&&--e,f+=1);d=w(r.memoryLocationSpriteAttributesTable+d+3);var g=0;b.GBCEnabled&&p(3,d)&&(g=1);var h=r.memoryLocationSpritePaletteOne;p(4,d)&&(h=r.memoryLocationSpritePaletteTwo);for(var k=0;k<f;k++)for(var l=0;8>l;l++)Cb(e+k,r.memoryLocationTileDataSelectOneStart,g,0,7,l,8*a,16*c+l+8*k,64,zb,!1,h,-1,d)}},getDIV:function(){return u.dividerRegister},getTIMA:function(){return u.timerCounter},getTMA:function(){return u.timerModulo},getTAC:function(){var a=u.timerInputClock;
u.timerEnabled&&(a|=4);return a},updateDebugGBMemory:function(){for(var a=0;65535>a;a++){var b=Kb(a);e[Ub+a]=b}aa.reachedBreakpoint=!1}});const Wc=async()=>({instance:{exports:Vc},byteMemory:lb.wasmByteMemory,type:"TypeScript"});let kb,xb,sc,l;l={graphicsWorkerPort:void 0,memoryWorkerPort:void 0,controllerWorkerPort:void 0,audioWorkerPort:void 0,wasmInstance:void 0,wasmByteMemory:void 0,options:void 0,WASMBOY_GAME_BYTES_LOCATION:0,WASMBOY_GAME_RAM_BANKS_LOCATION:0,WASMBOY_INTERNAL_STATE_SIZE:0,WASMBOY_INTERNAL_STATE_LOCATION:0,
WASMBOY_INTERNAL_MEMORY_SIZE:0,WASMBOY_INTERNAL_MEMORY_LOCATION:0,WASMBOY_PALETTE_MEMORY_SIZE:0,WASMBOY_PALETTE_MEMORY_LOCATION:0,WASMBOY_CURRENT_FRAME_OUTPUT_LOCATION:0,WASMBOY_CURRENT_FRAME_SIZE:0,WASMBOY_SOUND_OUTPUT_LOCATION:0,WASMBOY_CHANNEL_1_OUTPUT_LOCATION:0,WASMBOY_CHANNEL_2_OUTPUT_LOCATION:0,WASMBOY_CHANNEL_3_OUTPUT_LOCATION:0,WASMBOY_CHANNEL_4_OUTPUT_LOCATION:0,paused:!0,updateId:void 0,timeStampsUntilReady:0,fpsTimeStamps:[],speed:0,frameSkipCounter:0,currentAudioLatencyInSeconds:0,messageHandler:(a)=>
{const b=eb(a);switch(b.message.type){case x.CONNECT:"GRAPHICS"===b.message.workerId?(l.graphicsWorkerPort=b.message.ports[0],fb(wc.bind(void 0,l),l.graphicsWorkerPort)):"MEMORY"===b.message.workerId?(l.memoryWorkerPort=b.message.ports[0],fb(zc.bind(void 0,l),l.memoryWorkerPort)):"CONTROLLER"===b.message.workerId?(l.controllerWorkerPort=b.message.ports[0],fb(yc.bind(void 0,l),l.controllerWorkerPort)):"AUDIO"===b.message.workerId&&(l.audioWorkerPort=b.message.ports[0],fb(xc.bind(void 0,l),l.audioWorkerPort));
ea(M(void 0,b.messageId));break;case x.INSTANTIATE_WASM:(async()=>{let a;a=await Wc();l.wasmInstance=a.instance;l.wasmByteMemory=a.byteMemory;ea(M({type:a.type},b.messageId))})();break;case x.CONFIG:l.wasmInstance.exports.config.apply(l,b.message.config);l.options=b.message.options;ea(M(void 0,b.messageId));break;case x.RESET_AUDIO_QUEUE:l.wasmInstance.exports.clearAudioBuffer();ea(M(void 0,b.messageId));break;case x.PLAY:if(!l.paused||!l.wasmInstance||!l.wasmByteMemory){ea(M({error:!0},b.messageId));
break}l.paused=!1;l.fpsTimeStamps=[];Rb(l);l.frameSkipCounter=0;l.currentAudioLatencyInSeconds=0;l.options.isGbcColorizationEnabled?l.options.gbcColorizationPalette&&l.wasmInstance.exports.setManualColorizationPalette("wasmboygb brown red darkbrown green darkgreen inverted pastelmix orange yellow blue darkblue grayscale".split(" ").indexOf(l.options.gbcColorizationPalette.toLowerCase())):l.wasmInstance.exports.setManualColorizationPalette(0);tc(l,1E3/l.options.gameboyFrameRate);ea(M(void 0,b.messageId));
break;case x.PAUSE:l.paused=!0;l.updateId&&(clearTimeout(l.updateId),l.updateId=void 0);ea(M(void 0,b.messageId));break;case x.RUN_WASM_EXPORT:a=b.message.parameters?l.wasmInstance.exports[b.message.export].apply(void 0,b.message.parameters):l.wasmInstance.exports[b.message.export]();ea(M({type:x.RUN_WASM_EXPORT,response:a},b.messageId));break;case x.GET_WASM_MEMORY_SECTION:{a=0;let c=l.wasmByteMemory.length;b.message.start&&(a=b.message.start);b.message.end&&(c=b.message.end);a=l.wasmByteMemory.slice(a,
c).buffer;ea(M({type:x.RUN_WASM_EXPORT,response:a},b.messageId),[a]);break}case x.GET_WASM_CONSTANT:ea(M({type:x.GET_WASM_CONSTANT,response:l.wasmInstance.exports[b.message.constant].valueOf()},b.messageId));break;case x.FORCE_OUTPUT_FRAME:qc(l);break;case x.SET_SPEED:l.speed=b.message.speed;l.fpsTimeStamps=[];l.timeStampsUntilReady=60;Rb(l);l.frameSkipCounter=0;l.currentAudioLatencyInSeconds=0;l.wasmInstance.exports.clearAudioBuffer();break;case x.IS_GBC:a=0<l.wasmInstance.exports.isGBC();ea(M({type:x.IS_GBC,
response:a},b.messageId));break;default:console.log("Unknown WasmBoy Worker message:",b)}},getFPS:()=>0<l.timeStampsUntilReady?l.speed&&0<l.speed?l.options.gameboyFrameRate*l.speed:l.options.gameboyFrameRate:l.fpsTimeStamps?l.fpsTimeStamps.length:0};fb(l.messageHandler)})();
